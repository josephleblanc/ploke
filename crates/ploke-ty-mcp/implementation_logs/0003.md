# 0003 â€“ Add tool timeout, list_tools mapper, and unit test

Decisions
- Introduced a conservative per-call timeout (30s) in McpManager::call_tool to avoid hangs on misbehaving servers.
- Extracted list_tools JSON mapping into a helper (map_tools_from_value) for unit testing and clarity.
- Added a unit test validating tool descriptor extraction without requiring an MCP server.

Changes Summary
- manager.rs: wrap call_tool with tokio::time::timeout; import Duration.
- manager.rs: add map_tools_from_value helper; refactor list_tools to use it.
- manager.rs: add unit test for mapping logic.

Rationale
- Timeouts protect the UI/event loop from indefinite stalls and provide clearer McpError::Timeout.
- Separating mapping logic simplifies future schema normalization and enables lightweight tests.

Next Steps
- Config loader (TOML) and autostart per PLAN (M2).
- Optional tracing spans (server_start, call_tool, list_tools) once we add a tracing dependency.
- Add a default/tool-specific timeout config surface in McpConfig if needed.

Suggested PLAN.md Edits
- Document the default tool timeout (30s) and future configurability under "Cancellation and Timeouts".
