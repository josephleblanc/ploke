# 0012 â€“ Error derivation, E2E test scaffolding, and install checks

Decisions
- Derive thiserror::Error for McpError to reduce boilerplate and ensure consistent Display/Source behavior.
- Add end-to-end tests gated by PLOKE_E2E_MCP=1 to verify:
  - Required MCP launchers are installed (uvx for mcp-server-git, npx for Context7).
  - Manager can start servers and typed clients can successfully call tools.
- Keep tests resilient by asserting non-empty or key substrings rather than brittle exact outputs.

Changes Summary
- deps: Added thiserror via workspace to ploke-ty-mcp.
- types.rs: Switched McpError to #[derive(thiserror::Error)] with #[from] on Io/Anyhow, removed manual impls.
- tests: Added tests/e2e_mcp.rs:
  - mcp_servers_installed checks for uvx and npx (skips unless PLOKE_E2E_MCP=1).
  - git_status_e2e exercises GitClient::status(".").
  - context7_resolve_e2e exercises Context7Client::resolve_library_id("bevy").
- Tests construct McpConfig programmatically to avoid dependency on a local config file.

Next Steps
- Add unit tests for config parsing (priority sorting, default_timeout_ms) and restart_on_exit behavior with injected spawner.
- Add a generic call_tool smoke test to cover McpManager::call_tool in addition to typed clients.
- Consider optional feature flags to exclude Context7 E2E when Node/npx is unavailable.

Suggested PLAN.md Edits
- Note that E2E tests are gated by PLOKE_E2E_MCP and require uvx/npx to be present in PATH.

Rationale
- Deriving errors aligns with workspace-wide error handling conventions and simplifies logging.
- E2E smoke tests provide a fast sanity check that the manager and typed clients interoperate with real MCP servers.
