# 0008 â€“ Per-call timeouts, health check on spawn, and API surface cleanup

Decisions
- Add McpManager::call_tool_with_timeout(id, tool, args, Duration) for per-invocation overrides.
- Refactor call_tool to reuse a shared do_call_tool(.., timeout) helper; enrich tracing with elapsed timings and result sizes.
- Add a basic health_check (list_tools with short timeout) after spawning a server in ensure_started; cancel and fail fast if unhealthy.
- Stop exporting legacy example modules (src/git_client.rs, src/context7_client.rs) from lib.rs to reduce API confusion.

Changes Summary
- manager.rs:
  - New call_tool_with_timeout(.., Duration) and internal do_call_tool(.., Duration).
  - call_tool now reads configured default timeout and delegates to do_call_tool.
  - New health_check(..) helper; ensure_started runs it with min(default_timeout_ms, 5000 ms).
  - Tracing: added elapsed timings and size logging for tool calls; minor import tweaks.
- lib.rs:
  - Removed pub exports for legacy example modules; typed clients remain under src/clients/*.

Rationale
- Per-call timeouts improve ergonomics without breaking existing defaults.
- A lightweight health check catches misconfigured or non-responsive servers early.
- API surface cleanup avoids two parallel ways of accessing MCP from this crate.

Next Steps
- Lifecycle resilience: implement restart_on_exit with backoff and jitter; consider periodic health pings (opt-in).
- Optional cancellation tokens for tool calls (tokio-util's CancellationToken).
- Move legacy examples into examples/ directory or behind a cargo feature.
- Tests: unit tests for call_tool_with_timeout; health_check success/failure paths (injectable spawner would help).

Suggested PLAN.md Edits
- Under Cancellation and Timeouts: document the new call_tool_with_timeout API and default vs override behavior.
- Under Observability: note that tool call spans now consistently log elapsed ms and output sizes.
