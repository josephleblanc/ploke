# 0004 â€“ Config loader (TOML), default path resolution, and autostart API

Decisions
- Implemented a TOML-based config loader matching PLAN.md's schema, using [servers.<id>] tables.
- Added default config path resolution via XDG_CONFIG_HOME or ~/.config/ploke/mcp.toml.
- Introduced McpManager::start_autostart to start servers marked autostart=true in priority order without changing from_config semantics.
- Added a convenience lib function to create a manager from default config and autostart.

Changes Summary
- Cargo.toml: added serde (derive), toml, and dirs dependencies.
- config.rs: added RawConfig/RawServer deserialization, loader functions (from_toml_str, load_from_path, default_config_path, load_default_file).
- manager.rs: added start_autostart() that respects priority and avoids restarting running servers.
- lib.rs: added manager_from_default_config_autostart() helper.

Rationale
- Keeps from_config side-effect free while enabling config-driven startup per PLAN.md M2.
- TOML mapping via Raw* structs avoids leaking serde impls into public types and handles defaults cleanly.

Next Steps
- Observability: add tracing spans around startup and tool calls.
- Optional per-tool timeouts via config surface (extend ServerSpec or add ToolSpec).
- E2E integration test gated by PLOKE_E2E_MCP that loads a minimal TOML and verifies autostart + basic tool call.

Suggested PLAN.md Edits
- Note the new API: McpManager::start_autostart and lib::manager_from_default_config_autostart.
- Document default config discovery under Config Design.
