# Remote Embedding — Slice 3 Report (2025-11-18)

## Summary
- Initial Slice 3 runtime evidence has been wired up via `cargo xtask embedding:collect-evidence --slice 3`, producing `target/test-output/embedding/slice3-runtime.json`.
- The current artifact reflects offline TUI runtime tests under `multi_embedding_runtime` that validate multi-embedding fixture backup/restore and basic compatibility of runtime-owned relations; indexer/TEST_APP wiring and live API evidence remain future work.

## Feature flag state for this slice (current run)
- Compile-time:
  - `ploke-tui`: `multi_embedding_runtime` (implies `multi_embedding_db` and `multi_embedding_schema` in dependent crates).
- Runtime:
  - Tests use the TUI runtime flow with multi-embedding fixtures but do not yet exercise indexer jobs or live provider calls.

## Evidence collected
| Artifact | Generated by | Notes |
| --- | --- | --- |
| `target/test-output/embedding/slice3-runtime.json` | `cargo xtask embedding:collect-evidence --slice 3` | Captures Validation Matrix entry for the TUI runtime tier using `multi_embedding_runtime_db_tests.rs` under the `multi_embedding_runtime` feature. Offline-only; no live provider calls yet. |

### Validation Matrix commands (offline, runtime tier)
- `cargo test -p ploke-tui --features multi_embedding_runtime --test multi_embedding_runtime_db_tests` ✅

### Notable verifications (current scope)
- **TUI/runtime sanity with multi-embedding fixtures**
  - `load_db_with_multi_embedding_fixture`:
    - Initializes an in-memory `Database` with schema.
    - Imports the multi-embedding fixture backup (`fixture_nodes_multi_embedding_schema_v1_…`).
    - Rebuilds primary indexes and asserts that all expected multi-embedding metadata relations are present.
  - `scan_for_change_with_multi_embedding_relations`:
    - Loads the same multi-embedding fixture into a `Database`.
    - Builds a minimal `AppState` + `EventBus` under `multi_embedding_runtime`.
    - Asserts that the database has relations and that all experimental metadata relations are registered, ensuring the runtime flag does not break basic backup/restore and scan preconditions.

## Outstanding work / forward-looking notes
1. **Indexer/runtime integration (planned)**: Slice 3 still needs `ploke-embed` indexer paths wired to the multi-embedding DB helpers (`update_embeddings_batch`, HNSW helpers) so runtime jobs write/read real multi-set vectors instead of relying solely on pre-seeded fixtures.
2. **Additional runtime tests**: Future work should add:
   - Indexer-level tests that verify per-provider/model/dimension sets are written to the correct vector relations under `multi_embedding_runtime`.
   - CLI/handler tests (`/embedding use`, etc.) that request specific embedding sets.
3. **Live telemetry**: No live (`cfg(feature = "live_api_tests")`) runs have been recorded yet for Slice 3. When added, they should produce `slice3-runtime-live-<timestamp>.json` artifacts with provider metadata, tool-call traces, and kill-switch status as described in `telemetry_evidence_plan.md`.


