  2025-09-06T06:05:34.959425Z  INFO ploke_tui::event_bus: close, time.busy: 28.1µs, time.idle: 3.95µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.959519Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): f05fa0cb-13b3-4033-80a4-9406a6bb98db,
                parent_id: 16c42d05-4f80-4d81-8e5f-d3920f98659e
                message_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.959533Z  INFO ploke_tui::event_bus: close, time.busy: 1.76µs, time.idle: 1.39µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.959542Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 187µs, time.idle: 8.70µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.959552Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 235µs, time.idle: 23.1µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.959579Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:34.972148Z  INFO ploke_tui::llm: Received LLM request for parent_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db
new_msg_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:34.983072Z  INFO ploke_tui::event_bus: close, time.busy: 22.6µs, time.idle: 5.67µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 63743972-bc30-457a-9b47-dc3719cda6ee, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.983182Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 63743972-bc30-457a-9b47-dc3719cda6ee,
                parent_id: c0ccd3b6-33e2-4d4a-b758-327882290e15
                message_id: 63743972-bc30-457a-9b47-dc3719cda6ee,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 63743972-bc30-457a-9b47-dc3719cda6ee, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.983205Z  INFO ploke_tui::event_bus: close, time.busy: 3.83µs, time.idle: 3.10µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 63743972-bc30-457a-9b47-dc3719cda6ee, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.983223Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 219µs, time.idle: 7.96µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 63743972-bc30-457a-9b47-dc3719cda6ee, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.983241Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 274µs, time.idle: 24.8µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:34.983271Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:34.983576Z  INFO ploke_tui::event_bus: close, time.busy: 12.4µs, time.idle: 9.98µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(11)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:34.995343Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:34.995496Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 35.9ms, time.idle: 5.64µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:34.996719Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.000157Z  INFO ploke_tui::llm: Received LLM request for parent_id: 63743972-bc30-457a-9b47-dc3719cda6ee
new_msg_id: 63743972-bc30-457a-9b47-dc3719cda6ee
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.001495Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 2aaa4901-f569-4216-b322-7597d6bb1c8a, parent_id: ba5b5b99-e911-46e7-a9e8-c147fbc5ae6c, call_id: "{\"file_path\": \"/test/file.rs\"}", content: "get_file_metadata" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(11)

  2025-09-06T06:05:35.012744Z  INFO ploke_tui::event_bus: close, time.busy: 38.8µs, time.idle: 12.8µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.012888Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19,
                parent_id: 13e4ceb2-62fc-4e65-b1cd-8a6e43ae789f
                message_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(3)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.012937Z  INFO ploke_tui::event_bus: close, time.busy: 12.1µs, time.idle: 8.12µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.012982Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 353µs, time.idle: 16.9µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(3)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.013046Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 482µs, time.idle: 53.2µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.013141Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.013388Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.013432Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 30.2ms, time.idle: 5.17µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.014790Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.033979Z  INFO ploke_tui::llm: Received LLM request for parent_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19
new_msg_id: 7cf5ba3e-a14a-4c7b-9279-3b65c0bdec19
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.035245Z  INFO ploke_tui::event_bus: close, time.busy: 32.6µs, time.idle: 17.9µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(11)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:35.037361Z  INFO ploke_tui::event_bus: close, time.busy: 14.9µs, time.idle: 3.11µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037424Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 51488eb3-f595-48f7-b044-3ce0ae4f26b7,
                parent_id: 824a244e-2545-4756-9229-2c46f8bbdd06
                message_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037439Z  INFO ploke_tui::event_bus: close, time.busy: 1.74µs, time.idle: 1.35µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037449Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 129µs, time.idle: 5.28µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037458Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 170µs, time.idle: 11.7µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037476Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.037859Z  INFO ploke_tui::event_bus: close, time.busy: 37.6µs, time.idle: 16.8µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f4907254-5389-41f2-ac2c-e1ecf39d7615, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037956Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): f4907254-5389-41f2-ac2c-e1ecf39d7615,
                parent_id: 76b63693-3505-4182-a945-e4e79854b5a2
                message_id: f4907254-5389-41f2-ac2c-e1ecf39d7615,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(2)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f4907254-5389-41f2-ac2c-e1ecf39d7615, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037973Z  INFO ploke_tui::event_bus: close, time.busy: 2.94µs, time.idle: 2.74µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f4907254-5389-41f2-ac2c-e1ecf39d7615, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037988Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 251µs, time.idle: 16.5µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(2)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f4907254-5389-41f2-ac2c-e1ecf39d7615, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.037999Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 301µs, time.idle: 9.16µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.038019Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.040677Z  INFO ploke_tui::event_bus: close, time.busy: 8.45µs, time.idle: 3.63µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.040732Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): e0459b6f-0ef7-4c34-abc9-6b8d21204777,
                parent_id: fdba911a-0f2a-44bc-8c6e-1b9964208618
                message_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(7)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.040748Z  INFO ploke_tui::event_bus: close, time.busy: 2.47µs, time.idle: 2.10µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.040761Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 110µs, time.idle: 5.08µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(7)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.040772Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 141µs, time.idle: 7.96µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.040790Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.040904Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.040949Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 27.8ms, time.idle: 10.6µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.041732Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.042844Z  INFO ploke_tui::event_bus: close, time.busy: 7.67µs, time.idle: 3.66µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 486a51fb-6495-492b-96e4-a121f031414b, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.042879Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 486a51fb-6495-492b-96e4-a121f031414b,
                parent_id: 5dd88d29-a780-4e14-874c-fb3f664b1d4a
                message_id: 486a51fb-6495-492b-96e4-a121f031414b,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(4)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 486a51fb-6495-492b-96e4-a121f031414b, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.042895Z  INFO ploke_tui::event_bus: close, time.busy: 2.60µs, time.idle: 2.71µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 486a51fb-6495-492b-96e4-a121f031414b, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.042912Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 92.1µs, time.idle: 4.97µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(4)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 486a51fb-6495-492b-96e4-a121f031414b, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.042925Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 122µs, time.idle: 10.0µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.042945Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.046850Z  INFO ploke_tui::event_bus: close, time.busy: 7.51µs, time.idle: 3.60µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.046885Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3,
                parent_id: b1588f29-66c5-445c-b197-9f2daaea6d1f
                message_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(8)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.046901Z  INFO ploke_tui::event_bus: close, time.busy: 2.48µs, time.idle: 2.45µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.046916Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 89.0µs, time.idle: 4.24µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(8)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.046926Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 114µs, time.idle: 6.42µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.046941Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.050649Z  INFO ploke_tui::llm: Received LLM request for parent_id: f4907254-5389-41f2-ac2c-e1ecf39d7615
new_msg_id: f4907254-5389-41f2-ac2c-e1ecf39d7615
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.050915Z  INFO ploke_tui::llm: Received LLM request for parent_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7
new_msg_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.052244Z  INFO ploke_tui::llm: Received LLM request for parent_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777
new_msg_id: e0459b6f-0ef7-4c34-abc9-6b8d21204777
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.055626Z  INFO ploke_tui::event_bus: close, time.busy: 8.09µs, time.idle: 2.54µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a91cb556-2ee4-4959-8f99-c92f59b22076, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.055658Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): a91cb556-2ee4-4959-8f99-c92f59b22076,
                parent_id: 30bdffb0-4829-4462-b57d-191cc07532ac
                message_id: a91cb556-2ee4-4959-8f99-c92f59b22076,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a91cb556-2ee4-4959-8f99-c92f59b22076, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.055673Z  INFO ploke_tui::event_bus: close, time.busy: 2.40µs, time.idle: 2.20µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a91cb556-2ee4-4959-8f99-c92f59b22076, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.055687Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 81.2µs, time.idle: 4.28µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a91cb556-2ee4-4959-8f99-c92f59b22076, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.055697Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 105µs, time.idle: 5.81µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.055713Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.056851Z  INFO ploke_tui::llm: Received LLM request for parent_id: 486a51fb-6495-492b-96e4-a121f031414b
new_msg_id: 486a51fb-6495-492b-96e4-a121f031414b
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.057444Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.057480Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 16.7ms, time.idle: 2.85µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.057985Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.059753Z  INFO ploke_tui::llm: Received LLM request for parent_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3
new_msg_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.060541Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.060613Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 22.6ms, time.idle: 3.62µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.060645Z  INFO ploke_tui::event_bus: close, time.busy: 7.07µs, time.idle: 3.49µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.060678Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): e7be9bf6-9aee-4541-9ccf-3eef72e31445,
                parent_id: 7d132efa-048a-4e85-904c-7a206546c48a
                message_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.060694Z  INFO ploke_tui::event_bus: close, time.busy: 2.16µs, time.idle: 2.09µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.060707Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 83.4µs, time.idle: 4.82µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.060717Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 109µs, time.idle: 6.42µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.060731Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.061564Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.065006Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.065046Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 27.6ms, time.idle: 3.03µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.065472Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.067742Z  INFO ploke_tui::llm: Received LLM request for parent_id: a91cb556-2ee4-4959-8f99-c92f59b22076
new_msg_id: a91cb556-2ee4-4959-8f99-c92f59b22076
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.070978Z  INFO ploke_tui::event_bus: close, time.busy: 10.7µs, time.idle: 3.63µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.071019Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 70ee5206-9861-4775-bc14-2acad3c2a37f,
                parent_id: e69a02fd-eea2-466a-b97d-e5bdbfb551f1
                message_id: 70ee5206-9861-4775-bc14-2acad3c2a37f,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.071033Z  INFO ploke_tui::event_bus: close, time.busy: 2.03µs, time.idle: 2.17µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.071047Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 98.1µs, time.idle: 4.60µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.071058Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 127µs, time.idle: 9.04µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.071074Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.071986Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.072032Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 25.1ms, time.idle: 3.64µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.072694Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.073717Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.073752Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.0ms, time.idle: 3.53µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.074302Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.079347Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.079390Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 36.4ms, time.idle: 3.56µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.079419Z  INFO ploke_tui::event_bus: close, time.busy: 8.01µs, time.idle: 3.37µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed182751-f610-47ce-846f-68da37db3cb9, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.079447Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): ed182751-f610-47ce-846f-68da37db3cb9,
                parent_id: dd7ca8bd-7128-40bf-bb60-5ab926fe98a4
                message_id: ed182751-f610-47ce-846f-68da37db3cb9,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed182751-f610-47ce-846f-68da37db3cb9, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.079462Z  INFO ploke_tui::event_bus: close, time.busy: 2.29µs, time.idle: 2.24µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed182751-f610-47ce-846f-68da37db3cb9, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.079475Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 81.2µs, time.idle: 4.13µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed182751-f610-47ce-846f-68da37db3cb9, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.079485Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 106µs, time.idle: 6.87µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:35.079500Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.079960Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.086043Z  INFO ploke_tui::llm: Received LLM request for parent_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445
new_msg_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.089573Z  INFO ploke_tui::llm: Received LLM request for parent_id: ed182751-f610-47ce-846f-68da37db3cb9
new_msg_id: ed182751-f610-47ce-846f-68da37db3cb9
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.089840Z  INFO ploke_tui::llm: Received LLM request for parent_id: 70ee5206-9861-4775-bc14-2acad3c2a37f
new_msg_id: 70ee5206-9861-4775-bc14-2acad3c2a37f
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.093585Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.093612Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 14.1ms, time.idle: 2.80µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.093889Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.096440Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.096564Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 25.5ms, time.idle: 3.80µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.097323Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.099021Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.102994Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 42.3ms, time.idle: 3.48µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:35.103278Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.532623Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.533087Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.533137Z DEBUG ploke_embed::local: close, time.busy: 519ms, time.idle: 9.55µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.544604Z DEBUG ploke_embed::local: shapes: outputs=[1, 4, 384], weights=[1, 4, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.544821Z DEBUG ploke_embed::local: shapes: outputs=[1, 4, 384], weights=[1, 4, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.544850Z DEBUG ploke_embed::local: close, time.busy: 504ms, time.idle: 4.75µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.627331Z DEBUG ploke_embed::local: shapes: outputs=[1, 15, 384], weights=[1, 15, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.627981Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.628235Z DEBUG ploke_embed::local: shapes: outputs=[1, 15, 384], weights=[1, 15, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.628274Z DEBUG ploke_embed::local: close, time.busy: 571ms, time.idle: 3.06µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.629164Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.629197Z DEBUG ploke_embed::local: close, time.busy: 633ms, time.idle: 5.59µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.633719Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.634250Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.634281Z DEBUG ploke_embed::local: close, time.busy: 541ms, time.idle: 3.05µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.641734Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.642418Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.642451Z DEBUG ploke_embed::local: close, time.busy: 577ms, time.idle: 3.33µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.669026Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.669798Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.669830Z DEBUG ploke_embed::local: close, time.busy: 598ms, time.idle: 4.43µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.688288Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.689284Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.689481Z DEBUG ploke_embed::local: close, time.busy: 586ms, time.idle: 3.02µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.699877Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.700258Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.700979Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.701005Z DEBUG ploke_embed::local: close, time.busy: 622ms, time.idle: 4.03µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.701067Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.701112Z DEBUG ploke_embed::local: close, time.busy: 627ms, time.idle: 2.99µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.754085Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.755173Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.755199Z DEBUG ploke_embed::local: close, time.busy: 694ms, time.idle: 3.31µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.776208Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.777994Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:35.778036Z DEBUG ploke_embed::local: close, time.busy: 681ms, time.idle: 3.71µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.004818Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.004885Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.004909Z  INFO ploke_rag::core: close, time.busy: 940ms, time.idle: 8.20µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005000Z  INFO ploke_rag::core: close, time.busy: 33.4µs, time.idle: 940ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005031Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005077Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005099Z  INFO ploke_rag::core: close, time.busy: 964ms, time.idle: 7.01µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005118Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005150Z  INFO ploke_rag::core: close, time.busy: 34.1µs, time.idle: 964ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(3)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005216Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(3)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005286Z  INFO ploke_tui::event_bus: close, time.busy: 11.5µs, time.idle: 3.58µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005402Z  INFO ploke_rag::core: close, time.busy: 103µs, time.idle: 964ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(3)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005424Z  INFO ploke_rag::core: close, time.busy: 964ms, time.idle: 218µs
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(3)
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.005439Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 964ms, time.idle: 4.20µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.017787Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.018071Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.018191Z  INFO ploke_rag::core: close, time.busy: 1.00s, time.idle: 14.0µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.018245Z  INFO ploke_rag::core: close, time.busy: 67.3µs, time.idle: 1.00s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.018322Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.044684Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.044734Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.044757Z  INFO ploke_rag::core: close, time.busy: 971ms, time.idle: 6.60µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.044809Z  INFO ploke_rag::core: close, time.busy: 26.9µs, time.idle: 971ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.044895Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.045168Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.045213Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.045233Z  INFO ploke_rag::core: close, time.busy: 952ms, time.idle: 5.73µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.045279Z  INFO ploke_rag::core: close, time.busy: 21.9µs, time.idle: 952ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.045350Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051717Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051757Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051773Z  INFO ploke_rag::core: close, time.busy: 972ms, time.idle: 5.68µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051820Z  INFO ploke_rag::core: close, time.busy: 25.9µs, time.idle: 972ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(4)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051904Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(4)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.051950Z  INFO ploke_tui::event_bus: close, time.busy: 5.86µs, time.idle: 2.27µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.052024Z  INFO ploke_rag::core: close, time.busy: 78.5µs, time.idle: 972ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(4)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.052032Z  INFO ploke_rag::core: close, time.busy: 972ms, time.idle: 180µs
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(4)
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.052040Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 973ms, time.idle: 3.99µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.056382Z  INFO ploke_rag::core: close, time.busy: 39.4µs, time.idle: 25.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.056460Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.069552Z  INFO ploke_rag::core: close, time.busy: 18.2µs, time.idle: 16.7µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.069635Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.075007Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.075054Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.075070Z  INFO ploke_rag::core: close, time.busy: 1.08s, time.idle: 6.03µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.075110Z  INFO ploke_rag::core: close, time.busy: 53.0µs, time.idle: 1.08s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.075174Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077196Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077247Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077270Z  INFO ploke_rag::core: close, time.busy: 1.02s, time.idle: 6.43µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077323Z  INFO ploke_rag::core: close, time.busy: 26.6µs, time.idle: 1.02s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(7)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077397Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077453Z  INFO ploke_tui::event_bus: close, time.busy: 6.69µs, time.idle: 3.24µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.077476Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 00ff5618-0a09-4656-bddc-6899646dfa15, parent_id: 225a8e2e-b5e4-46e3-aeb4-189eae815e34, call_id: "{\"error\": \"File not found\"}", content: "get_file_metadata" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.080643Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.080684Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.080701Z  INFO ploke_rag::core: close, time.busy: 1.02s, time.idle: 5.62µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.080741Z  INFO ploke_rag::core: close, time.busy: 26.1µs, time.idle: 1.02s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.080815Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.083479Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.083519Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.083536Z  INFO ploke_rag::core: close, time.busy: 1.01s, time.idle: 5.63µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.083575Z  INFO ploke_rag::core: close, time.busy: 28.6µs, time.idle: 1.01s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.083634Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.086934Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.086972Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.086987Z  INFO ploke_rag::core: close, time.busy: 984ms, time.idle: 4.93µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.087026Z  INFO ploke_rag::core: close, time.busy: 21.3µs, time.idle: 984ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.087080Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095110Z  INFO ploke_rag::core: close, time.busy: 18.1µs, time.idle: 15.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095180Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095874Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095913Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095930Z  INFO ploke_rag::core: close, time.busy: 999ms, time.idle: 5.24µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.095970Z  INFO ploke_rag::core: close, time.busy: 23.6µs, time.idle: 999ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.096046Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.096558Z  INFO ploke_rag::core: close, time.busy: 17.3µs, time.idle: 15.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.096619Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.126430Z  INFO ploke_rag::core: close, time.busy: 24.5µs, time.idle: 21.7µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.126543Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128456Z  INFO ploke_tui::event_bus: close, time.busy: 9.96µs, time.idle: 5.81µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128582Z  INFO ploke_rag::core: close, time.busy: 16.8µs, time.idle: 67.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(7)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128650Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128700Z  INFO ploke_rag::core: close, time.busy: 160µs, time.idle: 1.07s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128711Z  INFO ploke_rag::core: close, time.busy: 1.02s, time.idle: 51.3ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(7)
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.128723Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.07s, time.idle: 3.50µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.131026Z  INFO ploke_rag::core: close, time.busy: 16.8µs, time.idle: 14.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.131104Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.134847Z  INFO ploke_rag::core: close, time.busy: 16.9µs, time.idle: 15.1µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.134913Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.138277Z  INFO ploke_rag::core: close, time.busy: 11.8µs, time.idle: 11.7µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.138330Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.147300Z  INFO ploke_rag::core: close, time.busy: 27.5µs, time.idle: 24.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.147454Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.157697Z  INFO ploke_rag::core: close, time.busy: 15.9µs, time.idle: 14.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.157763Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.158077Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.170858Z  INFO ploke_rag::core: close, time.busy: 17.5µs, time.idle: 15.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.170921Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.171165Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.196387Z  INFO ploke_rag::core: close, time.busy: 20.4µs, time.idle: 19.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.196472Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.196941Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.197864Z  INFO ploke_rag::core: close, time.busy: 19.4µs, time.idle: 18.1µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.197946Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.198159Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.228076Z  INFO ploke_rag::core: close, time.busy: 20.6µs, time.idle: 19.6µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.228172Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.228567Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.232576Z  INFO ploke_rag::core: close, time.busy: 21.7µs, time.idle: 19.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.232688Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.233312Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.236702Z  INFO ploke_rag::core: close, time.busy: 19.8µs, time.idle: 18.9µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.236786Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.237136Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.241342Z  INFO ploke_rag::core: close, time.busy: 21.5µs, time.idle: 22.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.241422Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.241694Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.249622Z  INFO ploke_rag::core: close, time.busy: 18.4µs, time.idle: 16.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.249724Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.250175Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.441571Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.442913Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.442976Z DEBUG ploke_embed::local: close, time.busy: 285ms, time.idle: 3.89µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.476753Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.477168Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.477205Z DEBUG ploke_embed::local: close, time.busy: 306ms, time.idle: 3.99µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.547591Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.548174Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.548218Z DEBUG ploke_embed::local: close, time.busy: 350ms, time.idle: 3.54µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.672091Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.672656Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.672690Z DEBUG ploke_embed::local: close, time.busy: 431ms, time.idle: 3.59µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.686899Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.688082Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.688121Z DEBUG ploke_embed::local: close, time.busy: 492ms, time.idle: 4.46µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.694742Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.695631Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.695727Z DEBUG ploke_embed::local: close, time.busy: 459ms, time.idle: 4.03µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.731950Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.733265Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.735365Z DEBUG ploke_embed::local: close, time.busy: 507ms, time.idle: 4.38µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.772662Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.773898Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.773928Z DEBUG ploke_embed::local: close, time.busy: 541ms, time.idle: 3.32µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.828500Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.829612Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.829639Z DEBUG ploke_embed::local: close, time.busy: 580ms, time.idle: 3.23µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.880240Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.880303Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.880334Z  INFO ploke_rag::core: close, time.busy: 723ms, time.idle: 8.10µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.880362Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.880377Z  INFO ploke_rag::core: close, time.busy: 723ms, time.idle: 1.09s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.910608Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.910665Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.910689Z  INFO ploke_rag::core: close, time.busy: 740ms, time.idle: 6.18µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.910703Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.910712Z  INFO ploke_rag::core: close, time.busy: 740ms, time.idle: 1.16s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.967878Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.967934Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.967956Z  INFO ploke_rag::core: close, time.busy: 770ms, time.idle: 6.16µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.967974Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.967989Z  INFO ploke_rag::core: close, time.busy: 770ms, time.idle: 1.10s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.969897Z  INFO ploke_rag::context: close, time.busy: 83.8ms, time.idle: 5.69ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 34, hits: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.969928Z  INFO ploke_rag::core: close, time.busy: 1.75s, time.idle: 158ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.969942Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.969958Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.969992Z  INFO ploke_tui::event_bus: close, time.busy: 10.4µs, time.idle: 2.82µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970007Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.90s, time.idle: 4.08µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970038Z  INFO ploke_tui::llm: Received context for parent_id: 51488eb3-f595-48f7-b044-3ce0ae4f26b7
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(6)

  2025-09-06T06:05:36.970056Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 51488eb3-f595-48f7-b044-3ce0ae4f26b7
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(6)

  2025-09-06T06:05:36.970062Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 51488eb3-f595-48f7-b044-3ce0ae4f26b7
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(6)

  2025-09-06T06:05:36.970076Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(6)

  2025-09-06T06:05:36.970134Z  INFO ploke_tui::event_bus: close, time.busy: 3.38µs, time.idle: 2.25µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:36.970148Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 34.5µs, time.idle: 2.05µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:36.970174Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970207Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970260Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970268Z  INFO ploke_rag::context: close, time.busy: 53.6ms, time.idle: 5.91ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(13)
    in ploke_rag::context::assemble_context with query_len: 28, hits: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970293Z  INFO ploke_rag::core: close, time.busy: 1.80s, time.idle: 158ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(13)
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970302Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970301Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970315Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970332Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970342Z  INFO ploke_tui::event_bus: close, time.busy: 6.98µs, time.idle: 1.96µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970351Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.96s, time.idle: 6.90µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:36.970367Z  INFO ploke_tui::llm: Received context for parent_id: 63743972-bc30-457a-9b47-dc3719cda6ee
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(13)

  2025-09-06T06:05:36.970378Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 63743972-bc30-457a-9b47-dc3719cda6ee
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(13)

  2025-09-06T06:05:36.970381Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 63743972-bc30-457a-9b47-dc3719cda6ee
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(13)

  2025-09-06T06:05:36.970390Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(13)

  2025-09-06T06:05:36.970341Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Type alias used in a constant.\ntype MyInt = i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union IntOrFloat {\n    i: i32,\n    f: f32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union InnerPublic {\n        x: f32,\n        y: f32,\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TOP_LEVEL_STR: &str = \"hello world\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SubItem;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Hello, I need help with some files",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970423Z  INFO ploke_tui::event_bus: close, time.busy: 2.12µs, time.idle: 1.38µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:36.970430Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 17.4µs, time.idle: 1.24µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:36.970444Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970459Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970476Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970506Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970525Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970532Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DisplayableContainer<T: std::fmt::Display> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeWithBounds {\n    type BoundedOutput: Debug + Clone;\n    fn generate_bounded(&self) -> Self::BoundedOutput;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct TupleStruct(pub i32, pub i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Check the size of Cargo.toml",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970627Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.970779Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.993383Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 22.5ms, time.idle: 187µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(135)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.993552Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 21.9ms, time.idle: 856µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(136)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.993674Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:36.994360Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015141Z  INFO ploke_rag::context: close, time.busy: 41.0ms, time.idle: 6.08ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(9)
    in ploke_rag::context::assemble_context with query_len: 27, hits: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015170Z  INFO ploke_rag::core: close, time.busy: 1.76s, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(9)
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015178Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015189Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015214Z  INFO ploke_tui::event_bus: close, time.busy: 6.66µs, time.idle: 1.86µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015224Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.92s, time.idle: 3.26µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.015240Z  INFO ploke_tui::llm: Received context for parent_id: ed182751-f610-47ce-846f-68da37db3cb9
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(9)

  2025-09-06T06:05:37.015250Z  INFO ploke_tui::llm: pending_requests found match for req_parent: ed182751-f610-47ce-846f-68da37db3cb9
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(9)

  2025-09-06T06:05:37.015254Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: ed182751-f610-47ce-846f-68da37db3cb9
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(9)

  2025-09-06T06:05:37.015263Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(9)

  2025-09-06T06:05:37.015296Z  INFO ploke_tui::event_bus: close, time.busy: 2.30µs, time.idle: 1.36µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.015304Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.6µs, time.idle: 1.33µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.015323Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015338Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015357Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015388Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015407Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015415Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Get metadata for Cargo.toml",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.015626Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.018896Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.023161Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.036687Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 21.0ms, time.idle: 54.7µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(137)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.036777Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.040203Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.040259Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.040281Z  INFO ploke_rag::core: close, time.busy: 844ms, time.idle: 6.75µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.040300Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.040477Z  INFO ploke_rag::core: close, time.busy: 844ms, time.idle: 1.12s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.054358Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.054400Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.054417Z  INFO ploke_rag::core: close, time.busy: 818ms, time.idle: 5.45µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.054433Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.054447Z  INFO ploke_rag::core: close, time.busy: 818ms, time.idle: 1.16s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.062563Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.071215Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.071268Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.071291Z  INFO ploke_rag::core: close, time.busy: 830ms, time.idle: 6.53µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.071313Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.071327Z  INFO ploke_rag::core: close, time.busy: 830ms, time.idle: 1.14s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.078750Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.078800Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.078822Z  INFO ploke_rag::core: close, time.busy: 851ms, time.idle: 6.60µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.078838Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.078848Z  INFO ploke_rag::core: close, time.busy: 851ms, time.idle: 1.23s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.098464Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.098516Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.098539Z  INFO ploke_rag::core: close, time.busy: 849ms, time.idle: 6.64µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.098556Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.098571Z  INFO ploke_rag::core: close, time.busy: 849ms, time.idle: 1.15s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105267Z  INFO ploke_rag::context: close, time.busy: 44.1ms, time.idle: 6.68ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(8)
    in ploke_rag::context::assemble_context with query_len: 58, hits: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105296Z  INFO ploke_rag::core: close, time.busy: 1.87s, time.idle: 160ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(8)
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105309Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105319Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105348Z  INFO ploke_tui::event_bus: close, time.busy: 8.45µs, time.idle: 2.85µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105359Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.03s, time.idle: 4.68µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105377Z  INFO ploke_tui::llm: Received context for parent_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(8)

  2025-09-06T06:05:37.105390Z  INFO ploke_tui::llm: pending_requests found match for req_parent: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(8)

  2025-09-06T06:05:37.105395Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(8)

  2025-09-06T06:05:37.105405Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(8)

  2025-09-06T06:05:37.105451Z  INFO ploke_tui::event_bus: close, time.busy: 3.29µs, time.idle: 2.24µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.105456Z  INFO ploke_rag::context: close, time.busy: 59.8ms, time.idle: 5.18ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(14)
    in ploke_rag::context::assemble_context with query_len: 71, hits: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105464Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 28.3µs, time.idle: 2.00µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.105478Z  INFO ploke_rag::core: close, time.busy: 1.88s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(14)
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105486Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105489Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105500Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105506Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105519Z  INFO ploke_tui::event_bus: close, time.busy: 5.77µs, time.idle: 2.52µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105528Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105533Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.03s, time.idle: 4.30µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.105550Z  INFO ploke_tui::llm: Received context for parent_id: a91cb556-2ee4-4959-8f99-c92f59b22076
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(14)

  2025-09-06T06:05:37.105560Z  INFO ploke_tui::llm: pending_requests found match for req_parent: a91cb556-2ee4-4959-8f99-c92f59b22076
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(14)

  2025-09-06T06:05:37.105565Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: a91cb556-2ee4-4959-8f99-c92f59b22076
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(14)

  2025-09-06T06:05:37.105574Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(14)

  2025-09-06T06:05:37.105570Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105596Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105617Z  INFO ploke_tui::event_bus: close, time.busy: 3.70µs, time.idle: 2.19µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.105629Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 25.8µs, time.idle: 1.96µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.105647Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105666Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105688Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105720Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105608Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseOuterPoint = inner::OuterPoint;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod impls;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type ConstRawPtr = *const u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInner = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please help me understand how to use tools in this system.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105744Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105755Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner_mod {\n    // Constant visible only within the crate, defined inside an inline module.\n    pub(crate) const INNER_CONST: u8 = 1;\n\n    // Static mutable boolean visible only to the parent module (`crate`), defined inside an inline module.\n    #[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SuperTrait: SimpleTrait {\n    fn super_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you find any code snippets related to SimpleStruct in the codebase?",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.105913Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.106001Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109665Z  INFO ploke_rag::context: close, time.busy: 32.5ms, time.idle: 5.76ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(5)
    in ploke_rag::context::assemble_context with query_len: 29, hits: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109694Z  INFO ploke_rag::core: close, time.busy: 1.85s, time.idle: 160ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(5)
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109702Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109711Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109735Z  INFO ploke_tui::event_bus: close, time.busy: 6.48µs, time.idle: 1.93µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109744Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.01s, time.idle: 3.19µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.109760Z  INFO ploke_tui::llm: Received context for parent_id: e7be9bf6-9aee-4541-9ccf-3eef72e31445
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(5)

  2025-09-06T06:05:37.109769Z  INFO ploke_tui::llm: pending_requests found match for req_parent: e7be9bf6-9aee-4541-9ccf-3eef72e31445
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(5)

  2025-09-06T06:05:37.109772Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: e7be9bf6-9aee-4541-9ccf-3eef72e31445
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(5)

  2025-09-06T06:05:37.109780Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(5)

  2025-09-06T06:05:37.109821Z  INFO ploke_tui::event_bus: close, time.busy: 3.35µs, time.idle: 2.17µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.109832Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 26.2µs, time.idle: 2.07µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.109851Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109869Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109891Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109927Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109945Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.109953Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ComplexGeneric<T>\nwhere\n    T: Clone + Send + 'static,\n= Option<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with lifetime, type, and const generic parameters, and a where clause.\n#[derive(Debug, Clone)] // Attribute for testing\npub enum GenericEnum<'a, T: Default + Clone, const N: usize>\nwhere\n    T: Send, // Where clause\n{\n    /// Doc comment on a generic variant.\n    GenericVariant(T),\n    LifetimeVariant(&'a str),\n    ConstGenericVariant([u8; N]),\n    #[cfg(feature = \"enum_feature_one\")] // CFG on a variant\n    ConditionalGeneric(Option<T>),\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TOP_LEVEL_STR: &str = \"hello world\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) enum CrateEnum {\n    B,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "I'm working on a Rust project",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.110215Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.119774Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.119819Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.119839Z  INFO ploke_rag::core: close, time.busy: 887ms, time.idle: 6.19µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.119853Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.119865Z  INFO ploke_rag::core: close, time.busy: 887ms, time.idle: 1.17s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.123451Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 17.4ms, time.idle: 55.9µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(139)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.123535Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.128972Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 18.7ms, time.idle: 49.7µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(141)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129061Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129091Z  INFO ploke_rag::context: close, time.busy: 45.6ms, time.idle: 4.62ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(10)
    in ploke_rag::context::assemble_context with query_len: 83, hits: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129121Z  INFO ploke_rag::core: close, time.busy: 1.98s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(10)
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129112Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 23.0ms, time.idle: 31.3µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(140)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129130Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129139Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129160Z  INFO ploke_tui::event_bus: close, time.busy: 6.47µs, time.idle: 1.96µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129169Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.13s, time.idle: 7.76µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.129186Z  INFO ploke_tui::llm: Received context for parent_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(10)

  2025-09-06T06:05:37.129196Z  INFO ploke_tui::llm: pending_requests found match for req_parent: f05fa0cb-13b3-4033-80a4-9406a6bb98db
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(10)

  2025-09-06T06:05:37.129184Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129200Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: f05fa0cb-13b3-4033-80a4-9406a6bb98db
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(10)

  2025-09-06T06:05:37.129208Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(10)

  2025-09-06T06:05:37.129243Z  INFO ploke_tui::event_bus: close, time.busy: 2.15µs, time.idle: 1.38µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.129250Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.7µs, time.idle: 1.28µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.129264Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129280Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129298Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129358Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129397Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129409Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.129616Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.150786Z  INFO ploke_rag::context: close, time.busy: 45.7ms, time.idle: 6.44ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(12)
    in ploke_rag::context::assemble_context with query_len: 134, hits: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150811Z  INFO ploke_rag::core: close, time.busy: 1.89s, time.idle: 160ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(12)
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150819Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150828Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150848Z  INFO ploke_tui::event_bus: close, time.busy: 6.26µs, time.idle: 1.88µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150857Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.05s, time.idle: 3.99µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.150871Z  INFO ploke_tui::llm: Received context for parent_id: 70ee5206-9861-4775-bc14-2acad3c2a37f
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(12)

  2025-09-06T06:05:37.150880Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 70ee5206-9861-4775-bc14-2acad3c2a37f
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(12)

  2025-09-06T06:05:37.150884Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 70ee5206-9861-4775-bc14-2acad3c2a37f
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(12)

  2025-09-06T06:05:37.150892Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(12)

  2025-09-06T06:05:37.150923Z  INFO ploke_tui::event_bus: close, time.busy: 1.98µs, time.idle: 1.37µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.150930Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 17.2µs, time.idle: 1.21µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.150944Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.150959Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: true
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.150976Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.151005Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.151024Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.151032Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union UnionWithFieldAttr {\n    #[cfg(target_endian = \"big\")]\n    big_endian_data: u32,\n    #[cfg(not(target_endian = \"big\"))]\n    little_endian_data: u32,\n    always_present: u8,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.151238Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.152988Z  INFO ploke_rag::context: close, time.busy: 29.0ms, time.idle: 4.09ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(2)
    in ploke_rag::context::assemble_context with query_len: 132, hits: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153011Z  INFO ploke_rag::core: close, time.busy: 1.94s, time.idle: 156ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(2)
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153019Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153028Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153048Z  INFO ploke_tui::event_bus: close, time.busy: 5.46µs, time.idle: 1.62µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153056Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.09s, time.idle: 3.92µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:37.153069Z  INFO ploke_tui::llm: Received context for parent_id: f4907254-5389-41f2-ac2c-e1ecf39d7615
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(2)

  2025-09-06T06:05:37.153078Z  INFO ploke_tui::llm: pending_requests found match for req_parent: f4907254-5389-41f2-ac2c-e1ecf39d7615
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(2)

  2025-09-06T06:05:37.153082Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: f4907254-5389-41f2-ac2c-e1ecf39d7615
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(2)

  2025-09-06T06:05:37.153089Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(2)

  2025-09-06T06:05:37.153120Z  INFO ploke_tui::event_bus: close, time.busy: 3.48µs, time.idle: 1.34µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.153127Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.3µs, time.idle: 1.23µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:37.153140Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153155Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: true
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153174Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153202Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153221Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153228Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[derive(Debug)]\npub struct AttributedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[deprecated(note = \"Use NewId instead\")]\npub type OldId = String;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.153422Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.155194Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.155344Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.156769Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 27.1ms, time.idle: 53.2µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(142)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.156840Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.164745Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.174354Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 23.0ms, time.idle: 57.3µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(145)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.174458Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.174461Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 20.9ms, time.idle: 63.3µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(146)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.174552Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.183384Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.201313Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:37.206396Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617135Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-5DwGinkN0DnIAYHp0nlr",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll fetch the metadata for the Cargo.toml file to get its tracking information.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1600,
            completion_tokens: 35,
            total_tokens: 1635,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617266Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617332Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617898Z  INFO ploke_tui::event_bus: close, time.busy: 5.71µs, time.idle: 4.80µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617926Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617952Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: a8864610-d098-4280-8050-1e4b3161b4eb, parent_id: ed182751-f610-47ce-846f-68da37db3cb9, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617970Z DEBUG dbg_tools: Processing tool, request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617984Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.617992Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618174Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618197Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: a8864610-d098-4280-8050-1e4b3161b4eb, parent_id: ed182751-f610-47ce-846f-68da37db3cb9, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618638Z  INFO ploke_tui::llm::session: close, time.busy: 710µs, time.idle: 2.05µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: a8864610-d098-4280-8050-1e4b3161b4eb, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618672Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618685Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618740Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.618749Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Get metadata for Cargo.toml",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.619021Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.868843Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-R5uGIFbyNLK9S4Uf2mHd",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for the Cargo.toml file using the get_file_metadata tool.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1612,
            completion_tokens: 36,
            total_tokens: 1648,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869002Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869071Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869879Z  INFO ploke_tui::event_bus: close, time.busy: 5.73µs, time.idle: 5.25µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869908Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869934Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, parent_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869952Z DEBUG dbg_tools: Processing tool, request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869965Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.869974Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870129Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870152Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, parent_id: f05fa0cb-13b3-4033-80a4-9406a6bb98db, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870676Z  INFO ploke_tui::llm::session: close, time.busy: 767µs, time.idle: 2.24µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: 7797e067-8fa1-4d70-b3b9-f722f5bce931, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870711Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870723Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870781Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.870791Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.871069Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.918427Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-YiH09QUMFNcLfHHrfmtq",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll search for code snippets related to SimpleStruct in the codebase.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.request_code_context:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: RequestCodeContext,
                                    arguments: "{\"search_term\": \"SimpleStruct\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1469,
            completion_tokens: 33,
            total_tokens: 1502,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.918594Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.918667Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.919264Z  INFO ploke_tui::event_bus: close, time.busy: 5.55µs, time.idle: 4.87µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.919291Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.919362Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, parent_id: a91cb556-2ee4-4959-8f99-c92f59b22076, call_id: "functions.request_code_context:0", tool: RequestCodeContext
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.919444Z DEBUG dbg_tools: Processing tool, request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0", args: "{\"search_term\": \"SimpleStruct\"}", tool: RequestCodeContext
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.919486Z DEBUG dbg_tools: params: RequestCodeContextParams {
    token_budget: None,
    search_term: "SimpleStruct",
}

    at crates/ploke-tui/src/tools/mod.rs:244 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.920031Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.973475Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-wgIrOvNOOEm5vjsEqSwF",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll check for the Cargo.toml file and get its metadata including the tracking hash.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1543,
            completion_tokens: 36,
            total_tokens: 1579,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.973550Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.973586Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974577Z  INFO ploke_tui::event_bus: close, time.busy: 7.33µs, time.idle: 5.20µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974601Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974626Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, parent_id: f4907254-5389-41f2-ac2c-e1ecf39d7615, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974648Z DEBUG dbg_tools: Processing tool, request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974664Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974673Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.974825Z  INFO ploke_tui::event_bus: close, time.busy: 5.56µs, time.idle: 3.47µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.979582Z  INFO ploke_tui::llm::session: close, time.busy: 4.98ms, time.idle: 3.21µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 3fbcfc46-641e-43cf-83fa-5ded66c9fb80, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.979607Z  INFO ploke_tui::llm::session: close, time.busy: 1.82s, time.idle: 4.57ms
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.979615Z  INFO ploke_tui::llm: close, time.busy: 1.61ms, time.idle: 1.82s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:38.979622Z  INFO ploke_tui::llm: close, time.busy: 1.67ms, time.idle: 1.82s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(2)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.012763Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.013006Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.013031Z DEBUG ploke_embed::local: close, time.busy: 93.4ms, time.idle: 3.20µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.016684Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-5X9uxYXEyEjXpxWo86nB",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll help you check the size of the Cargo.toml file. However, I need to first check if the file exists and then get its metadata.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1746,
            completion_tokens: 49,
            total_tokens: 1795,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.016767Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.016808Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017578Z  INFO ploke_tui::event_bus: close, time.busy: 8.63µs, time.idle: 5.16µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017610Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017637Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, parent_id: 63743972-bc30-457a-9b47-dc3719cda6ee, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017654Z DEBUG dbg_tools: Processing tool, request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017666Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017673Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017786Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.017809Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, parent_id: 63743972-bc30-457a-9b47-dc3719cda6ee, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018270Z  INFO ploke_tui::llm::session: close, time.busy: 658µs, time.idle: 3.04µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 70fd6cf0-cbeb-403c-aaaa-c478e93a94bd, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018303Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018321Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018374Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018382Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DisplayableContainer<T: std::fmt::Display> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeWithBounds {\n    type BoundedOutput: Debug + Clone;\n    fn generate_bounded(&self) -> Self::BoundedOutput;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct TupleStruct(pub i32, pub i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Check the size of Cargo.toml",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.018645Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.023191Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-yY1lOx6054alAIC9ROXA",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll check the file metadata for `Cargo.toml` in the current directory.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1690,
            completion_tokens: 35,
            total_tokens: 1725,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.023273Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.023325Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024353Z  INFO ploke_tui::event_bus: close, time.busy: 10.4µs, time.idle: 6.31µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024385Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024412Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, parent_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024429Z DEBUG dbg_tools: Processing tool, request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024439Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024446Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024557Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.024577Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, parent_id: 70ee5206-9861-4775-bc14-2acad3c2a37f, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025164Z  INFO ploke_tui::llm::session: close, time.busy: 778µs, time.idle: 2.38µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: cd504eea-7fdb-47c9-b27f-ab4ebd684a7e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025194Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025204Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025251Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025259Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union UnionWithFieldAttr {\n    #[cfg(target_endian = \"big\")]\n    big_endian_data: u32,\n    #[cfg(not(target_endian = \"big\"))]\n    little_endian_data: u32,\n    always_present: u8,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.025483Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070171Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-pA6pCJG0Evh3MQFWpnJW",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll help you understand how to use the tools available in this system. Let me demonstrate by showing you what's available in the codebase and how the tools work.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"src/lib.rs\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1707,
            completion_tokens: 52,
            total_tokens: 1759,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070233Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070264Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070751Z  INFO ploke_tui::event_bus: close, time.busy: 6.41µs, time.idle: 5.14µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070779Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070804Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, parent_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070823Z DEBUG dbg_tools: Processing tool, request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"src/lib.rs\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070834Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "src/lib.rs",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.070840Z DEBUG dbg_tools: path: src/lib.rs
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.071210Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"src/lib.rs\",\"exists\":true,\"byte_len\":14575,\"modified_ms\":1757131347721,\"file_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\",\"tracking_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.071263Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, parent_id: cdd0b50c-2bb0-4b80-9a1b-d4e906ca0fc3, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"src/lib.rs\",\"exists\":true,\"byte_len\":14575,\"modified_ms\":1757131347721,\"file_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\",\"tracking_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.071920Z  INFO ploke_tui::llm::session: close, time.busy: 1.14ms, time.idle: 3.81µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 43a53d7f-e3b1-4d0a-843e-761eb84f1520, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.071978Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"src/lib.rs\",\"exists\":true,\"byte_len\":14575,\"modified_ms\":1757131347721,\"file_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\",\"tracking_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.071994Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"src/lib.rs\",\"exists\":true,\"byte_len\":14575,\"modified_ms\":1757131347721,\"file_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\",\"tracking_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.072052Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.072059Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseOuterPoint = inner::OuterPoint;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod impls;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type ConstRawPtr = *const u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInner = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please help me understand how to use tools in this system.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"src/lib.rs\",\"exists\":true,\"byte_len\":14575,\"modified_ms\":1757131347721,\"file_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\",\"tracking_hash\":\"da401d2b-246b-5bb0-8fdb-4d562bc65ad2\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.072278Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.199434Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.199480Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.199498Z  INFO ploke_rag::core: close, time.busy: 280ms, time.idle: 6.38µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.199542Z  INFO ploke_rag::core: close, time.busy: 48.1µs, time.idle: 280ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.199607Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.250971Z  INFO ploke_rag::core: close, time.busy: 50.6µs, time.idle: 34.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.251146Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.352919Z  INFO ploke_rag::core: close, time.busy: 48.0µs, time.idle: 34.6µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.353090Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.353514Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.445692Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.445933Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.445959Z DEBUG ploke_embed::local: close, time.busy: 92.8ms, time.idle: 2.90µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.632986Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.633034Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.633053Z  INFO ploke_rag::core: close, time.busy: 280ms, time.idle: 6.25µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.633067Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 20
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.633078Z  INFO ploke_rag::core: close, time.busy: 281ms, time.idle: 433ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.668136Z  INFO ploke_rag::context: close, time.busy: 29.4ms, time.idle: 5.64ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(14)
    in ploke_rag::context::assemble_context with query_len: 12, hits: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.668197Z  INFO ploke_rag::core: close, time.busy: 590ms, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(14)
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.668237Z  INFO ploke_tui::tools::request_code_context: Executed Tool: RequestCodeContext 
With stats: ContextStats {
    total_tokens: 320,
    files: 20,
    parts: 20,
    truncated_parts: 0,
    dedup_removed: 0,
}
    at crates/ploke-tui/src/tools/request_code_context.rs:180 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.668357Z DEBUG dbg_tools: content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}"

    at crates/ploke-tui/src/tools/mod.rs:252 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.668434Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, parent_id: a91cb556-2ee4-4959-8f99-c92f59b22076, call_id: "functions.request_code_context:0", content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669172Z  INFO ploke_tui::llm::session: close, time.busy: 750ms, time.idle: 2.03µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: dfcd8066-65a0-4f99-8ab4-8582f76c1335, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669211Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.request_code_context:0",
            Ok(
                "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669239Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.request_code_context:0",
        Ok(
            "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669303Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669318Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner_mod {\n    // Constant visible only within the crate, defined inside an inline module.\n    pub(crate) const INNER_CONST: u8 = 1;\n\n    // Static mutable boolean visible only to the parent module (`crate`), defined inside an inline module.\n    #[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SuperTrait: SimpleTrait {\n    fn super_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you find any code snippets related to SimpleStruct in the codebase?",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
                tool_call_id: Some(
                    "functions.request_code_context:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.669611Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.995435Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138738-dY9GdHnYCwknAUMplJtB",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "The `Cargo.toml` file exists and is approximately 2.3KB in size, last modified recently.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138738,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1688,
            completion_tokens: 23,
            total_tokens: 1711,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.995587Z  INFO ploke_tui::llm::session: close, time.busy: 2.98s, time.idle: 5.82µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.995720Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)

  2025-09-06T06:05:39.995815Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)

  2025-09-06T06:05:39.997865Z  INFO ploke_tui::llm: close, time.busy: 2.98ms, time.idle: 2.98s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.997917Z  INFO ploke_tui::llm: LLM produced response for parent_id=ed182751-f610-47ce-846f-68da37db3cb9 -> assistant_message_id=1323c3da-86ed-4767-9db8-a075f93a8f2a. preview=The `Cargo.toml` file exists and is approximately 2.3KB in size, last modified recently.
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.997955Z  INFO ploke_tui::llm: close, time.busy: 3.15ms, time.idle: 2.98s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:39.998024Z  INFO ploke_tui::app_state::handlers::chat: Updating message 1323c3da-86ed-4767-9db8-a075f93a8f2a status=Some(Completed) content_preview=The `Cargo.toml` file exists and is approximately 2.3KB in size, last modified recently.
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, msg_id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:39.998042Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, msg_id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:39.998072Z  INFO ploke_tui::event_bus: close, time.busy: 9.75µs, time.idle: 3.78µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, msg_id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:39.998093Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 68.3µs, time.idle: 6.72µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, msg_id: 1323c3da-86ed-4767-9db8-a075f93a8f2a, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:39.998107Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 98.7µs, time.idle: 4.77µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:39.998162Z  INFO ploke_tui::event_bus: close, time.busy: 2.52µs, time.idle: 2.47µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a71173b7-684a-4994-b180-9d3d5dbd5fbb, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:39.998182Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 41.1µs, time.idle: 6.39µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a71173b7-684a-4994-b180-9d3d5dbd5fbb, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:39.998196Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 68.8µs, time.idle: 4.08µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.203836Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138739-MSX1co7vCXCzGtAUqPgf",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "The `Cargo.toml` file is **2,315 bytes** in size.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138739,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1834,
            completion_tokens: 17,
            total_tokens: 1851,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.203954Z  INFO ploke_tui::llm::session: close, time.busy: 3.23s, time.idle: 3.59µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.204062Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(13)

  2025-09-06T06:05:40.204165Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(13)

  2025-09-06T06:05:40.206168Z  INFO ploke_tui::llm: close, time.busy: 3.19ms, time.idle: 3.23s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.206210Z  INFO ploke_tui::llm: LLM produced response for parent_id=63743972-bc30-457a-9b47-dc3719cda6ee -> assistant_message_id=7055d674-b929-48f9-ac01-332d1c00cc2b. preview=The `Cargo.toml` file is **2,315 bytes** in size.
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(13)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.206246Z  INFO ploke_tui::llm: close, time.busy: 3.37ms, time.idle: 3.23s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(13)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.206326Z  INFO ploke_tui::app_state::handlers::chat: Updating message 7055d674-b929-48f9-ac01-332d1c00cc2b status=Some(Completed) content_preview=The `Cargo.toml` file is **2,315 bytes** in size.
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7055d674-b929-48f9-ac01-332d1c00cc2b, msg_id: 7055d674-b929-48f9-ac01-332d1c00cc2b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.206345Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 7055d674-b929-48f9-ac01-332d1c00cc2b, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7055d674-b929-48f9-ac01-332d1c00cc2b, msg_id: 7055d674-b929-48f9-ac01-332d1c00cc2b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.206370Z  INFO ploke_tui::event_bus: close, time.busy: 9.14µs, time.idle: 2.83µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 7055d674-b929-48f9-ac01-332d1c00cc2b, msg_id: 7055d674-b929-48f9-ac01-332d1c00cc2b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.206389Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 64.2µs, time.idle: 6.71µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7055d674-b929-48f9-ac01-332d1c00cc2b, msg_id: 7055d674-b929-48f9-ac01-332d1c00cc2b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.206402Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 103µs, time.idle: 3.84µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.206450Z  INFO ploke_tui::event_bus: close, time.busy: 2.65µs, time.idle: 2.46µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 30466089-ff44-4204-8aee-9c642690f1d5, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.206466Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 38.2µs, time.idle: 4.73µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 30466089-ff44-4204-8aee-9c642690f1d5, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.206476Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 60.8µs, time.idle: 2.42µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.367106Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-mZuL80SdIoCUFUAih0z0",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Hi! I'm here to help you with your Rust project. I can see you're working with const/static items, imports, traits, and various other Rust features based on the code context.\n\nWhat specific part of your Rust project would you like help with? Are you looking to:\n- Add new functionality or modify existing code?\n- Troubleshoot compilation issues?\n- Refactor or reorganize your code structure?\n- Add documentation or tests?\n- Understand how to use certain features or patterns?\n\nLet me know what you'd like to tackle and I'll be happy to assist!",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1749,
            completion_tokens: 112,
            total_tokens: 1861,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.367223Z  INFO ploke_tui::llm::session: close, time.busy: 3.26s, time.idle: 3.34µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.367341Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(5)

  2025-09-06T06:05:40.367414Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(5)

  2025-09-06T06:05:40.369512Z  INFO ploke_tui::llm: close, time.busy: 2.36ms, time.idle: 3.26s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.369550Z  INFO ploke_tui::llm: LLM produced response for parent_id=e7be9bf6-9aee-4541-9ccf-3eef72e31445 -> assistant_message_id=602aacfc-f4c5-4443-ae34-4d6222151a91. preview=Hi! I'm here to help you with your Rust project. I can see you're working with const/static items, imports, traits, and various other Rust features based on the code context.

What specific part of yo
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.369583Z  INFO ploke_tui::llm: close, time.busy: 2.56ms, time.idle: 3.26s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.369650Z  INFO ploke_tui::app_state::handlers::chat: Updating message 602aacfc-f4c5-4443-ae34-4d6222151a91 status=Some(Completed) content_preview=Hi! I'm here to help you with your Rust project. I can see you're working with const/static items, i...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 602aacfc-f4c5-4443-ae34-4d6222151a91, msg_id: 602aacfc-f4c5-4443-ae34-4d6222151a91, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.369666Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 602aacfc-f4c5-4443-ae34-4d6222151a91, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 602aacfc-f4c5-4443-ae34-4d6222151a91, msg_id: 602aacfc-f4c5-4443-ae34-4d6222151a91, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.369688Z  INFO ploke_tui::event_bus: close, time.busy: 7.03µs, time.idle: 2.71µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 602aacfc-f4c5-4443-ae34-4d6222151a91, msg_id: 602aacfc-f4c5-4443-ae34-4d6222151a91, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.369705Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 57.2µs, time.idle: 5.47µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 602aacfc-f4c5-4443-ae34-4d6222151a91, msg_id: 602aacfc-f4c5-4443-ae34-4d6222151a91, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.369716Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 83.5µs, time.idle: 3.85µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.369764Z  INFO ploke_tui::event_bus: close, time.busy: 2.48µs, time.idle: 2.52µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f579140-4099-4e2d-99d7-408ab85e562b, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.369781Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 38.5µs, time.idle: 4.83µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f579140-4099-4e2d-99d7-408ab85e562b, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.369791Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 62.1µs, time.idle: 2.35µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.413225Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138737-yfdDUFpmRIdQbwoI2tms",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Hello! I'd be happy to help you with your Rust files. From what I can see in the context provided, you have various Rust code snippets including:\n\n- Type aliases (SimpleId, MyInt, etc.)\n- Structs and unions\n- Static variables\n- Trait implementations\n- Module definitions\n\nCould you tell me more specifically what kind of help you need? For example:\n- Are you looking to add new functionality?\n- Do you need to fix bugs in existing code?\n- Are you trying to organize or refactor the code?\n- Do you need help understanding how certain parts work?\n\nPlease let me know what files or specific issues you'd like assistance with!",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138737,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1367,
            completion_tokens: 134,
            total_tokens: 1501,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.413409Z  INFO ploke_tui::llm::session: close, time.busy: 3.44s, time.idle: 5.00µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.413546Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)

  2025-09-06T06:05:40.413656Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)

  2025-09-06T06:05:40.414569Z  INFO ploke_tui::llm: close, time.busy: 3.02ms, time.idle: 3.44s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.414586Z  INFO ploke_tui::llm: LLM produced response for parent_id=51488eb3-f595-48f7-b044-3ce0ae4f26b7 -> assistant_message_id=f5078ebf-6ffb-4155-83ad-e54d01564a5c. preview=Hello! I'd be happy to help you with your Rust files. From what I can see in the context provided, you have various Rust code snippets including:

- Type aliases (SimpleId, MyInt, etc.)
- Structs and 
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.414607Z  INFO ploke_tui::llm: close, time.busy: 3.16ms, time.idle: 3.44s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:40.414651Z  INFO ploke_tui::app_state::handlers::chat: Updating message f5078ebf-6ffb-4155-83ad-e54d01564a5c status=Some(Completed) content_preview=Hello! I'd be happy to help you with your Rust files. From what I can see in the context provided, y...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, msg_id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.414660Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, msg_id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.414673Z  INFO ploke_tui::event_bus: close, time.busy: 4.19µs, time.idle: 1.42µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, msg_id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.414682Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 32.4µs, time.idle: 2.84µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, msg_id: f5078ebf-6ffb-4155-83ad-e54d01564a5c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.414688Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 47.3µs, time.idle: 1.95µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:40.414717Z  INFO ploke_tui::event_bus: close, time.busy: 1.61µs, time.idle: 1.25µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: db5fc40d-075c-4ff6-a2f1-6fc4cd815eee, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.414725Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 23.2µs, time.idle: 2.60µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: db5fc40d-075c-4ff6-a2f1-6fc4cd815eee, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:40.414732Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 36.9µs, time.idle: 1.22µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:41.078971Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138739-qHhEQm6QEkB0kRbZqk1q",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I successfully retrieved the file metadata for `Cargo.toml`. Here are the details you requested:\n\n- **File path**: Cargo.toml\n- **File size**: 2,315 bytes\n- **Tracking hash**: 9a41bf9f-0790-5e5c-abb8-403dfe4901cd\n\nThe file appears to be present in the current directory and the tracking hash matches the file hash.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138739,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1778,
            completion_tokens: 87,
            total_tokens: 1865,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:41.079093Z  INFO ploke_tui::llm::session: close, time.busy: 3.93s, time.idle: 3.46µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:41.079196Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(12)

  2025-09-06T06:05:41.079256Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(12)

  2025-09-06T06:05:41.080122Z  INFO ploke_tui::llm: close, time.busy: 3.30ms, time.idle: 3.93s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:41.080140Z  INFO ploke_tui::llm: LLM produced response for parent_id=70ee5206-9861-4775-bc14-2acad3c2a37f -> assistant_message_id=68ad842c-5778-4675-a5d9-7dc3687adcb6. preview=I successfully retrieved the file metadata for `Cargo.toml`. Here are the details you requested:

- **File path**: Cargo.toml
- **File size**: 2,315 bytes
- **Tracking hash**: 9a41bf9f-0790-5e5c-abb8-
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(12)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:41.080159Z  INFO ploke_tui::llm: close, time.busy: 3.43ms, time.idle: 3.93s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(12)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:41.080202Z  INFO ploke_tui::app_state::handlers::chat: Updating message 68ad842c-5778-4675-a5d9-7dc3687adcb6 status=Some(Completed) content_preview=I successfully retrieved the file metadata for `Cargo.toml`. Here are the details you requested:

- ...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, msg_id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:41.080211Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, msg_id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:41.080223Z  INFO ploke_tui::event_bus: close, time.busy: 3.79µs, time.idle: 1.33µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, msg_id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:41.080233Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 32.4µs, time.idle: 2.80µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, msg_id: 68ad842c-5778-4675-a5d9-7dc3687adcb6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:41.080239Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 46.8µs, time.idle: 2.01µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:41.080266Z  INFO ploke_tui::event_bus: close, time.busy: 1.31µs, time.idle: 1.23µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 28abf007-c773-4103-8e23-bc145961582a, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:41.080274Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 21.5µs, time.idle: 2.50µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 28abf007-c773-4103-8e23-bc145961582a, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:41.080280Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 35.0µs, time.idle: 1.17µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:42.225497Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138738-pTl37Td3MRhvMthQb6Lx",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I've retrieved the metadata for the `Cargo.toml` file:\n\n**File Path:** `Cargo.toml`  \n**Exists:** ✅ Yes  \n**Byte Length:** 2,315 bytes  \n**Last Modified:** 1/2/2025, 9:57:28 PM  \n**File Hash:** `9a41bf9f-0790-5e5c-abb8-403dfe4901cd`  \n**Tracking Hash:** `9a41bf9f-0790-5e5c-abb8-403dfe4901cd`  \n\nThe file is valid and matches its stored hash, indicating it hasn't been modified since it was last tracked.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138738,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1700,
            completion_tokens: 139,
            total_tokens: 1839,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:42.225618Z  INFO ploke_tui::llm::session: close, time.busy: 5.10s, time.idle: 6.35µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:42.225749Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(10)

  2025-09-06T06:05:42.225839Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(10)

  2025-09-06T06:05:42.227827Z  INFO ploke_tui::llm: close, time.busy: 3.56ms, time.idle: 5.09s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:42.227873Z  INFO ploke_tui::llm: LLM produced response for parent_id=f05fa0cb-13b3-4033-80a4-9406a6bb98db -> assistant_message_id=3da27562-78bb-461a-8984-9c1921b33d43. preview=I've retrieved the metadata for the `Cargo.toml` file:

**File Path:** `Cargo.toml`  
**Exists:** ✅ Yes  
**Byte Length:** 2,315 bytes  
**Last Modified:** 1/2/2025, 9:57:28 PM  
**File Hash:** `9a41b
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(10)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:42.227913Z  INFO ploke_tui::llm: close, time.busy: 3.75ms, time.idle: 5.09s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(10)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:42.228106Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 124µs, time.idle: 6.64µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::update_message with id: 3da27562-78bb-461a-8984-9c1921b33d43, msg_id: 3da27562-78bb-461a-8984-9c1921b33d43, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:42.228122Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 157µs, time.idle: 4.17µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:44.983753Z  INFO ploke_tui::event_bus: close, time.busy: 32.4µs, time.idle: 14.6µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:44.983868Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 8c44f6a9-b65d-4d6a-8947-b89b4ed2b528, parent_id: 6377bd5f-ffb6-4387-a977-d141333fb589, call_id: "{\n        \"file_path\": \"Cargo.toml\",\n        \"exists\": true,\n        \"size\": 1234,\n        \"modified\": \"2025-09-01T05:00:00Z\",\n        \"tracking_hash\": \"abc123def456\"\n    }", content: "get_file_metadata" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(13)

  2025-09-06T06:05:45.035463Z  INFO ploke_tui::event_bus: close, time.busy: 31.8µs, time.idle: 14.9µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:45.038315Z  INFO ploke_tui::event_bus: close, time.busy: 7.83µs, time.idle: 10.2µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, content: "Can you get metadata for Cargo.toml?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.038405Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 0f549c29-34d1-4e23-a33f-8a2f0532b7b3,
                parent_id: db5fc40d-075c-4ff6-a2f1-6fc4cd815eee
                message_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, content: "Can you get metadata for Cargo.toml?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.038475Z  INFO ploke_tui::event_bus: close, time.busy: 16.9µs, time.idle: 8.66µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, content: "Can you get metadata for Cargo.toml?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.038498Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 219µs, time.idle: 5.76µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, content: "Can you get metadata for Cargo.toml?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.038513Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 254µs, time.idle: 5.20µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.038545Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.042089Z  INFO ploke_tui::llm: Received LLM request for parent_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3
new_msg_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.047020Z  INFO ploke_tui::event_bus: close, time.busy: 9.52µs, time.idle: 5.17µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:45.047202Z  INFO ploke_tui::llm::session: close, time.busy: 7.94s, time.idle: 2.98µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:45.047231Z  INFO ploke_tui::llm: close, time.busy: 2.92ms, time.idle: 7.94s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:45.047926Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.047957Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 9.42ms, time.idle: 3.25µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.048365Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.052900Z  INFO ploke_tui::llm: close, time.busy: 8.74ms, time.idle: 7.94s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(8)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:45.061272Z  INFO ploke_tui::event_bus: close, time.busy: 7.28µs, time.idle: 3.58µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9b1ab735-5838-464f-a540-b0f16913ecdd, content: "I need to check some file information", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.061292Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 9b1ab735-5838-464f-a540-b0f16913ecdd,
                parent_id: 2f579140-4099-4e2d-99d7-408ab85e562b
                message_id: 9b1ab735-5838-464f-a540-b0f16913ecdd,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9b1ab735-5838-464f-a540-b0f16913ecdd, content: "I need to check some file information", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.061302Z  INFO ploke_tui::event_bus: close, time.busy: 2.07µs, time.idle: 1.37µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9b1ab735-5838-464f-a540-b0f16913ecdd, content: "I need to check some file information", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.061314Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 65.6µs, time.idle: 2.79µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9b1ab735-5838-464f-a540-b0f16913ecdd, content: "I need to check some file information", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.061322Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 84.0µs, time.idle: 4.00µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.061332Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.063973Z  INFO ploke_tui::llm: Received LLM request for parent_id: 9b1ab735-5838-464f-a540-b0f16913ecdd
new_msg_id: 9b1ab735-5838-464f-a540-b0f16913ecdd
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.069412Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.069437Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 8.10ms, time.idle: 2.77µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.069769Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.080412Z  INFO ploke_tui::event_bus: close, time.busy: 7.68µs, time.idle: 2.88µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, content: "Now get metadata for README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.080439Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): e90d8f42-85c5-48fb-8c1d-a97903934f78,
                parent_id: a71173b7-684a-4994-b180-9d3d5dbd5fbb
                message_id: e90d8f42-85c5-48fb-8c1d-a97903934f78,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, content: "Now get metadata for README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.080450Z  INFO ploke_tui::event_bus: close, time.busy: 2.23µs, time.idle: 1.38µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, content: "Now get metadata for README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.080458Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 68.3µs, time.idle: 2.73µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, content: "Now get metadata for README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.080464Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 86.9µs, time.idle: 4.33µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:45.080476Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.083714Z  INFO ploke_tui::llm: Received LLM request for parent_id: e90d8f42-85c5-48fb-8c1d-a97903934f78
new_msg_id: e90d8f42-85c5-48fb-8c1d-a97903934f78
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.089633Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.089670Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 9.19ms, time.idle: 2.73µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:45.089938Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.211569Z DEBUG ploke_embed::local: shapes: outputs=[1, 12, 384], weights=[1, 12, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.212039Z DEBUG ploke_embed::local: shapes: outputs=[1, 12, 384], weights=[1, 12, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.212076Z DEBUG ploke_embed::local: close, time.busy: 164ms, time.idle: 3.41µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.219895Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.220343Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.220372Z DEBUG ploke_embed::local: close, time.busy: 151ms, time.idle: 2.59µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.246773Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.247147Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.247176Z DEBUG ploke_embed::local: close, time.busy: 157ms, time.idle: 2.54µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.425807Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.425852Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.425875Z  INFO ploke_rag::core: close, time.busy: 378ms, time.idle: 7.08µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.425949Z  INFO ploke_rag::core: close, time.busy: 27.8µs, time.idle: 378ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.426038Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.442721Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.442763Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.442781Z  INFO ploke_rag::core: close, time.busy: 373ms, time.idle: 5.54µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.442827Z  INFO ploke_rag::core: close, time.busy: 22.9µs, time.idle: 373ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.442887Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.466704Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.466746Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.466763Z  INFO ploke_rag::core: close, time.busy: 377ms, time.idle: 5.00µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.466804Z  INFO ploke_rag::core: close, time.busy: 19.0µs, time.idle: 377ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.466863Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.477276Z  INFO ploke_rag::core: close, time.busy: 26.2µs, time.idle: 22.4µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.477488Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.494659Z  INFO ploke_rag::core: close, time.busy: 50.6µs, time.idle: 35.6µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.494841Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.518615Z  INFO ploke_rag::core: close, time.busy: 61.5µs, time.idle: 38.4µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.518796Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.579138Z  INFO ploke_rag::core: close, time.busy: 50.7µs, time.idle: 35.9µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.579335Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.579774Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.595875Z  INFO ploke_rag::core: close, time.busy: 21.6µs, time.idle: 21.0µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.595956Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.596263Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.619069Z  INFO ploke_rag::core: close, time.busy: 22.2µs, time.idle: 20.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.619150Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.619439Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.740654Z DEBUG ploke_embed::local: shapes: outputs=[1, 12, 384], weights=[1, 12, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.741363Z DEBUG ploke_embed::local: shapes: outputs=[1, 12, 384], weights=[1, 12, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.741436Z DEBUG ploke_embed::local: close, time.busy: 162ms, time.idle: 3.76µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.744492Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.744827Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.744853Z DEBUG ploke_embed::local: close, time.busy: 149ms, time.idle: 2.94µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.768508Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.768871Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.768939Z DEBUG ploke_embed::local: close, time.busy: 150ms, time.idle: 3.08µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.961207Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.961251Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.961270Z  INFO ploke_rag::core: close, time.busy: 382ms, time.idle: 7.30µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 36, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.961283Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.961293Z  INFO ploke_rag::core: close, time.busy: 382ms, time.idle: 531ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 36, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.967623Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.967670Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.967693Z  INFO ploke_rag::core: close, time.busy: 372ms, time.idle: 6.59µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 37, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.967710Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.967723Z  INFO ploke_rag::core: close, time.busy: 372ms, time.idle: 526ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 37, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.976145Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.976202Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.976224Z  INFO ploke_rag::core: close, time.busy: 357ms, time.idle: 6.53µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.976240Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:45.976253Z  INFO ploke_rag::core: close, time.busy: 358ms, time.idle: 529ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002374Z  INFO ploke_rag::context: close, time.busy: 37.1ms, time.idle: 3.93ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 36, hits: 15
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002404Z  INFO ploke_rag::core: close, time.busy: 798ms, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 36, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002412Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002426Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002456Z  INFO ploke_tui::event_bus: close, time.busy: 9.75µs, time.idle: 1.94µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002467Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 954ms, time.idle: 3.16µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.002489Z  INFO ploke_tui::llm: Received context for parent_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(6)

  2025-09-06T06:05:46.002503Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(6)

  2025-09-06T06:05:46.002508Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(6)

  2025-09-06T06:05:46.002519Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(6)

  2025-09-06T06:05:46.002561Z  INFO ploke_tui::event_bus: close, time.busy: 2.11µs, time.idle: 1.26µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.002568Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 21.9µs, time.idle: 1.25µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.002585Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002608Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002635Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002678Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002701Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002710Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeTrait {\n    type Output;\n    fn generate(&self) -> Self::Output;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you get metadata for Cargo.toml?",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.002977Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015283Z  INFO ploke_rag::context: close, time.busy: 33.8ms, time.idle: 5.21ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(9)
    in ploke_rag::context::assemble_context with query_len: 30, hits: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015314Z  INFO ploke_rag::core: close, time.busy: 768ms, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(9)
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015321Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015331Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015351Z  INFO ploke_tui::event_bus: close, time.busy: 6.57µs, time.idle: 1.99µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015360Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 926ms, time.idle: 3.24µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.015377Z  INFO ploke_tui::llm: Received context for parent_id: e90d8f42-85c5-48fb-8c1d-a97903934f78
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(9)

  2025-09-06T06:05:46.015386Z  INFO ploke_tui::llm: pending_requests found match for req_parent: e90d8f42-85c5-48fb-8c1d-a97903934f78
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(9)

  2025-09-06T06:05:46.015391Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: e90d8f42-85c5-48fb-8c1d-a97903934f78
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(9)

  2025-09-06T06:05:46.015400Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(9)

  2025-09-06T06:05:46.015436Z  INFO ploke_tui::event_bus: close, time.busy: 2.09µs, time.idle: 1.30µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.015443Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.4µs, time.idle: 1.23µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.015457Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015475Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015495Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015529Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015548Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015556Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[derive(Debug)]\npub struct AttributedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[deprecated(note = \"Use NewId instead\")]\npub type OldId = String;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// An enum with a doc comment.\n/// This is a documented enum\npub enum DocumentedEnum {\n    Variant1,\n    Variant2,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SampleStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct NestedItem;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod nested_sub {\n        pub struct NestedItem;\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[must_use = \"Trait results should be used\"]\npub trait AttributedTrait {\n    fn calculate(&self) -> f64;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Now get metadata for README.md",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.015769Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020382Z  INFO ploke_rag::context: close, time.busy: 46.8ms, time.idle: 5.82ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(5)
    in ploke_rag::context::assemble_context with query_len: 37, hits: 15
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020411Z  INFO ploke_rag::core: close, time.busy: 792ms, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(5)
    in ploke_rag::core::get_context with query_len: 37, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020423Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020437Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020462Z  INFO ploke_tui::event_bus: close, time.busy: 7.89µs, time.idle: 2.65µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020472Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 951ms, time.idle: 3.79µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:46.020491Z  INFO ploke_tui::llm: Received context for parent_id: 9b1ab735-5838-464f-a540-b0f16913ecdd
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(5)

  2025-09-06T06:05:46.020501Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 9b1ab735-5838-464f-a540-b0f16913ecdd
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(5)

  2025-09-06T06:05:46.020506Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 9b1ab735-5838-464f-a540-b0f16913ecdd
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(5)

  2025-09-06T06:05:46.020517Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(5)

  2025-09-06T06:05:46.020556Z  INFO ploke_tui::event_bus: close, time.busy: 2.25µs, time.idle: 1.43µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.020563Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 20.1µs, time.idle: 1.28µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:46.020581Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020600Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020619Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020652Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020673Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020681Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum solely for testing multi-field tuple variants.\npub enum OnlyTupleVariants {\n    Point(i32, i32, i32),\n    Color(u8, u8, u8, u8),\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type MutStrSlice<'a> = &'a mut str;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "I need to check some file information",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:46.020886Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.527703Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138746-HpKJGVVYbRTRsANVvQeZ",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for the Cargo.toml file for you.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138746,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1624,
            completion_tokens: 32,
            total_tokens: 1656,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.527882Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.527948Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.528979Z  INFO ploke_tui::event_bus: close, time.busy: 5.84µs, time.idle: 5.06µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529007Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529029Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, parent_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529049Z DEBUG dbg_tools: Processing tool, request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529062Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529070Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529234Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.529255Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, parent_id: 0f549c29-34d1-4e23-a33f-8a2f0532b7b3, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530116Z  INFO ploke_tui::llm::session: close, time.busy: 1.11ms, time.idle: 2.12µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: bcc115f9-3d11-4012-8d23-45c6ae4ee141, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530150Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530162Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530218Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530228Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeTrait {\n    type Output;\n    fn generate(&self) -> Self::Output;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you get metadata for Cargo.toml?",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.530508Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.546899Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138746-nVRbAdeuHoaEJ3AGUCTI",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for README.md for you.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"README.md\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138746,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1485,
            completion_tokens: 30,
            total_tokens: 1515,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547021Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547054Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547681Z  INFO ploke_tui::event_bus: close, time.busy: 5.97µs, time.idle: 4.47µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547705Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547726Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, parent_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547743Z DEBUG dbg_tools: Processing tool, request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"README.md\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547755Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "README.md",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547764Z DEBUG dbg_tools: path: README.md
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.547987Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548011Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, parent_id: e90d8f42-85c5-48fb-8c1d-a97903934f78, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548594Z  INFO ploke_tui::llm::session: close, time.busy: 887µs, time.idle: 2.95µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 3559ddd0-6e18-41de-bdbc-d59fa348b69b, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548629Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548641Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548691Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548700Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[derive(Debug)]\npub struct AttributedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[deprecated(note = \"Use NewId instead\")]\npub type OldId = String;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// An enum with a doc comment.\n/// This is a documented enum\npub enum DocumentedEnum {\n    Variant1,\n    Variant2,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SampleStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct NestedItem;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod nested_sub {\n        pub struct NestedItem;\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[must_use = \"Trait results should be used\"]\npub trait AttributedTrait {\n    fn calculate(&self) -> f64;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Now get metadata for README.md",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.548902Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.593728Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138739-YtCOwZLBsXocXshd1CcV",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I found several code snippets related to `SimpleStruct` in the codebase:\n\n## Struct Definitions\nThere appear to be **two different struct definitions** with the same name:\n\n1. **Private struct** (file: id://8a0a1e1e-499e-555b-8b07-44fc00f88124):\n   ```rust\n   struct SimpleStruct {\n       x: i32,\n       y: bool,\n   }\n   ```\n\n2. **Public struct** (file: id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39):\n   ```rust\n   pub struct SimpleStruct {\n       pub data: i32,\n   }\n   ```\n\n## Struct Instantiation\nA constant instance using the **first struct definition** (file: id://3bfe5b6b-2541-5397-ac35-c66d50dcba02):\n```rust\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\n```\n\n## Method Implementation\nAn implementation block within an inner module (file: id://18d39d51-d490-568d-ad38-ae6703cc1a6d):\n```rust\nmod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}\n```\n\n### Observations:\n- There are two distinct `SimpleStruct` definitions, which will create a naming conflict\n- The constant `STRUCT_CONST` uses the private struct definition with fields `x` and `y`\n- The `impl` block in the `inner` module appears to reference the public struct with field `data`\n- Both structs use `i32` fields but have different visibility and field layouts\n\nThis seems like it might be an unresolved naming collision in the codebase.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138739,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 3104,
            completion_tokens: 457,
            total_tokens: 3561,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.593853Z  INFO ploke_tui::llm::session: close, time.busy: 10.5s, time.idle: 4.17µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.593992Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(14)

  2025-09-06T06:05:47.594054Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(14)

  2025-09-06T06:05:47.603998Z  INFO ploke_tui::llm: close, time.busy: 3.69ms, time.idle: 10.5s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.604056Z  INFO ploke_tui::llm: LLM produced response for parent_id=a91cb556-2ee4-4959-8f99-c92f59b22076 -> assistant_message_id=486a7375-662e-4cbc-9c3f-183497c5ca4f. preview=I found several code snippets related to `SimpleStruct` in the codebase:

## Struct Definitions
There appear to be **two different struct definitions** with the same name:

1. **Private struct** (file
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(14)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.604097Z  INFO ploke_tui::llm: close, time.busy: 3.98ms, time.idle: 10.5s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(14)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.604169Z  INFO ploke_tui::app_state::handlers::chat: Updating message 486a7375-662e-4cbc-9c3f-183497c5ca4f status=Some(Completed) content_preview=I found several code snippets related to `SimpleStruct` in the codebase:

## Struct Definitions
Ther...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, msg_id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.604189Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, msg_id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.604213Z  INFO ploke_tui::event_bus: close, time.busy: 9.12µs, time.idle: 2.86µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, msg_id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.604229Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 62.4µs, time.idle: 5.33µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, msg_id: 486a7375-662e-4cbc-9c3f-183497c5ca4f, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.604240Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 88.4µs, time.idle: 3.94µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.604288Z  INFO ploke_tui::event_bus: close, time.busy: 2.67µs, time.idle: 2.50µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 8d9c6960-453c-49b3-a8fe-44bae043d1b5, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:47.604318Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 39.8µs, time.idle: 16.7µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 8d9c6960-453c-49b3-a8fe-44bae043d1b5, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:47.604329Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 75.8µs, time.idle: 2.33µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:47.704790Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138746-NMvhGTHyVm6RDrWSbgIN",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I can help you check file information! I have access to a function that can fetch file metadata like the current tracking hash for safe edits.\n\nCould you please tell me which specific file you'd like me to check? Just provide the absolute path or workspace-relative path to the file you're interested in.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138746,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1538,
            completion_tokens: 59,
            total_tokens: 1597,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.704924Z  INFO ploke_tui::llm::session: close, time.busy: 1.68s, time.idle: 4.05µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.705039Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(5)

  2025-09-06T06:05:47.705107Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(5)

  2025-09-06T06:05:47.706242Z  INFO ploke_tui::llm: close, time.busy: 1.01ms, time.idle: 1.68s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.706259Z  INFO ploke_tui::llm: LLM produced response for parent_id=9b1ab735-5838-464f-a540-b0f16913ecdd -> assistant_message_id=c9edbbe5-cae5-4e4f-911e-35f48f010d52. preview=I can help you check file information! I have access to a function that can fetch file metadata like the current tracking hash for safe edits.

Could you please tell me which specific file you'd like 
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.706279Z  INFO ploke_tui::llm: close, time.busy: 1.11ms, time.idle: 1.68s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:47.706327Z  INFO ploke_tui::app_state::handlers::chat: Updating message c9edbbe5-cae5-4e4f-911e-35f48f010d52 status=Some(Completed) content_preview=I can help you check file information! I have access to a function that can fetch file metadata like...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, msg_id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.706336Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, msg_id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.706348Z  INFO ploke_tui::event_bus: close, time.busy: 3.89µs, time.idle: 1.34µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, msg_id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.706358Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 32.5µs, time.idle: 2.88µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, msg_id: c9edbbe5-cae5-4e4f-911e-35f48f010d52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.706365Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 52.1µs, time.idle: 2.06µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:47.706390Z  INFO ploke_tui::event_bus: close, time.busy: 1.34µs, time.idle: 1.24µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5d8294d1-c1ef-4ebd-aa74-7d1a134e671d, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:47.706397Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 18.0µs, time.idle: 2.45µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5d8294d1-c1ef-4ebd-aa74-7d1a134e671d, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:47.706403Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 30.9µs, time.idle: 1.22µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:48.916301Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138747-epoYr85y7cqnuRgMucsW",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "The README.md file exists with a size of 7,215 bytes. It was last modified at timestamp 1756168189597 and has the tracking hash `f1f43839-60a0-521d-86ee-a730ed24d11d`.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138747,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1571,
            completion_tokens: 57,
            total_tokens: 1628,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:48.916455Z  INFO ploke_tui::llm::session: close, time.busy: 2.90s, time.idle: 4.80µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:48.916590Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)

  2025-09-06T06:05:48.916669Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)

  2025-09-06T06:05:48.918646Z  INFO ploke_tui::llm: close, time.busy: 1.77ms, time.idle: 2.90s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:48.918670Z  INFO ploke_tui::llm: LLM produced response for parent_id=e90d8f42-85c5-48fb-8c1d-a97903934f78 -> assistant_message_id=c9e8551f-d19b-4e06-9dfd-2b71f8068d0b. preview=The README.md file exists with a size of 7,215 bytes. It was last modified at timestamp 1756168189597 and has the tracking hash `f1f43839-60a0-521d-86ee-a730ed24d11d`.
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:48.918702Z  INFO ploke_tui::llm: close, time.busy: 1.90ms, time.idle: 2.90s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:48.918750Z  INFO ploke_tui::app_state::handlers::chat: Updating message c9e8551f-d19b-4e06-9dfd-2b71f8068d0b status=Some(Completed) content_preview=The README.md file exists with a size of 7,215 bytes. It was last modified at timestamp 175616818959...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, msg_id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:48.918760Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, msg_id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:48.918778Z  INFO ploke_tui::event_bus: close, time.busy: 5.69µs, time.idle: 2.16µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, msg_id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:48.918790Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 42.5µs, time.idle: 3.66µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, msg_id: c9e8551f-d19b-4e06-9dfd-2b71f8068d0b, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:48.918799Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 61.3µs, time.idle: 2.52µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:48.918829Z  INFO ploke_tui::event_bus: close, time.busy: 1.59µs, time.idle: 1.26µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4ed2ad49-4a2c-42ce-a286-84ac786c602d, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:48.918840Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 21.6µs, time.idle: 3.29µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4ed2ad49-4a2c-42ce-a286-84ac786c602d, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:48.918849Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 38.7µs, time.idle: 1.99µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:49.453132Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138747-opjKjHsRnuzsXxbW85gY",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Here's the metadata for Cargo.toml:\n- **File exists**: ✅\n- **File path**: Cargo.toml  \n- **Byte length**: 2,315 bytes\n- **Modified**: January 4, 2025\n- **Hash/Tracking ID**: 9a41bf9f-0790-5e5c-abb8-403dfe4901cd",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138747,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1712,
            completion_tokens: 77,
            total_tokens: 1789,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:49.453268Z  INFO ploke_tui::llm::session: close, time.busy: 3.45s, time.idle: 4.23µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:49.453398Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)

  2025-09-06T06:05:49.453468Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)

  2025-09-06T06:05:49.455455Z  INFO ploke_tui::llm: close, time.busy: 2.11ms, time.idle: 3.45s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:49.455475Z  INFO ploke_tui::llm: LLM produced response for parent_id=0f549c29-34d1-4e23-a33f-8a2f0532b7b3 -> assistant_message_id=9c9ee85c-a9ca-4783-bb9f-a522a8621846. preview=Here's the metadata for Cargo.toml:
- **File exists**: ✅
- **File path**: Cargo.toml  
- **Byte length**: 2,315 bytes
- **Modified**: January 4, 2025
- **Hash/Tracking ID**: 9a41bf9f-0790-5e5c-abb8-40
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:49.455501Z  INFO ploke_tui::llm: close, time.busy: 2.23ms, time.idle: 3.45s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:49.455544Z  INFO ploke_tui::app_state::handlers::chat: Updating message 9c9ee85c-a9ca-4783-bb9f-a522a8621846 status=Some(Completed) content_preview=Here's the metadata for Cargo.toml:
- **File exists**: ✅
- **File path**: Cargo.toml  
- **Byte le...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, msg_id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:49.455553Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, msg_id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:49.455565Z  INFO ploke_tui::event_bus: close, time.busy: 4.08µs, time.idle: 1.41µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, msg_id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:49.455574Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 31.2µs, time.idle: 2.83µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, msg_id: 9c9ee85c-a9ca-4783-bb9f-a522a8621846, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:49.455580Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 46.6µs, time.idle: 1.97µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:49.455605Z  INFO ploke_tui::event_bus: close, time.busy: 1.34µs, time.idle: 1.31µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: be0d8f2e-c2f4-4bd0-9f54-f3adfe2b6d35, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:49.455613Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 18.4µs, time.idle: 2.52µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: be0d8f2e-c2f4-4bd0-9f54-f3adfe2b6d35, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:49.455618Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 31.1µs, time.idle: 1.21µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:53.056540Z  INFO ploke_tui::event_bus: close, time.busy: 33.7µs, time.idle: 16.4µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:55.040522Z  INFO ploke_tui::event_bus: close, time.busy: 25.4µs, time.idle: 4.42µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c9859b90-63a4-433e-90cc-e773d0eb459c, content: "What about the README.md file?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.040601Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): c9859b90-63a4-433e-90cc-e773d0eb459c,
                parent_id: be0d8f2e-c2f4-4bd0-9f54-f3adfe2b6d35
                message_id: c9859b90-63a4-433e-90cc-e773d0eb459c,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c9859b90-63a4-433e-90cc-e773d0eb459c, content: "What about the README.md file?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.040668Z  INFO ploke_tui::event_bus: close, time.busy: 16.7µs, time.idle: 9.83µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c9859b90-63a4-433e-90cc-e773d0eb459c, content: "What about the README.md file?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.040706Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 259µs, time.idle: 7.79µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c9859b90-63a4-433e-90cc-e773d0eb459c, content: "What about the README.md file?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.040729Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 321µs, time.idle: 21.9µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.040768Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.044325Z  INFO ploke_tui::llm: Received LLM request for parent_id: c9859b90-63a4-433e-90cc-e773d0eb459c
new_msg_id: c9859b90-63a4-433e-90cc-e773d0eb459c
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.049407Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.049442Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 8.68ms, time.idle: 3.98µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.049844Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.066495Z  INFO ploke_tui::event_bus: close, time.busy: 9.38µs, time.idle: 3.51µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, content: "Please get metadata for these files: Cargo.toml and README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.066526Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 2f862f55-feb9-4b7c-9d41-d22ea2216f7d,
                parent_id: 5d8294d1-c1ef-4ebd-aa74-7d1a134e671d
                message_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, content: "Please get metadata for these files: Cargo.toml and README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.066541Z  INFO ploke_tui::event_bus: close, time.busy: 2.91µs, time.idle: 2.08µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, content: "Please get metadata for these files: Cargo.toml and README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.066553Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 90.6µs, time.idle: 3.89µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, content: "Please get metadata for these files: Cargo.toml and README.md", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.066563Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 115µs, time.idle: 5.53µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:05:55.066578Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.069607Z  INFO ploke_tui::llm: Received LLM request for parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d
new_msg_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.071445Z  INFO ploke_tui::event_bus: close, time.busy: 8.93µs, time.idle: 4.95µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:55.075437Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.075458Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 8.88ms, time.idle: 2.35µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:05:55.075776Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.081427Z  INFO ploke_tui::event_bus: close, time.busy: 9.78µs, time.idle: 5.71µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send

  2025-09-06T06:05:55.188620Z DEBUG ploke_embed::local: shapes: outputs=[1, 11, 384], weights=[1, 11, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.189042Z DEBUG ploke_embed::local: shapes: outputs=[1, 11, 384], weights=[1, 11, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.189070Z DEBUG ploke_embed::local: close, time.busy: 140ms, time.idle: 2.77µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.244599Z DEBUG ploke_embed::local: shapes: outputs=[1, 18, 384], weights=[1, 18, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.245369Z DEBUG ploke_embed::local: shapes: outputs=[1, 18, 384], weights=[1, 18, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.245416Z DEBUG ploke_embed::local: close, time.busy: 170ms, time.idle: 2.73µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.389748Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.389791Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.389810Z  INFO ploke_rag::core: close, time.busy: 340ms, time.idle: 6.41µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.389876Z  INFO ploke_rag::core: close, time.busy: 28.1µs, time.idle: 340ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.389956Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.441115Z  INFO ploke_rag::core: close, time.busy: 18.8µs, time.idle: 16.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.441181Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.450160Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.450201Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.450217Z  INFO ploke_rag::core: close, time.busy: 375ms, time.idle: 4.92µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.450257Z  INFO ploke_rag::core: close, time.busy: 17.8µs, time.idle: 375ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.450355Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.501990Z  INFO ploke_rag::core: close, time.busy: 50.4µs, time.idle: 35.0µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.502184Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.543002Z  INFO ploke_rag::core: close, time.busy: 55.5µs, time.idle: 41.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.543209Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.543833Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.603510Z  INFO ploke_rag::core: close, time.busy: 47.9µs, time.idle: 25.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.603594Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.603886Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.671970Z DEBUG ploke_embed::local: shapes: outputs=[1, 11, 384], weights=[1, 11, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.672383Z DEBUG ploke_embed::local: shapes: outputs=[1, 11, 384], weights=[1, 11, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.672412Z DEBUG ploke_embed::local: close, time.busy: 129ms, time.idle: 3.40µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.767550Z DEBUG ploke_embed::local: shapes: outputs=[1, 18, 384], weights=[1, 18, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.768150Z DEBUG ploke_embed::local: shapes: outputs=[1, 18, 384], weights=[1, 18, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.768176Z DEBUG ploke_embed::local: close, time.busy: 165ms, time.idle: 2.58µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.876856Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.876911Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.876936Z  INFO ploke_rag::core: close, time.busy: 334ms, time.idle: 8.48µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 30, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.876952Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.876966Z  INFO ploke_rag::core: close, time.busy: 334ms, time.idle: 493ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 30, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914677Z  INFO ploke_rag::context: close, time.busy: 31.5ms, time.idle: 6.19ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 30, hits: 15
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914710Z  INFO ploke_rag::core: close, time.busy: 706ms, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 30, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914722Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914738Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914767Z  INFO ploke_tui::event_bus: close, time.busy: 10.6µs, time.idle: 2.40µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914782Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 865ms, time.idle: 3.81µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.914807Z  INFO ploke_tui::llm: Received context for parent_id: c9859b90-63a4-433e-90cc-e773d0eb459c
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(6)

  2025-09-06T06:05:55.914822Z  INFO ploke_tui::llm: pending_requests found match for req_parent: c9859b90-63a4-433e-90cc-e773d0eb459c
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(6)

  2025-09-06T06:05:55.914827Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: c9859b90-63a4-433e-90cc-e773d0eb459c
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(6)

  2025-09-06T06:05:55.914841Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(6)

  2025-09-06T06:05:55.914889Z  INFO ploke_tui::event_bus: close, time.busy: 2.32µs, time.idle: 1.48µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:55.914898Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 26.3µs, time.idle: 1.60µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:55.914920Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.914946Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.914976Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.915021Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.915044Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.915054Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// An enum with a doc comment.\n/// This is a documented enum\npub enum DocumentedEnum {\n    Variant1,\n    Variant2,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SampleStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub unsafe trait UnsafeTrait {\n    unsafe fn unsafe_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public alias for a tuple type\npub type Point = (i32, i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod nested_sub {\n        pub struct NestedItem;\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod type_alias;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "What about the README.md file?",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.915327Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.963095Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.963138Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.963155Z  INFO ploke_rag::core: close, time.busy: 360ms, time.idle: 5.83µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 61, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.963168Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.963177Z  INFO ploke_rag::core: close, time.busy: 360ms, time.idle: 528ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 61, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998136Z  INFO ploke_rag::context: close, time.busy: 29.8ms, time.idle: 5.11ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(5)
    in ploke_rag::context::assemble_context with query_len: 61, hits: 15
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998190Z  INFO ploke_rag::core: close, time.busy: 765ms, time.idle: 158ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(5)
    in ploke_rag::core::get_context with query_len: 61, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998206Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998225Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998261Z  INFO ploke_tui::event_bus: close, time.busy: 11.6µs, time.idle: 3.66µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998278Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 923ms, time.idle: 3.60µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:05:55.998331Z  INFO ploke_tui::llm: Received context for parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(5)

  2025-09-06T06:05:55.998361Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(5)

  2025-09-06T06:05:55.998367Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(5)

  2025-09-06T06:05:55.998379Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(5)

  2025-09-06T06:05:55.998444Z  INFO ploke_tui::event_bus: close, time.busy: 4.13µs, time.idle: 2.38µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:55.998458Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 34.2µs, time.idle: 1.45µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:05:55.998477Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998499Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998519Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998556Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998577Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998586Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get metadata for these files: Cargo.toml and README.md",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:55.998822Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.210666Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138755-92NbS9un5A5o0O2JvRIl",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll help you find the README.md file in this repository.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.request_code_context:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: RequestCodeContext,
                                    arguments: "{\"search_term\": \"README.md\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138755,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1365,
            completion_tokens: 32,
            total_tokens: 1397,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.210792Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.210835Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.211875Z  INFO ploke_tui::event_bus: close, time.busy: 6.01µs, time.idle: 4.92µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.211903Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.211923Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, parent_id: c9859b90-63a4-433e-90cc-e773d0eb459c, call_id: "functions.request_code_context:0", tool: RequestCodeContext
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.211942Z DEBUG dbg_tools: Processing tool, request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0", args: "{\"search_term\": \"README.md\"}", tool: RequestCodeContext
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.211955Z DEBUG dbg_tools: params: RequestCodeContextParams {
    token_budget: None,
    search_term: "README.md",
}

    at crates/ploke-tui/src/tools/mod.rs:244 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.212298Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.308811Z DEBUG ploke_embed::local: shapes: outputs=[1, 6, 384], weights=[1, 6, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.309082Z DEBUG ploke_embed::local: shapes: outputs=[1, 6, 384], weights=[1, 6, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.309108Z DEBUG ploke_embed::local: close, time.busy: 97.1ms, time.idle: 3.06µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.492940Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.492987Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.493006Z  INFO ploke_rag::core: close, time.busy: 281ms, time.idle: 5.30µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.493057Z  INFO ploke_rag::core: close, time.busy: 24.4µs, time.idle: 281ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.493130Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.544487Z  INFO ploke_rag::core: close, time.busy: 44.1µs, time.idle: 32.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.544653Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.645966Z  INFO ploke_rag::core: close, time.busy: 25.9µs, time.idle: 22.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.646057Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.646509Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.668902Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138756-3B9PnmoaclJhKS10JBrA",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for the Cargo.toml and README.md files for you.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                            ToolCall {
                                call_id: "functions.get_file_metadata:1",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"README.md\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138756,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1626,
            completion_tokens: 52,
            total_tokens: 1678,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.669002Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.669054Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670398Z  INFO ploke_tui::event_bus: close, time.busy: 10.2µs, time.idle: 6.52µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670439Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670467Z  INFO ploke_tui::event_bus: close, time.busy: 2.22µs, time.idle: 2.15µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670481Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670501Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670521Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, call_id: "functions.get_file_metadata:1", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670536Z DEBUG dbg_tools: Processing tool, request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670556Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670568Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670597Z DEBUG dbg_tools: Processing tool, request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1", args: "{\"file_path\": \"README.md\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670609Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "README.md",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670617Z DEBUG dbg_tools: path: README.md
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670790Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.670818Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.671950Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.671971Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, parent_id: 2f862f55-feb9-4b7c-9d41-d22ea2216f7d, call_id: "functions.get_file_metadata:1", content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673041Z  INFO ploke_tui::llm::session: close, time.busy: 2.56ms, time.idle: 2.65µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: 987e800a-d2ad-4ec8-b6f3-916c883b2a21, call_id: "functions.get_file_metadata:1"
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673059Z  INFO ploke_tui::llm::session: close, time.busy: 1.48ms, time.idle: 1.14ms
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(5)
    in ploke_tui::llm::session::await_tool_result with request_id: e5f7ad8d-d330-48d1-acd7-73cb4b5265f2, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673089Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
    Ok(
        (
            "functions.get_file_metadata:1",
            Ok(
                "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673108Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673118Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:1",
        Ok(
            "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673180Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 20
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673190Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get metadata for these files: Cargo.toml and README.md",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"README.md\",\"exists\":true,\"byte_len\":7215,\"modified_ms\":1756168189597,\"file_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\",\"tracking_hash\":\"f1f43839-60a0-521d-86ee-a730ed24d11d\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:1",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.673474Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.742331Z DEBUG ploke_embed::local: shapes: outputs=[1, 6, 384], weights=[1, 6, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.742617Z DEBUG ploke_embed::local: shapes: outputs=[1, 6, 384], weights=[1, 6, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.742644Z DEBUG ploke_embed::local: close, time.busy: 96.5ms, time.idle: 3.02µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.927844Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.927891Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.927909Z  INFO ploke_rag::core: close, time.busy: 282ms, time.idle: 6.54µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 9, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.927924Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 20
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.927934Z  INFO ploke_rag::core: close, time.busy: 282ms, time.idle: 434ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 9, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.961259Z  INFO ploke_rag::context: close, time.busy: 29.5ms, time.idle: 3.81ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 9, hits: 20
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.961360Z  INFO ploke_rag::core: close, time.busy: 593ms, time.idle: 156ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 9, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.961412Z  INFO ploke_tui::tools::request_code_context: Executed Tool: RequestCodeContext 
With stats: ContextStats {
    total_tokens: 212,
    files: 20,
    parts: 20,
    truncated_parts: 0,
    dedup_removed: 0,
}
    at crates/ploke-tui/src/tools/request_code_context.rs:180 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.961518Z DEBUG dbg_tools: content: "{\"ok\":true,\"search_term\":\"README.md\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"canon_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"snippet\":\"pub mod type_alias;\"},{\"file_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"canon_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"snippet\":\"pub mod macros;\"},{\"file_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"canon_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"snippet\":\"/// An enum with a doc comment.\\n/// This is a documented enum\\npub enum DocumentedEnum {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"canon_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"snippet\":\"pub mod enums;\"},{\"file_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"canon_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"snippet\":\"pub mod nested_sub {\\n        pub struct NestedItem;\\n    }\"},{\"file_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"canon_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"snippet\":\"pub mod structs;\"},{\"file_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"canon_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"snippet\":\"enum PrivateEnum {\\n    A,\\n}\"},{\"file_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"canon_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"snippet\":\"pub mod impls;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"canon_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"snippet\":\"pub struct GenericStruct<T> {\\n    pub field: T,\\n}\"},{\"file_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"canon_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"snippet\":\"pub type MutStrSlice<'a> = &'a mut str;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"canon_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"snippet\":\"type InnerSecret = bool;\"},{\"file_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"canon_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"snippet\":\"type UseInner = inner::InnerPublic;\"},{\"file_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"canon_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"snippet\":\"pub struct SampleStruct {\\n    pub field: String,\\n}\"},{\"file_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"canon_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"snippet\":\"pub type InnerPublic = f64;\"},{\"file_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"canon_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"snippet\":\"/// An enum demonstrating struct-like variants.\\npub enum SampleEnum {\\n    Variant1,\\n    Variant2 { value: i32 },\\n    Variant3,\\n}\"}]}"

    at crates/ploke-tui/src/tools/mod.rs:252 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.961584Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, parent_id: c9859b90-63a4-433e-90cc-e773d0eb459c, call_id: "functions.request_code_context:0", content: "{\"ok\":true,\"search_term\":\"README.md\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"canon_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"snippet\":\"pub mod type_alias;\"},{\"file_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"canon_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"snippet\":\"pub mod macros;\"},{\"file_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"canon_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"snippet\":\"/// An enum with a doc comment.\\n/// This is a documented enum\\npub enum DocumentedEnum {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"canon_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"snippet\":\"pub mod enums;\"},{\"file_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"canon_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"snippet\":\"pub mod nested_sub {\\n        pub struct NestedItem;\\n    }\"},{\"file_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"canon_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"snippet\":\"pub mod structs;\"},{\"file_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"canon_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"snippet\":\"enum PrivateEnum {\\n    A,\\n}\"},{\"file_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"canon_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"snippet\":\"pub mod impls;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"canon_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"snippet\":\"pub struct GenericStruct<T> {\\n    pub field: T,\\n}\"},{\"file_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"canon_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"snippet\":\"pub type MutStrSlice<'a> = &'a mut str;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"canon_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"snippet\":\"type InnerSecret = bool;\"},{\"file_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"canon_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"snippet\":\"type UseInner = inner::InnerPublic;\"},{\"file_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"canon_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"snippet\":\"pub struct SampleStruct {\\n    pub field: String,\\n}\"},{\"file_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"canon_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"snippet\":\"pub type InnerPublic = f64;\"},{\"file_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"canon_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"snippet\":\"/// An enum demonstrating struct-like variants.\\npub enum SampleEnum {\\n    Variant1,\\n    Variant2 { value: i32 },\\n    Variant3,\\n}\"}]}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.962693Z  INFO ploke_tui::llm::session: close, time.busy: 751ms, time.idle: 2.12µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(6)
    in ploke_tui::llm::session::await_tool_result with request_id: d93042cd-6566-4310-ae5b-7351da9d9aca, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.962725Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.request_code_context:0",
            Ok(
                "{\"ok\":true,\"search_term\":\"README.md\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"canon_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"snippet\":\"pub mod type_alias;\"},{\"file_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"canon_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"snippet\":\"pub mod macros;\"},{\"file_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"canon_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"snippet\":\"/// An enum with a doc comment.\\n/// This is a documented enum\\npub enum DocumentedEnum {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"canon_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"snippet\":\"pub mod enums;\"},{\"file_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"canon_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"snippet\":\"pub mod nested_sub {\\n        pub struct NestedItem;\\n    }\"},{\"file_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"canon_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"snippet\":\"pub mod structs;\"},{\"file_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"canon_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"snippet\":\"enum PrivateEnum {\\n    A,\\n}\"},{\"file_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"canon_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"snippet\":\"pub mod impls;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"canon_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"snippet\":\"pub struct GenericStruct<T> {\\n    pub field: T,\\n}\"},{\"file_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"canon_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"snippet\":\"pub type MutStrSlice<'a> = &'a mut str;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"canon_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"snippet\":\"type InnerSecret = bool;\"},{\"file_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"canon_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"snippet\":\"type UseInner = inner::InnerPublic;\"},{\"file_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"canon_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"snippet\":\"pub struct SampleStruct {\\n    pub field: String,\\n}\"},{\"file_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"canon_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"snippet\":\"pub type InnerPublic = f64;\"},{\"file_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"canon_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"snippet\":\"/// An enum demonstrating struct-like variants.\\npub enum SampleEnum {\\n    Variant1,\\n    Variant2 { value: i32 },\\n    Variant3,\\n}\"}]}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.962750Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.request_code_context:0",
        Ok(
            "{\"ok\":true,\"search_term\":\"README.md\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"canon_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"snippet\":\"pub mod type_alias;\"},{\"file_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"canon_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"snippet\":\"pub mod macros;\"},{\"file_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"canon_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"snippet\":\"/// An enum with a doc comment.\\n/// This is a documented enum\\npub enum DocumentedEnum {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"canon_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"snippet\":\"pub mod enums;\"},{\"file_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"canon_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"snippet\":\"pub mod nested_sub {\\n        pub struct NestedItem;\\n    }\"},{\"file_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"canon_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"snippet\":\"pub mod structs;\"},{\"file_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"canon_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"snippet\":\"enum PrivateEnum {\\n    A,\\n}\"},{\"file_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"canon_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"snippet\":\"pub mod impls;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"canon_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"snippet\":\"pub struct GenericStruct<T> {\\n    pub field: T,\\n}\"},{\"file_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"canon_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"snippet\":\"pub type MutStrSlice<'a> = &'a mut str;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"canon_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"snippet\":\"type InnerSecret = bool;\"},{\"file_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"canon_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"snippet\":\"type UseInner = inner::InnerPublic;\"},{\"file_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"canon_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"snippet\":\"pub struct SampleStruct {\\n    pub field: String,\\n}\"},{\"file_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"canon_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"snippet\":\"pub type InnerPublic = f64;\"},{\"file_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"canon_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"snippet\":\"/// An enum demonstrating struct-like variants.\\npub enum SampleEnum {\\n    Variant1,\\n    Variant2 { value: i32 },\\n    Variant3,\\n}\"}]}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.962805Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.962813Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// An enum with a doc comment.\n/// This is a documented enum\npub enum DocumentedEnum {\n    Variant1,\n    Variant2,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SampleStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub unsafe trait UnsafeTrait {\n    unsafe fn unsafe_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public alias for a tuple type\npub type Point = (i32, i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod nested_sub {\n        pub struct NestedItem;\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod type_alias;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "What about the README.md file?",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"search_term\":\"README.md\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"canon_path\":\"id://858cb449-2bd4-5140-a3cd-b21aa332e90a\",\"snippet\":\"pub mod type_alias;\"},{\"file_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"canon_path\":\"id://d943b536-6ba0-55fd-a6e6-0ffbfa8fd4ac\",\"snippet\":\"pub mod macros;\"},{\"file_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"canon_path\":\"id://a6541a18-5cc1-5f1c-a70e-bbd4f7607bca\",\"snippet\":\"/// An enum with a doc comment.\\n/// This is a documented enum\\npub enum DocumentedEnum {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"canon_path\":\"id://7616c763-2b6f-56be-8c01-eb034ccd13ad\",\"snippet\":\"pub mod enums;\"},{\"file_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"canon_path\":\"id://12c2098a-09aa-563a-98fb-d78f4dd27e7f\",\"snippet\":\"pub mod nested_sub {\\n        pub struct NestedItem;\\n    }\"},{\"file_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"canon_path\":\"id://b7ba91de-8ef9-59b1-b11a-46a0df88fd62\",\"snippet\":\"pub mod structs;\"},{\"file_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"canon_path\":\"id://34be0248-a6d5-5120-b4c2-57c0c018ec5b\",\"snippet\":\"enum PrivateEnum {\\n    A,\\n}\"},{\"file_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"canon_path\":\"id://0de1419e-a1bf-53fa-819f-05a544f0c00e\",\"snippet\":\"pub mod impls;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"canon_path\":\"id://70445202-2390-573b-9dcc-ee250cae21f2\",\"snippet\":\"pub struct GenericStruct<T> {\\n    pub field: T,\\n}\"},{\"file_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"canon_path\":\"id://84f951dc-79ad-598f-a3de-d1ff73f82714\",\"snippet\":\"pub type MutStrSlice<'a> = &'a mut str;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"canon_path\":\"id://3e7ee453-b722-51b0-8222-c7df8096319d\",\"snippet\":\"type InnerSecret = bool;\"},{\"file_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"canon_path\":\"id://050159a8-187e-523d-b30f-4a4f58c8e0f3\",\"snippet\":\"type UseInner = inner::InnerPublic;\"},{\"file_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"canon_path\":\"id://0c45e578-9960-54b1-b9eb-5d54cc8233b9\",\"snippet\":\"pub struct SampleStruct {\\n    pub field: String,\\n}\"},{\"file_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"canon_path\":\"id://699ebefa-795d-5b19-94a2-e9af98c212cf\",\"snippet\":\"pub type InnerPublic = f64;\"},{\"file_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"canon_path\":\"id://9c4dd903-8363-50a5-9e08-eb9175ac905c\",\"snippet\":\"/// An enum demonstrating struct-like variants.\\npub enum SampleEnum {\\n    Variant1,\\n    Variant2 { value: i32 },\\n    Variant3,\\n}\"}]}",
                tool_call_id: Some(
                    "functions.request_code_context:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:57.963080Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.480667Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138757-OrlUausE85ZHMVOweljh",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "# File Metadata\nBoth requested files exist in the repository:\n\n**Cargo.toml** - 2,315 bytes, modified at 2025-01-03 10:37:28 UTC\n**README.md** - 7,215 bytes, modified at 2024-12-25 19:09:49 UTC",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138757,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1800,
            completion_tokens: 68,
            total_tokens: 1868,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.480800Z  INFO ploke_tui::llm::session: close, time.busy: 3.48s, time.idle: 4.21µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.480909Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(5)

  2025-09-06T06:05:59.480951Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(5)

  2025-09-06T06:05:59.483005Z  INFO ploke_tui::llm: close, time.busy: 1.95ms, time.idle: 3.48s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.483044Z  INFO ploke_tui::llm: LLM produced response for parent_id=2f862f55-feb9-4b7c-9d41-d22ea2216f7d -> assistant_message_id=ca1600fb-cfed-4869-a31a-4aadbf8426d6. preview=# File Metadata
Both requested files exist in the repository:

**Cargo.toml** - 2,315 bytes, modified at 2025-01-03 10:37:28 UTC
**README.md** - 7,215 bytes, modified at 2024-12-25 19:09:49 UTC
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.483068Z  INFO ploke_tui::llm: close, time.busy: 2.10ms, time.idle: 3.48s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:05:59.483113Z  INFO ploke_tui::app_state::handlers::chat: Updating message ca1600fb-cfed-4869-a31a-4aadbf8426d6 status=Some(Completed) content_preview=# File Metadata
Both requested files exist in the repository:

**Cargo.toml** - 2,315 bytes, modifie...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, msg_id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:59.483123Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, msg_id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:59.483137Z  INFO ploke_tui::event_bus: close, time.busy: 4.89µs, time.idle: 1.39µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, msg_id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:59.483146Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 34.4µs, time.idle: 2.96µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, msg_id: ca1600fb-cfed-4869-a31a-4aadbf8426d6, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:59.483154Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 50.6µs, time.idle: 1.96µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:05:59.483181Z  INFO ploke_tui::event_bus: close, time.busy: 1.37µs, time.idle: 1.25µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 3cf4ea15-4251-4dd2-9322-64a902fa2893, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:59.483189Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 20.2µs, time.idle: 2.75µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 3cf4ea15-4251-4dd2-9322-64a902fa2893, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:05:59.483194Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 33.2µs, time.idle: 1.22µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:00.100562Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138758-jyFvKFkYjuxRMXTBH8fM",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "It doesn't look like there's a README.md file in the current repository. Would you like me to create one for you?",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138758,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 2842,
            completion_tokens: 25,
            total_tokens: 2867,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:00.100678Z  INFO ploke_tui::llm::session: close, time.busy: 4.19s, time.idle: 4.10µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:00.100816Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)

  2025-09-06T06:06:00.100884Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)

  2025-09-06T06:06:00.102030Z  INFO ploke_tui::llm: close, time.busy: 1.98ms, time.idle: 4.19s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:00.102048Z  INFO ploke_tui::llm: LLM produced response for parent_id=c9859b90-63a4-433e-90cc-e773d0eb459c -> assistant_message_id=8c8a80e8-4ec0-42af-8796-e56250c81269. preview=It doesn't look like there's a README.md file in the current repository. Would you like me to create one for you?
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:00.102068Z  INFO ploke_tui::llm: close, time.busy: 2.10ms, time.idle: 4.19s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:00.102109Z  INFO ploke_tui::app_state::handlers::chat: Updating message 8c8a80e8-4ec0-42af-8796-e56250c81269 status=Some(Completed) content_preview=It doesn't look like there's a README.md file in the current repository. Would you like me to create...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c8a80e8-4ec0-42af-8796-e56250c81269, msg_id: 8c8a80e8-4ec0-42af-8796-e56250c81269, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:00.102119Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 8c8a80e8-4ec0-42af-8796-e56250c81269, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c8a80e8-4ec0-42af-8796-e56250c81269, msg_id: 8c8a80e8-4ec0-42af-8796-e56250c81269, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:00.102130Z  INFO ploke_tui::event_bus: close, time.busy: 3.60µs, time.idle: 1.40µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c8a80e8-4ec0-42af-8796-e56250c81269, msg_id: 8c8a80e8-4ec0-42af-8796-e56250c81269, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:00.102139Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 31.3µs, time.idle: 3.12µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c8a80e8-4ec0-42af-8796-e56250c81269, msg_id: 8c8a80e8-4ec0-42af-8796-e56250c81269, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:00.102146Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 46.6µs, time.idle: 2.20µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:00.102171Z  INFO ploke_tui::event_bus: close, time.busy: 1.27µs, time.idle: 1.22µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 1364f840-0c74-4b59-a383-9be302125c81, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:00.102180Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 19.3µs, time.idle: 2.53µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 1364f840-0c74-4b59-a383-9be302125c81, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:00.102185Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 32.2µs, time.idle: 1.17µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:05.041723Z  INFO ploke_tui::event_bus: close, time.busy: 26.0µs, time.idle: 5.91µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5193f9df-772c-4ac5-8fa0-6253da682921, content: "Thanks for the help!", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:06:05.041804Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 5193f9df-772c-4ac5-8fa0-6253da682921,
                parent_id: 1364f840-0c74-4b59-a383-9be302125c81
                message_id: 5193f9df-772c-4ac5-8fa0-6253da682921,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5193f9df-772c-4ac5-8fa0-6253da682921, content: "Thanks for the help!", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:06:05.041825Z  INFO ploke_tui::event_bus: close, time.busy: 3.93µs, time.idle: 2.58µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5193f9df-772c-4ac5-8fa0-6253da682921, content: "Thanks for the help!", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:06:05.041841Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 192µs, time.idle: 6.45µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5193f9df-772c-4ac5-8fa0-6253da682921, content: "Thanks for the help!", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:06:05.041855Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 235µs, time.idle: 13.7µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T06:06:05.041878Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:06:05.046261Z  INFO ploke_tui::llm: Received LLM request for parent_id: 5193f9df-772c-4ac5-8fa0-6253da682921
new_msg_id: 5193f9df-772c-4ac5-8fa0-6253da682921
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:06:05.050939Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:06:05.050974Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 9.10ms, time.idle: 4.79µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T06:06:05.051527Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.067450Z  INFO ploke_tui::event_bus: close, time.busy: 12.1µs, time.idle: 6.88µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send

  2025-09-06T06:06:05.158311Z DEBUG ploke_embed::local: shapes: outputs=[1, 7, 384], weights=[1, 7, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.158635Z DEBUG ploke_embed::local: shapes: outputs=[1, 7, 384], weights=[1, 7, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.158666Z DEBUG ploke_embed::local: close, time.busy: 108ms, time.idle: 3.62µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.342441Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.342495Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.342517Z  INFO ploke_rag::core: close, time.busy: 291ms, time.idle: 8.12µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.342600Z  INFO ploke_rag::core: close, time.busy: 40.9µs, time.idle: 291ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.342685Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.394118Z  INFO ploke_rag::core: close, time.busy: 50.8µs, time.idle: 35.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.394299Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.495867Z  INFO ploke_rag::core: close, time.busy: 56.2µs, time.idle: 41.2µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.496067Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.496554Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.593684Z DEBUG ploke_embed::local: shapes: outputs=[1, 7, 384], weights=[1, 7, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.593974Z DEBUG ploke_embed::local: shapes: outputs=[1, 7, 384], weights=[1, 7, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.594000Z DEBUG ploke_embed::local: close, time.busy: 97.9ms, time.idle: 3.46µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.776380Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.776426Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.776445Z  INFO ploke_rag::core: close, time.busy: 280ms, time.idle: 7.17µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 20, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.776458Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.776467Z  INFO ploke_rag::core: close, time.busy: 281ms, time.idle: 444ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 20, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809862Z  INFO ploke_rag::context: close, time.busy: 29.3ms, time.idle: 4.03ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 20, hits: 15
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809892Z  INFO ploke_rag::core: close, time.busy: 602ms, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 20, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809901Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809913Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809939Z  INFO ploke_tui::event_bus: close, time.busy: 9.77µs, time.idle: 1.87µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809951Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 759ms, time.idle: 6.35µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T06:06:05.809972Z  INFO ploke_tui::llm: Received context for parent_id: 5193f9df-772c-4ac5-8fa0-6253da682921
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(6)

  2025-09-06T06:06:05.809987Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 5193f9df-772c-4ac5-8fa0-6253da682921
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(6)

  2025-09-06T06:06:05.809990Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 5193f9df-772c-4ac5-8fa0-6253da682921
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(6)

  2025-09-06T06:06:05.810004Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(6)

  2025-09-06T06:06:05.810050Z  INFO ploke_tui::event_bus: close, time.busy: 2.15µs, time.idle: 1.31µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:06:05.810057Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 24.9µs, time.idle: 1.33µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T06:06:05.810075Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810101Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810129Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810171Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810193Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810202Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInnerUnion = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "macro_rules! local_macro {\n    ($x:expr) => {\n        $x * 2\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// An enum demonstrating struct-like variants.\npub enum SampleEnum {\n    Variant1,\n    Variant2 { value: i32 },\n    Variant3,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level private constant with a simple integer type.\nconst TOP_LEVEL_INT: i32 = 10;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "const EXPR_CONST: i32 = 5 * 2 + 1;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple public enum with unit-like variants.\npub enum SampleEnum1 {\n    Variant1,\n    Variant2,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInner = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum solely for testing a simple where clause.\npub enum JustWhereClause<T>\nwhere\n    T: Copy,\n{\n    Data(T),\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type ConstRawPtr = *const u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Thanks for the help!",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:05.810479Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.861621Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757138765-yorDbeMTChwa2ZKNTtft",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "You're welcome! I'm glad I could help. If you need anything else with this Rust code or have any other questions, feel free to ask.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757138765,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1062,
            completion_tokens: 30,
            total_tokens: 1092,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.861753Z  INFO ploke_tui::llm::session: close, time.busy: 1.05s, time.idle: 4.14µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.861867Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)

  2025-09-06T06:06:06.861936Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)

  2025-09-06T06:06:06.863106Z  INFO ploke_tui::llm: close, time.busy: 1.07ms, time.idle: 1.05s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.863124Z  INFO ploke_tui::llm: LLM produced response for parent_id=5193f9df-772c-4ac5-8fa0-6253da682921 -> assistant_message_id=23a25c15-704c-4f11-b4fb-814992d02d20. preview=You're welcome! I'm glad I could help. If you need anything else with this Rust code or have any other questions, feel free to ask.
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.863144Z  INFO ploke_tui::llm: close, time.busy: 1.17ms, time.idle: 1.05s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T06:06:06.863185Z  INFO ploke_tui::app_state::handlers::chat: Updating message 23a25c15-704c-4f11-b4fb-814992d02d20 status=Some(Completed) content_preview=You're welcome! I'm glad I could help. If you need anything else with this Rust code or have any oth...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 23a25c15-704c-4f11-b4fb-814992d02d20, msg_id: 23a25c15-704c-4f11-b4fb-814992d02d20, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:06.863194Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 23a25c15-704c-4f11-b4fb-814992d02d20, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 23a25c15-704c-4f11-b4fb-814992d02d20, msg_id: 23a25c15-704c-4f11-b4fb-814992d02d20, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:06.863206Z  INFO ploke_tui::event_bus: close, time.busy: 3.63µs, time.idle: 1.35µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 23a25c15-704c-4f11-b4fb-814992d02d20, msg_id: 23a25c15-704c-4f11-b4fb-814992d02d20, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:06.863214Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 30.2µs, time.idle: 3.15µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 23a25c15-704c-4f11-b4fb-814992d02d20, msg_id: 23a25c15-704c-4f11-b4fb-814992d02d20, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:06.863221Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 45.4µs, time.idle: 2.10µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T06:06:06.863247Z  INFO ploke_tui::event_bus: close, time.busy: 1.33µs, time.idle: 1.23µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ef51908c-f402-4f63-a0c0-365e0ae0e098, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:06.863256Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 19.9µs, time.idle: 2.54µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ef51908c-f402-4f63-a0c0-365e0ae0e098, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:06.863261Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 32.8µs, time.idle: 1.20µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T06:06:15.042395Z  INFO ploke_tui::event_bus: close, time.busy: 34.0µs, time.idle: 16.6µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send

