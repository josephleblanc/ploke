  2025-09-06T15:04:09.744093Z  INFO ploke_tui::event_bus: close, time.busy: 370µs, time.idle: 4.16µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744093Z  INFO ploke_tui::event_bus: close, time.busy: 369µs, time.idle: 4.72µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 389547b6-5c72-415a-bd02-51d5c248b380, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744093Z  INFO ploke_tui::event_bus: close, time.busy: 369µs, time.idle: 4.46µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744189Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): a7bb7c60-e0fe-4bee-a86b-a5670bc59834,
                parent_id: 6cc837c0-f6d5-4d43-be71-c6ae094ef811
                message_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(3)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744189Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 389547b6-5c72-415a-bd02-51d5c248b380,
                parent_id: b9f7dbe6-4074-4788-8528-0de717bac3a6
                message_id: 389547b6-5c72-415a-bd02-51d5c248b380,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 389547b6-5c72-415a-bd02-51d5c248b380, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744191Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 5ee381ed-8903-4161-b5c6-7db3bab5708d,
                parent_id: 166aca44-4979-418d-b679-775f3d56683b
                message_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(2)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744210Z  INFO ploke_tui::event_bus: close, time.busy: 3.21µs, time.idle: 2.39µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 389547b6-5c72-415a-bd02-51d5c248b380, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744210Z  INFO ploke_tui::event_bus: close, time.busy: 3.02µs, time.idle: 2.79µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744224Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 551µs, time.idle: 6.39µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(3)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834, content: "Test message", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744224Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 548µs, time.idle: 7.54µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 389547b6-5c72-415a-bd02-51d5c248b380, content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744236Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.14ms, time.idle: 17.3µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744237Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.14ms, time.idle: 17.0µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744235Z  INFO ploke_tui::event_bus: close, time.busy: 7.28µs, time.idle: 5.49µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744251Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 577µs, time.idle: 7.17µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(2)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d, content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744261Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.16ms, time.idle: 17.3µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.744265Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.744264Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.744281Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.760828Z  INFO ploke_tui::llm: Received LLM request for parent_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834
new_msg_id: a7bb7c60-e0fe-4bee-a86b-a5670bc59834
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.761001Z  INFO ploke_tui::llm: Received LLM request for parent_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d
new_msg_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.767186Z  INFO ploke_tui::llm: Received LLM request for parent_id: 389547b6-5c72-415a-bd02-51d5c248b380
new_msg_id: 389547b6-5c72-415a-bd02-51d5c248b380
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.784226Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.784404Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 40.1ms, time.idle: 9.24µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.788106Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.788231Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.788261Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.788283Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 44.0ms, time.idle: 4.54µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.788289Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 44.0ms, time.idle: 3.17µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.788873Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.789082Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.813388Z  INFO ploke_tui::event_bus: close, time.busy: 27.1µs, time.idle: 5.25µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.813505Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8,
                parent_id: d24498e3-cebe-459d-a7e0-29953c399cfa
                message_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(8)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.813522Z  INFO ploke_tui::event_bus: close, time.busy: 2.98µs, time.idle: 1.68µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.813535Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 223µs, time.idle: 7.19µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(8)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, content: "Please help me understand how to use tools in this system.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.813545Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 270µs, time.idle: 27.1µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.813569Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.820161Z  INFO ploke_tui::event_bus: close, time.busy: 26.1µs, time.idle: 4.02µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c630ad2a-6871-4a6f-b356-83ec7f415c06, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.820264Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): c630ad2a-6871-4a6f-b356-83ec7f415c06,
                parent_id: e1d06a66-1c9c-495b-8dc8-8195b129f49f
                message_id: c630ad2a-6871-4a6f-b356-83ec7f415c06,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(4)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c630ad2a-6871-4a6f-b356-83ec7f415c06, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.820279Z  INFO ploke_tui::event_bus: close, time.busy: 2.02µs, time.idle: 1.50µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c630ad2a-6871-4a6f-b356-83ec7f415c06, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.820289Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 200µs, time.idle: 5.81µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(4)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c630ad2a-6871-4a6f-b356-83ec7f415c06, content: "Please get the metadata for the file 'Cargo.toml' and tell me about it.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.820298Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 240µs, time.idle: 17.7µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.820320Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.825512Z  INFO ploke_tui::event_bus: close, time.busy: 21.3µs, time.idle: 4.51µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.825791Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 85de545a-c3da-4ed9-bba2-f5ae386896b1,
                parent_id: 4b8fdb8b-539e-4558-952f-318839beaac9
                message_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.825863Z  INFO ploke_tui::event_bus: close, time.busy: 6.02µs, time.idle: 4.20µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.825892Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 434µs, time.idle: 18.4µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, content: "Check the size of Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.825906Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 491µs, time.idle: 15.1µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.825929Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.827144Z  INFO ploke_tui::llm: Received LLM request for parent_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8
new_msg_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.829819Z  INFO ploke_tui::event_bus: close, time.busy: 9.54µs, time.idle: 3.56µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.829869Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): d62d82b5-6440-46af-ace7-e6e0b198bc0f,
                parent_id: 6516878d-8344-4298-ac5d-77b5ac9f63a9
                message_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.829883Z  INFO ploke_tui::event_bus: close, time.busy: 2.29µs, time.idle: 1.65µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.829894Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 104µs, time.idle: 5.16µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, content: "Get metadata for Cargo.toml", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.829905Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 134µs, time.idle: 7.92µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.829935Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.830511Z  INFO ploke_tui::event_bus: close, time.busy: 9.86µs, time.idle: 4.61µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.830558Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8,
                parent_id: a6d6c474-76c1-4cec-9652-32df76104c0c
                message_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(7)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.830580Z  INFO ploke_tui::event_bus: close, time.busy: 3.95µs, time.idle: 4.21µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.830598Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 121µs, time.idle: 6.03µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(7)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8, content: "Get metadata for /nonexistent/file.txt", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.830611Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 155µs, time.idle: 12.0µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.830634Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.833011Z  INFO ploke_tui::event_bus: close, time.busy: 8.29µs, time.idle: 3.83µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833017Z  INFO ploke_tui::event_bus: close, time.busy: 7.52µs, time.idle: 3.66µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833047Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 4c311931-ac64-495f-bb4d-21e3e842b06d,
                parent_id: d9c5118f-5e19-4338-b03d-0214ef8d9e67
                message_id: 4c311931-ac64-495f-bb4d-21e3e842b06d,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833047Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 430c87c7-f8cd-43ce-a828-ebf842c3c9c0,
                parent_id: 3241abd0-1d08-4a9b-b970-977539c7e5b4
                message_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833063Z  INFO ploke_tui::event_bus: close, time.busy: 2.50µs, time.idle: 2.19µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833063Z  INFO ploke_tui::event_bus: close, time.busy: 2.60µs, time.idle: 2.44µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833076Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 81.6µs, time.idle: 4.13µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833076Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 91.2µs, time.idle: 4.47µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0, content: "I'm working on a Rust project", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833087Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 117µs, time.idle: 6.51µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833087Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 105µs, time.idle: 6.07µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.833103Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.833103Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.833200Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.833238Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.7ms, time.idle: 3.25µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.833886Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.833980Z  INFO ploke_tui::llm: Received LLM request for parent_id: c630ad2a-6871-4a6f-b356-83ec7f415c06
new_msg_id: c630ad2a-6871-4a6f-b356-83ec7f415c06
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.834485Z  INFO ploke_tui::event_bus: close, time.busy: 6.26µs, time.idle: 2.62µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.834514Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): eb76828a-1828-4a63-9613-8fc6548d7a4c,
                parent_id: 085e9394-9b18-476b-8d50-7124dedbc39a
                message_id: eb76828a-1828-4a63-9613-8fc6548d7a4c,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.834530Z  INFO ploke_tui::event_bus: close, time.busy: 2.46µs, time.idle: 2.73µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.834540Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 73.7µs, time.idle: 2.77µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, content: "Can you find any code snippets related to SimpleStruct in the codebase?", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.834547Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 91.2µs, time.idle: 4.91µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.834558Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.837554Z  INFO ploke_tui::event_bus: close, time.busy: 8.51µs, time.idle: 7.83µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(11)
    in ploke_tui::event_bus::send

  2025-09-06T15:04:09.838866Z  INFO ploke_tui::llm: Received LLM request for parent_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1
new_msg_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.840515Z  INFO ploke_tui::llm: Received LLM request for parent_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8
new_msg_id: eddb9a0a-29a6-4f4f-920f-a7cc1bb567a8
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845294Z  INFO ploke_tui::llm: Received LLM request for parent_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0
new_msg_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845311Z  INFO ploke_tui::llm: Received LLM request for parent_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f
new_msg_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845489Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845548Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.6ms, time.idle: 3.53µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845594Z  INFO ploke_tui::llm: Received LLM request for parent_id: eb76828a-1828-4a63-9613-8fc6548d7a4c
new_msg_id: eb76828a-1828-4a63-9613-8fc6548d7a4c
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.845665Z  INFO ploke_tui::event_bus: close, time.busy: 5.67µs, time.idle: 2.85µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 92957bce-6073-4ca0-866c-88451c4d87c1, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.845690Z  INFO ploke_tui::app_state::handlers::chat: sending llm_request wrapped in an AppEvent::Llm of kind user with ids 
                new_msg_id (not sent): 92957bce-6073-4ca0-866c-88451c4d87c1,
                parent_id: ba89d7f3-e6ac-45a6-9c5e-3d2cf61f4500
                message_id: 92957bce-6073-4ca0-866c-88451c4d87c1,
    at crates/ploke-tui/src/app_state/handlers/chat.rs:191 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 92957bce-6073-4ca0-866c-88451c4d87c1, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.845703Z  INFO ploke_tui::event_bus: close, time.busy: 2.23µs, time.idle: 2.02µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 92957bce-6073-4ca0-866c-88451c4d87c1, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.845714Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 67.1µs, time.idle: 3.76µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 92957bce-6073-4ca0-866c-88451c4d87c1, content: "Hello, I need help with some files", kind: User
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.845723Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 89.7µs, time.idle: 3.80µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddUserMessage

  2025-09-06T15:04:09.845737Z  INFO ploke_tui::app_state::database: scan_for_change in crate_name: fixture_nodes
    at crates/ploke-tui/src/app_state/database.rs:276 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.846015Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.846082Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.846122Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 25.8ms, time.idle: 3.08µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.846424Z  INFO ploke_tui::llm: Received LLM request for parent_id: 4c311931-ac64-495f-bb4d-21e3e842b06d
new_msg_id: 4c311931-ac64-495f-bb4d-21e3e842b06d
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.846647Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.851258Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.851296Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 21.4ms, time.idle: 3.79µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.851479Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 97827e7e-609a-4c4b-b46a-22563c233458, parent_id: 8b38f1e7-e81c-4640-a9d0-5a4a3d0f2aff, call_id: "{\"file_path\": \"/test/file.rs\"}", content: "get_file_metadata" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(11)

  2025-09-06T15:04:09.851684Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.852712Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.852750Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 22.1ms, time.idle: 3.59µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.853166Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.857324Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.857361Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 24.3ms, time.idle: 3.38µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.857525Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.857557Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 23.0ms, time.idle: 2.83µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.857910Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.858068Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.859933Z  INFO ploke_tui::llm: Received LLM request for parent_id: 92957bce-6073-4ca0-866c-88451c4d87c1
new_msg_id: 92957bce-6073-4ca0-866c-88451c4d87c1
    at crates/ploke-tui/src/llm/mod.rs:309 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.865557Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.865581Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.8ms, time.idle: 3.10µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.865911Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.868007Z  INFO ploke_tui::app_state::database: No file changes detected
    at crates/ploke-tui/src/app_state/database.rs:292 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.868043Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 34.9ms, time.idle: 3.35µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: ScanForChange

  2025-09-06T15:04:09.868363Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:09.888892Z  INFO ploke_tui::event_bus: close, time.busy: 11.3µs, time.idle: 6.93µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(11)
    in ploke_tui::event_bus::send

  2025-09-06T15:04:10.282999Z DEBUG ploke_embed::local: shapes: outputs=[1, 4, 384], weights=[1, 4, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.285411Z DEBUG ploke_embed::local: shapes: outputs=[1, 4, 384], weights=[1, 4, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.285470Z DEBUG ploke_embed::local: close, time.busy: 497ms, time.idle: 6.20µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(3)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.371392Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.372005Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.372051Z DEBUG ploke_embed::local: close, time.busy: 526ms, time.idle: 4.05µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.375173Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.375954Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.375992Z DEBUG ploke_embed::local: close, time.busy: 543ms, time.idle: 3.57µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.395957Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.396546Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.396598Z DEBUG ploke_embed::local: close, time.busy: 545ms, time.idle: 3.58µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.423701Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.424327Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.424362Z DEBUG ploke_embed::local: close, time.busy: 559ms, time.idle: 3.53µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.435235Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.435821Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.435862Z DEBUG ploke_embed::local: close, time.busy: 568ms, time.idle: 3.49µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.442614Z DEBUG ploke_embed::local: shapes: outputs=[1, 15, 384], weights=[1, 15, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.442794Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.443170Z DEBUG ploke_embed::local: shapes: outputs=[1, 15, 384], weights=[1, 15, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.443196Z DEBUG ploke_embed::local: close, time.busy: 590ms, time.idle: 2.93µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(7)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.444120Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.444167Z DEBUG ploke_embed::local: close, time.busy: 659ms, time.idle: 4.47µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.466278Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.467549Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.470873Z DEBUG ploke_embed::local: close, time.busy: 613ms, time.idle: 3.40µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.496060Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.497022Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.497135Z DEBUG ploke_embed::local: close, time.busy: 651ms, time.idle: 3.81µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(4)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.533725Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.535055Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.535097Z DEBUG ploke_embed::local: close, time.busy: 747ms, time.idle: 4.54µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.597259Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.599198Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.599244Z DEBUG ploke_embed::local: close, time.busy: 742ms, time.idle: 3.58µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732594Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732664Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732689Z  INFO ploke_rag::core: close, time.busy: 944ms, time.idle: 8.46µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(3)
    in ploke_rag::core::search with query_len: 12, top_k: 15
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732776Z  INFO ploke_rag::core: close, time.busy: 52.7µs, time.idle: 944ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(3)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732890Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(3)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.732976Z  INFO ploke_tui::event_bus: close, time.busy: 11.5µs, time.idle: 4.00µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(3)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.733744Z  INFO ploke_rag::core: close, time.busy: 140µs, time.idle: 945ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(3)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.733765Z  INFO ploke_rag::core: close, time.busy: 944ms, time.idle: 938µs
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(3)
    in ploke_rag::core::get_context with query_len: 12, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.733779Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 945ms, time.idle: 5.61µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(3)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.742347Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.742391Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.742408Z  INFO ploke_rag::core: close, time.busy: 891ms, time.idle: 9.86µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.742451Z  INFO ploke_rag::core: close, time.busy: 24.1µs, time.idle: 891ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.742515Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778677Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778728Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778751Z  INFO ploke_rag::core: close, time.busy: 926ms, time.idle: 6.53µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(7)
    in ploke_rag::core::search with query_len: 38, top_k: 15
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778803Z  INFO ploke_rag::core: close, time.busy: 24.2µs, time.idle: 926ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(7)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778901Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.778967Z  INFO ploke_tui::event_bus: close, time.busy: 7.13µs, time.idle: 3.52µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.779000Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 6bdf2f05-31cb-4058-90bd-e4b56c5920cd, parent_id: a7f4e509-b2d3-4058-984d-d64ad26f5f30, call_id: "{\"error\": \"File not found\"}", content: "get_file_metadata" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.793746Z  INFO ploke_rag::core: close, time.busy: 23.0µs, time.idle: 21.7µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.793837Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.817063Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.817117Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.817137Z  INFO ploke_rag::core: close, time.busy: 971ms, time.idle: 6.86µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.817186Z  INFO ploke_rag::core: close, time.busy: 21.8µs, time.idle: 972ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.817260Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.830958Z  INFO ploke_tui::event_bus: close, time.busy: 8.05µs, time.idle: 5.29µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(7)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831057Z  INFO ploke_rag::core: close, time.busy: 13.8µs, time.idle: 48.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(7)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831109Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831149Z  INFO ploke_rag::core: close, time.busy: 138µs, time.idle: 978ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(7)
    in ploke_rag::core::search_bm25 with query_len: 38, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831158Z  INFO ploke_rag::core: close, time.busy: 926ms, time.idle: 52.3ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(7)
    in ploke_rag::core::get_context with query_len: 38, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831166Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 978ms, time.idle: 3.81µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(7)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.831899Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.832031Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.832057Z  INFO ploke_rag::core: close, time.busy: 999ms, time.idle: 6.77µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.832110Z  INFO ploke_rag::core: close, time.busy: 26.9µs, time.idle: 999ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.832196Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.838951Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.838989Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.839005Z  INFO ploke_rag::core: close, time.busy: 1.05s, time.idle: 7.03µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.839044Z  INFO ploke_rag::core: close, time.busy: 408µs, time.idle: 1.05s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.839106Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.843488Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.843527Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.843543Z  INFO ploke_rag::core: close, time.busy: 978ms, time.idle: 5.12µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.843582Z  INFO ploke_rag::core: close, time.busy: 21.1µs, time.idle: 978ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.843635Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.863667Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.863707Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.863722Z  INFO ploke_rag::core: close, time.busy: 996ms, time.idle: 5.22µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.863762Z  INFO ploke_rag::core: close, time.busy: 20.6µs, time.idle: 996ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.863817Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.868637Z  INFO ploke_rag::core: close, time.busy: 16.5µs, time.idle: 14.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.868710Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.870253Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.870293Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.870309Z  INFO ploke_rag::core: close, time.busy: 1.01s, time.idle: 4.79µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.870349Z  INFO ploke_rag::core: close, time.busy: 18.8µs, time.idle: 1.01s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.870411Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.879914Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.879953Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.879970Z  INFO ploke_rag::core: close, time.busy: 1.09s, time.idle: 5.44µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.880009Z  INFO ploke_rag::core: close, time.busy: 44.9µs, time.idle: 1.09s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.880083Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.883354Z  INFO ploke_rag::core: close, time.busy: 17.6µs, time.idle: 15.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.883423Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.890277Z  INFO ploke_rag::core: close, time.busy: 22.1µs, time.idle: 20.0µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.890372Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.894064Z  INFO ploke_rag::core: close, time.busy: 21.5µs, time.idle: 20.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(9)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.894153Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.894525Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.894849Z  INFO ploke_rag::core: close, time.busy: 21.0µs, time.idle: 22.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.894923Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899202Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899253Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899274Z  INFO ploke_rag::core: close, time.busy: 1.05s, time.idle: 6.24µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(4)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899323Z  INFO ploke_rag::core: close, time.busy: 24.5µs, time.idle: 1.05s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(4)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899407Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(4)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899463Z  INFO ploke_tui::event_bus: close, time.busy: 6.31µs, time.idle: 3.16µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(4)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899549Z  INFO ploke_rag::core: close, time.busy: 81.6µs, time.idle: 1.05s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(4)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899558Z  INFO ploke_rag::core: close, time.busy: 1.05s, time.idle: 196µs
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(4)
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.899569Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.05s, time.idle: 4.19µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(4)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.908095Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.908136Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.908152Z  INFO ploke_rag::core: close, time.busy: 1.05s, time.idle: 5.38µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.908192Z  INFO ploke_rag::core: close, time.busy: 22.2µs, time.idle: 1.05s
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.908266Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.914031Z  INFO ploke_rag::core: close, time.busy: 17.6µs, time.idle: 15.7µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.914096Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.922472Z  INFO ploke_rag::core: close, time.busy: 21.1µs, time.idle: 20.8µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.922565Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.931309Z  INFO ploke_rag::core: close, time.busy: 16.9µs, time.idle: 17.3µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.931398Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.959203Z  INFO ploke_rag::core: close, time.busy: 16.3µs, time.idle: 14.6µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.959284Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.969358Z  INFO ploke_rag::core: close, time.busy: 20.5µs, time.idle: 19.4µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(13)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.969433Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.969775Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.984195Z  INFO ploke_rag::core: close, time.busy: 17.5µs, time.idle: 15.4µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.984264Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.984572Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.991296Z  INFO ploke_rag::core: close, time.busy: 21.1µs, time.idle: 20.4µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(10)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.991395Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.991868Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.996201Z  INFO ploke_rag::core: close, time.busy: 21.2µs, time.idle: 20.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(6)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.996284Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:10.996573Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.015789Z  INFO ploke_rag::core: close, time.busy: 20.1µs, time.idle: 19.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(5)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.015870Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.016151Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.023926Z  INFO ploke_rag::core: close, time.busy: 20.0µs, time.idle: 19.9µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.024016Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.024450Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.026098Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.026691Z DEBUG ploke_embed::local: shapes: outputs=[1, 9, 384], weights=[1, 9, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.026724Z DEBUG ploke_embed::local: close, time.busy: 133ms, time.idle: 3.53µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(9)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.032991Z  INFO ploke_rag::core: close, time.busy: 20.4µs, time.idle: 20.1µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(2)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.033099Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.033721Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.061000Z  INFO ploke_rag::core: close, time.busy: 21.6µs, time.idle: 20.6µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(12)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.061203Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.061912Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.308352Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.308884Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.308935Z DEBUG ploke_embed::local: close, time.busy: 339ms, time.idle: 4.20µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(13)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.336778Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.337176Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.337208Z DEBUG ploke_embed::local: close, time.busy: 341ms, time.idle: 4.02µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(6)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.348744Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.349587Z DEBUG ploke_embed::local: shapes: outputs=[1, 14, 384], weights=[1, 14, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.349622Z DEBUG ploke_embed::local: close, time.busy: 365ms, time.idle: 3.30µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.412526Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.413113Z DEBUG ploke_embed::local: shapes: outputs=[1, 10, 384], weights=[1, 10, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.413235Z DEBUG ploke_embed::local: close, time.busy: 397ms, time.idle: 4.24µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(5)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.493502Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.494310Z DEBUG ploke_embed::local: shapes: outputs=[1, 21, 384], weights=[1, 21, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.494350Z DEBUG ploke_embed::local: close, time.busy: 470ms, time.idle: 4.07µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.518002Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.519298Z DEBUG ploke_embed::local: shapes: outputs=[1, 24, 384], weights=[1, 24, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.519335Z DEBUG ploke_embed::local: close, time.busy: 528ms, time.idle: 4.03µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(10)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.540530Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.540582Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.540609Z  INFO ploke_rag::core: close, time.busy: 646ms, time.idle: 9.24µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(9)
    in ploke_rag::core::search with query_len: 27, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.540637Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.540653Z  INFO ploke_rag::core: close, time.busy: 647ms, time.idle: 1.04s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(9)
    in ploke_rag::core::search_bm25 with query_len: 27, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616783Z  INFO ploke_rag::context: close, time.busy: 66.8ms, time.idle: 7.21ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(9)
    in ploke_rag::context::assemble_context with query_len: 27, hits: 15
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616823Z  INFO ploke_rag::core: close, time.busy: 1.61s, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(9)
    in ploke_rag::core::get_context with query_len: 27, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616849Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616888Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616924Z  INFO ploke_tui::event_bus: close, time.busy: 12.6µs, time.idle: 3.59µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616942Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.77s, time.idle: 4.32µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.616971Z  INFO ploke_tui::llm: Received context for parent_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(9)

  2025-09-06T15:04:11.616992Z  INFO ploke_tui::llm: pending_requests found match for req_parent: d62d82b5-6440-46af-ace7-e6e0b198bc0f
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(9)

  2025-09-06T15:04:11.617000Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: d62d82b5-6440-46af-ace7-e6e0b198bc0f
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(9)

  2025-09-06T15:04:11.617015Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(9)

  2025-09-06T15:04:11.617092Z  INFO ploke_tui::event_bus: close, time.busy: 4.53µs, time.idle: 2.63µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.617110Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 41.6µs, time.idle: 2.26µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.617142Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.617174Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.617233Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.617374Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.617402Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.617412Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Get metadata for Cargo.toml",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.618314Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.627556Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.629703Z DEBUG ploke_embed::local: shapes: outputs=[1, 36, 384], weights=[1, 36, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.629867Z DEBUG ploke_embed::local: close, time.busy: 569ms, time.idle: 4.23µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(12)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.643231Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 24.7ms, time.idle: 68.0µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(144)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.643341Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.661679Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.666782Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.668274Z DEBUG ploke_embed::local: shapes: outputs=[1, 33, 384], weights=[1, 33, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.668316Z DEBUG ploke_embed::local: close, time.busy: 635ms, time.idle: 3.79µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(2)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.677723Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.677776Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.677799Z  INFO ploke_rag::core: close, time.busy: 708ms, time.idle: 7.04µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(13)
    in ploke_rag::core::search with query_len: 28, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.677817Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.677835Z  INFO ploke_rag::core: close, time.busy: 709ms, time.idle: 1.12s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(13)
    in ploke_rag::core::search_bm25 with query_len: 28, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.689777Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.689847Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.689869Z  INFO ploke_rag::core: close, time.busy: 706ms, time.idle: 6.14µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 58, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.689883Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.689896Z  INFO ploke_rag::core: close, time.busy: 706ms, time.idle: 1.15s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 58, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.700300Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.700343Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.700360Z  INFO ploke_rag::core: close, time.busy: 704ms, time.idle: 5.60µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(6)
    in ploke_rag::core::search with query_len: 34, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.700374Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.700388Z  INFO ploke_rag::core: close, time.busy: 704ms, time.idle: 1.13s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(6)
    in ploke_rag::core::search_bm25 with query_len: 34, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.729680Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.729719Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.729741Z  INFO ploke_rag::core: close, time.busy: 714ms, time.idle: 6.85µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(5)
    in ploke_rag::core::search with query_len: 29, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.729754Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.729768Z  INFO ploke_rag::core: close, time.busy: 714ms, time.idle: 1.15s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(5)
    in ploke_rag::core::search_bm25 with query_len: 29, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745349Z  INFO ploke_rag::context: close, time.busy: 40.1ms, time.idle: 4.84ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(6)
    in ploke_rag::context::assemble_context with query_len: 34, hits: 15
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745385Z  INFO ploke_rag::core: close, time.busy: 1.72s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(6)
    in ploke_rag::core::get_context with query_len: 34, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745397Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745412Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745442Z  INFO ploke_tui::event_bus: close, time.busy: 7.83µs, time.idle: 2.66µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745456Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.88s, time.idle: 4.13µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.745476Z  INFO ploke_tui::llm: Received context for parent_id: 92957bce-6073-4ca0-866c-88451c4d87c1
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(6)

  2025-09-06T15:04:11.745490Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 92957bce-6073-4ca0-866c-88451c4d87c1
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(6)

  2025-09-06T15:04:11.745495Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 92957bce-6073-4ca0-866c-88451c4d87c1
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(6)

  2025-09-06T15:04:11.745507Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(6)

  2025-09-06T15:04:11.745550Z  INFO ploke_tui::event_bus: close, time.busy: 2.40µs, time.idle: 1.49µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.745561Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 24.9µs, time.idle: 1.56µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.745579Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745600Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745623Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745663Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745687Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745700Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ByteArray = [u8; 256];",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Type alias used in a constant.\ntype MyInt = i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union IntOrFloat {\n    i: i32,\n    f: f32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union InnerPublic {\n        x: f32,\n        y: f32,\n    }",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TOP_LEVEL_STR: &str = \"hello world\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SubItem;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Hello, I need help with some files",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.745977Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.758922Z  INFO ploke_rag::context: close, time.busy: 63.8ms, time.idle: 5.19ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(8)
    in ploke_rag::context::assemble_context with query_len: 58, hits: 15
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.758959Z  INFO ploke_rag::core: close, time.busy: 1.77s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(8)
    in ploke_rag::core::get_context with query_len: 58, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.758971Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.758983Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.759002Z  INFO ploke_tui::event_bus: close, time.busy: 6.76µs, time.idle: 1.94µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.759011Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.93s, time.idle: 3.82µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.759027Z  INFO ploke_tui::llm: Received context for parent_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(8)

  2025-09-06T15:04:11.759037Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(8)

  2025-09-06T15:04:11.759040Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(8)

  2025-09-06T15:04:11.759049Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(8)

  2025-09-06T15:04:11.759082Z  INFO ploke_tui::event_bus: close, time.busy: 2.08µs, time.idle: 1.34µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.759089Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.9µs, time.idle: 1.28µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(8)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.759103Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759118Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759136Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759168Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759187Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759195Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseOuterPoint = inner::OuterPoint;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod impls;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type ConstRawPtr = *const u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInner = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please help me understand how to use tools in this system.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.759418Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.771985Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 25.9ms, time.idle: 60.0µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(145)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.772170Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779259Z  INFO ploke_rag::context: close, time.busy: 96.0ms, time.idle: 5.38ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(13)
    in ploke_rag::context::assemble_context with query_len: 28, hits: 15
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779289Z  INFO ploke_rag::core: close, time.busy: 1.78s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(13)
    in ploke_rag::core::get_context with query_len: 28, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779297Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779309Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779332Z  INFO ploke_tui::event_bus: close, time.busy: 7.28µs, time.idle: 2.04µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779341Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.93s, time.idle: 4.46µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.779358Z  INFO ploke_tui::llm: Received context for parent_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(13)

  2025-09-06T15:04:11.779370Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 85de545a-c3da-4ed9-bba2-f5ae386896b1
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(13)

  2025-09-06T15:04:11.779374Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 85de545a-c3da-4ed9-bba2-f5ae386896b1
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(13)

  2025-09-06T15:04:11.779383Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(13)

  2025-09-06T15:04:11.779418Z  INFO ploke_tui::event_bus: close, time.busy: 2.13µs, time.idle: 1.41µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.779425Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.4µs, time.idle: 1.25µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.779439Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779455Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779474Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779506Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779526Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779534Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DisplayableContainer<T: std::fmt::Display> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeWithBounds {\n    type BoundedOutput: Debug + Clone;\n    fn generate_bounded(&self) -> Self::BoundedOutput;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct TupleStruct(pub i32, pub i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Check the size of Cargo.toml",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779755Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.779957Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 20.5ms, time.idle: 60.2µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(146)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.780034Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781414Z  INFO ploke_rag::context: close, time.busy: 44.1ms, time.idle: 7.50ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(5)
    in ploke_rag::context::assemble_context with query_len: 29, hits: 15
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781452Z  INFO ploke_rag::core: close, time.busy: 1.75s, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(5)
    in ploke_rag::core::get_context with query_len: 29, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781464Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781476Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781506Z  INFO ploke_tui::event_bus: close, time.busy: 8.02µs, time.idle: 2.85µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781520Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 1.91s, time.idle: 4.01µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.781537Z  INFO ploke_tui::llm: Received context for parent_id: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(5)

  2025-09-06T15:04:11.781547Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(5)

  2025-09-06T15:04:11.781550Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 430c87c7-f8cd-43ce-a828-ebf842c3c9c0
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(5)

  2025-09-06T15:04:11.781559Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(5)

  2025-09-06T15:04:11.781602Z  INFO ploke_tui::event_bus: close, time.busy: 3.18µs, time.idle: 2.26µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.781613Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 26.4µs, time.idle: 2.11µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.781632Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781651Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781674Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781706Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781729Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.781740Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type ComplexGeneric<T>\nwhere\n    T: Clone + Send + 'static,\n= Option<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with lifetime, type, and const generic parameters, and a where clause.\n#[derive(Debug, Clone)] // Attribute for testing\npub enum GenericEnum<'a, T: Default + Clone, const N: usize>\nwhere\n    T: Send, // Where clause\n{\n    /// Doc comment on a generic variant.\n    GenericVariant(T),\n    LifetimeVariant(&'a str),\n    ConstGenericVariant([u8; N]),\n    #[cfg(feature = \"enum_feature_one\")] // CFG on a variant\n    ConditionalGeneric(Option<T>),\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TOP_LEVEL_STR: &str = \"hello world\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) enum CrateEnum {\n    B,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "I'm working on a Rust project",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.782054Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.789667Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.798519Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.800156Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 18.0ms, time.idle: 51.8µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(148)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.800239Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.804774Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.804825Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.804850Z  INFO ploke_rag::core: close, time.busy: 813ms, time.idle: 6.62µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(10)
    in ploke_rag::core::search with query_len: 83, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.804866Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.804879Z  INFO ploke_rag::core: close, time.busy: 814ms, time.idle: 1.21s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(10)
    in ploke_rag::core::search_bm25 with query_len: 83, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.805319Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 25.5ms, time.idle: 54.6µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(147)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.805404Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.819668Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.823462Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840634Z  INFO ploke_rag::context: close, time.busy: 30.9ms, time.idle: 4.86ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(10)
    in ploke_rag::context::assemble_context with query_len: 83, hits: 15
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840671Z  INFO ploke_rag::core: close, time.busy: 1.90s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(10)
    in ploke_rag::core::get_context with query_len: 83, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840682Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840694Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840717Z  INFO ploke_tui::event_bus: close, time.busy: 8.50µs, time.idle: 3.01µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840730Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.06s, time.idle: 13.0µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.840750Z  INFO ploke_tui::llm: Received context for parent_id: 389547b6-5c72-415a-bd02-51d5c248b380
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(10)

  2025-09-06T15:04:11.840761Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 389547b6-5c72-415a-bd02-51d5c248b380
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(10)

  2025-09-06T15:04:11.840766Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 389547b6-5c72-415a-bd02-51d5c248b380
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(10)

  2025-09-06T15:04:11.840776Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(10)

  2025-09-06T15:04:11.840814Z  INFO ploke_tui::event_bus: close, time.busy: 2.15µs, time.idle: 1.42µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.840821Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 18.6µs, time.idle: 1.29µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.840841Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840862Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840884Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840924Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840949Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.840959Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.841250Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.856429Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.856468Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.856484Z  INFO ploke_rag::core: close, time.busy: 832ms, time.idle: 5.56µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 71, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.856497Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.856508Z  INFO ploke_rag::core: close, time.busy: 833ms, time.idle: 1.17s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 71, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.857327Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 15.9ms, time.idle: 128µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(149)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.857412Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.869844Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892100Z  INFO ploke_rag::context: close, time.busy: 31.1ms, time.idle: 4.45ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(14)
    in ploke_rag::context::assemble_context with query_len: 71, hits: 15
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892128Z  INFO ploke_rag::core: close, time.busy: 1.88s, time.idle: 158ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(14)
    in ploke_rag::core::get_context with query_len: 71, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892137Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892146Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892166Z  INFO ploke_tui::event_bus: close, time.busy: 6.47µs, time.idle: 1.91µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892175Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.03s, time.idle: 3.44µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.892190Z  INFO ploke_tui::llm: Received context for parent_id: eb76828a-1828-4a63-9613-8fc6548d7a4c
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(14)

  2025-09-06T15:04:11.892200Z  INFO ploke_tui::llm: pending_requests found match for req_parent: eb76828a-1828-4a63-9613-8fc6548d7a4c
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(14)

  2025-09-06T15:04:11.892203Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: eb76828a-1828-4a63-9613-8fc6548d7a4c
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(14)

  2025-09-06T15:04:11.892212Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(14)

  2025-09-06T15:04:11.892245Z  INFO ploke_tui::event_bus: close, time.busy: 2.17µs, time.idle: 1.34µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.892253Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.0µs, time.idle: 1.27µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.892267Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892283Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: false
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892302Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892332Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892353Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892361Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner_mod {\n    // Constant visible only within the crate, defined inside an inline module.\n    pub(crate) const INNER_CONST: u8 = 1;\n\n    // Static mutable boolean visible only to the parent module (`crate`), defined inside an inline module.\n    #[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SuperTrait: SimpleTrait {\n    fn super_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you find any code snippets related to SimpleStruct in the codebase?",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.892564Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.918745Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 26.1ms, time.idle: 59.6µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(150)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.918824Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.923507Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.923551Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.923572Z  INFO ploke_rag::core: close, time.busy: 890ms, time.idle: 6.48µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(2)
    in ploke_rag::core::search with query_len: 132, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.923586Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.923598Z  INFO ploke_rag::core: close, time.busy: 891ms, time.idle: 1.24s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(2)
    in ploke_rag::core::search_bm25 with query_len: 132, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.935547Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.943468Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.943507Z DEBUG ploke_rag::core: Dense search returning 15 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.943524Z  INFO ploke_rag::core: close, time.busy: 882ms, time.idle: 6.36µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(12)
    in ploke_rag::core::search with query_len: 134, top_k: 15
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.943537Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 15
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.943546Z  INFO ploke_rag::core: close, time.busy: 883ms, time.idle: 1.20s
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(12)
    in ploke_rag::core::search_bm25 with query_len: 134, top_k: 15, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958070Z  INFO ploke_rag::context: close, time.busy: 30.4ms, time.idle: 4.06ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(2)
    in ploke_rag::context::assemble_context with query_len: 132, hits: 15
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958098Z  INFO ploke_rag::core: close, time.busy: 2.01s, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(2)
    in ploke_rag::core::get_context with query_len: 132, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958106Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958115Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958135Z  INFO ploke_tui::event_bus: close, time.busy: 6.36µs, time.idle: 1.91µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958145Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.17s, time.idle: 4.95µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.958161Z  INFO ploke_tui::llm: Received context for parent_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(2)

  2025-09-06T15:04:11.958170Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 5ee381ed-8903-4161-b5c6-7db3bab5708d
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(2)

  2025-09-06T15:04:11.958174Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 5ee381ed-8903-4161-b5c6-7db3bab5708d
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(2)

  2025-09-06T15:04:11.958182Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(2)

  2025-09-06T15:04:11.958216Z  INFO ploke_tui::event_bus: close, time.busy: 3.47µs, time.idle: 1.28µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.958223Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 19.5µs, time.idle: 1.24µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(2)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.958237Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958253Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: true
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958271Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958301Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958321Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958328Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[derive(Debug)]\npub struct AttributedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[deprecated(note = \"Use NewId instead\")]\npub type OldId = String;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please use the get_file_metadata tool to check if the file 'Cargo.toml' exists and show me its metadata including the tracking hash.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.958529Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.978739Z  INFO ploke_rag::context: close, time.busy: 29.2ms, time.idle: 5.92ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(12)
    in ploke_rag::context::assemble_context with query_len: 134, hits: 15
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978792Z  INFO ploke_rag::core: close, time.busy: 1.96s, time.idle: 159ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(12)
    in ploke_rag::core::get_context with query_len: 134, top_k: 15
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978807Z  INFO ploke_tui::rag::context: constructing context (RAG) with 15 parts and 2 messages
    at crates/ploke-tui/src/rag/context.rs:118 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978824Z DEBUG ploke_tui::rag::context: m.content.is_empty() = false
    at crates/ploke-tui/src/rag/context.rs:137 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978876Z  INFO ploke_tui::event_bus: close, time.busy: 12.1µs, time.idle: 4.03µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978894Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 2.12s, time.idle: 4.53µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: EmbedMessage

  2025-09-06T15:04:11.978918Z  INFO ploke_tui::llm: Received context for parent_id: 4c311931-ac64-495f-bb4d-21e3e842b06d
    at crates/ploke-tui/src/llm/mod.rs:320 on ThreadId(12)

  2025-09-06T15:04:11.978935Z  INFO ploke_tui::llm: pending_requests found match for req_parent: 4c311931-ac64-495f-bb4d-21e3e842b06d
    at crates/ploke-tui/src/llm/mod.rs:343 on ThreadId(12)

  2025-09-06T15:04:11.978942Z  INFO ploke_tui::llm: ready_contexts found match for req_parent: 4c311931-ac64-495f-bb4d-21e3e842b06d
    at crates/ploke-tui/src/llm/mod.rs:348 on ThreadId(12)

  2025-09-06T15:04:11.978956Z  INFO ploke_tui::llm: removing id from pending_requests
    at crates/ploke-tui/src/llm/mod.rs:366 on ThreadId(12)

  2025-09-06T15:04:11.979016Z  INFO ploke_tui::event_bus: close, time.busy: 3.58µs, time.idle: 2.73µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.979030Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 34.2µs, time.idle: 2.46µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: CreateAssistantMessage

  2025-09-06T15:04:11.979058Z  INFO ploke_tui::llm: prepare_and_run_llm_call start, model: moonshotai/kimi-k2, has_context: true
    at crates/ploke-tui/src/llm/mod.rs:631 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979088Z DEBUG ploke_tui::llm: llm_request_plan, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, provider_type: OpenRouter, provider_slug: None, supports_tools_cache: Some(true), require_tool_support: true
    at crates/ploke-tui/src/llm/mod.rs:707 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979120Z DEBUG ploke_tui::llm: llm_request_tools:
	use_tools: true
	tool_names: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/mod.rs:749 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979176Z DEBUG ploke_tui::llm::session: Starting RequestSession::run, self.params: LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) }
    at crates/ploke-tui/src/llm/session.rs:48 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979209Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 18
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979223Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union UnionWithFieldAttr {\n    #[cfg(target_endian = \"big\")]\n    big_endian_data: u32,\n    #[cfg(not(target_endian = \"big\"))]\n    little_endian_data: u32,\n    always_present: u8,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.",
                tool_call_id: None,
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.979454Z DEBUG reqwest::connect: starting new connection: https://openrouter.ai/
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/reqwest-0.12.15/src/connect.rs:625 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.984624Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 26.0ms, time.idle: 51.3µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(151)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.984766Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:11.995580Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.3.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:12.004275Z DEBUG hyper_util::client::legacy::connect::dns: close, time.busy: 24.7ms, time.idle: 61.1µs
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/dns.rs:121 on ThreadId(152)
    in hyper_util::client::legacy::connect::dns::resolve with host: openrouter.ai
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:12.004414Z DEBUG hyper_util::client::legacy::connect::http: connecting to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:657 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:12.017079Z DEBUG hyper_util::client::legacy::connect::http: connected to 104.18.2.115:443
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/connect/http.rs:660 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.520356Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171051-mWgpd1TCGepQpFArUMvI",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for the Cargo.toml file in this workspace.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171051,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1600,
            completion_tokens: 33,
            total_tokens: 1633,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.520503Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.520570Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521262Z  INFO ploke_tui::event_bus: close, time.busy: 7.72µs, time.idle: 6.13µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521294Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521325Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, parent_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521347Z DEBUG dbg_tools: Processing tool, request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521364Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521374Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521668Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.521763Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, parent_id: d62d82b5-6440-46af-ace7-e6e0b198bc0f, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522323Z  INFO ploke_tui::llm::session: close, time.busy: 1.03ms, time.idle: 2.87µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(9)
    in ploke_tui::llm::session::await_tool_result with request_id: 5594cefd-cb7f-4b7f-a25c-b0161ee0d7c9, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522369Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522384Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522449Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522460Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A macro_rules macro with other attributes.\n#[macro_export]\n#[allow(clippy::empty_loop)]\nmacro_rules! attributed_macro {\n    () => {\n        loop {}\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Get metadata for Cargo.toml",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.522773Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.588978Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171051-85PEb8JE1dTyEXc10NOk",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I can help you check the size of the Cargo.toml file. Let me first retrieve the metadata for the Cargo.toml file to get its size information.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171051,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1746,
            completion_tokens: 50,
            total_tokens: 1796,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589126Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589191Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589882Z  INFO ploke_tui::event_bus: close, time.busy: 6.74µs, time.idle: 6.21µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589914Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589945Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, parent_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589966Z DEBUG dbg_tools: Processing tool, request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589981Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.589991Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590217Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590252Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, parent_id: 85de545a-c3da-4ed9-bba2-f5ae386896b1, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590795Z  INFO ploke_tui::llm::session: close, time.busy: 880µs, time.idle: 2.58µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(13)
    in ploke_tui::llm::session::await_tool_result with request_id: 0dba871c-52a8-4989-95d9-5798d6873b3e, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590843Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590858Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590922Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.590934Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DisplayableContainer<T: std::fmt::Display> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) type CrateBuffer = Vec<u8>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait AssocTypeWithBounds {\n    type BoundedOutput: Debug + Clone;\n    fn generate_bounded(&self) -> Self::BoundedOutput;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct TupleStruct(pub i32, pub i32);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) union CrateUnion {\n    ptr: *const u8,\n    offset: usize,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct Container;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Check the size of Cargo.toml",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:13.591265Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.039549Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-lBdIPII5p9WRJ85idNA8",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the file metadata for Cargo.toml in the current directory.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1690,
            completion_tokens: 33,
            total_tokens: 1723,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.039720Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.039790Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040724Z  INFO ploke_tui::event_bus: close, time.busy: 7.32µs, time.idle: 6.24µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040756Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040788Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, parent_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040810Z DEBUG dbg_tools: Processing tool, request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040826Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.040839Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041085Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041113Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, parent_id: 4c311931-ac64-495f-bb4d-21e3e842b06d, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041836Z  INFO ploke_tui::llm::session: close, time.busy: 1.08ms, time.idle: 2.65µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(12)
    in ploke_tui::llm::session::await_tool_result with request_id: 40a772be-8663-4f4a-9c99-b9f84eb85396, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041885Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041901Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041965Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.041977Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub union UnionWithFieldAttr {\n    #[cfg(target_endian = \"big\")]\n    big_endian_data: u32,\n    #[cfg(not(target_endian = \"big\"))]\n    little_endian_data: u32,\n    always_present: u8,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type Mapping<K, V> = std::collections::HashMap<K, V>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with various variant kinds for detailed field parsing (though not fully checked by ExpectedEnumNode yet).\npub enum EnumWithMixedVariants {\n    Simple,\n    TupleMulti(i32, String, bool),\n    StructMulti {\n        id: u32,\n        #[cfg(feature = \"enum_field_feature\")]\n        name: String,\n        active: bool,\n    },\n    /// Doc on a unit variant within a mixed enum.\n    UnitWithDoc,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Use the get_file_metadata tool to check the file 'Cargo.toml' in the current directory. I need to see the file size and tracking hash.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.042302Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080015Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-QSHqn7GwwegVmtvLw5za",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll search for code snippets related to SimpleStruct in the codebase using the search function.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.request_code_context:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: RequestCodeContext,
                                    arguments: "{\"search_term\": \"SimpleStruct\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1469,
            completion_tokens: 37,
            total_tokens: 1506,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080023Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-4mAqW918AltIsHJCGIRn",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'll get the metadata for the 'Cargo.toml' file using the get_file_metadata tool.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1612,
            completion_tokens: 38,
            total_tokens: 1650,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080118Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080120Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080188Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080195Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080835Z  INFO ploke_tui::event_bus: close, time.busy: 6.68µs, time.idle: 5.40µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080860Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080884Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, parent_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, call_id: "functions.request_code_context:0", tool: RequestCodeContext
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080901Z DEBUG dbg_tools: Processing tool, request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0", args: "{\"search_term\": \"SimpleStruct\"}", tool: RequestCodeContext
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080921Z  INFO ploke_tui::event_bus: close, time.busy: 6.88µs, time.idle: 5.43µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080935Z DEBUG dbg_tools: params: RequestCodeContextParams {
    token_budget: None,
    search_term: "SimpleStruct",
}

    at crates/ploke-tui/src/tools/mod.rs:244 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080947Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080971Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: a25ad74f-3c24-4459-b165-3769d00422c6, parent_id: 389547b6-5c72-415a-bd02-51d5c248b380, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.080988Z DEBUG dbg_tools: Processing tool, request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081000Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081009Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081167Z DEBUG dbg_tools: content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}"

    at crates/ploke-tui/src/tools/mod.rs:285 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081191Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: a25ad74f-3c24-4459-b165-3769d00422c6, parent_id: 389547b6-5c72-415a-bd02-51d5c248b380, call_id: "functions.get_file_metadata:0", content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081315Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081926Z  INFO ploke_tui::llm::session: close, time.busy: 977µs, time.idle: 2.80µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(10)
    in ploke_tui::llm::session::await_tool_result with request_id: a25ad74f-3c24-4459-b165-3769d00422c6, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081967Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.get_file_metadata:0",
            Ok(
                "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.081982Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.get_file_metadata:0",
        Ok(
            "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.082036Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.082046Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level crate-visible static string.\npub(crate) static TOP_LEVEL_CRATE_STATIC: &str = \"crate visible\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A simple exported macro_rules macro.\n#[macro_export]\nmacro_rules! exported_macro {\n    () => {\n        println!(\"Exported!\")\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A documented macro_rules macro.\n#[macro_export]\nmacro_rules! documented_macro {\n    ($($tts:tt)*) => {\n        stringify!($($tts)*)\n    };\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SelfInAssocBound {\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\n    fn get_related(&self) -> Self::Related;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod sub_imports {\n    // Import from parent module\n    use super::fmt;\n    // Import from grandparent module (crate root)\n    use crate::enums::DocumentedEnum;\n    // Import from std\n    use std::sync::Arc;\n    // Import using self\n    use self::nested_sub::NestedItem;\n    // Import using super\n    use super::super::structs::TupleStruct; // Goes up two levels\n\n    pub struct SubItem;\n\n    pub mod nested_sub {\n        pub struct NestedItem;\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub(crate) trait CrateTrait {\n    fn crate_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented constant.\n#[deprecated(note = \"Use NEW_DOC_ATTR_CONST instead\")]\n#[allow(non_upper_case_globals, clippy::approx_constant)] // Example of more attributes\npub const doc_attr_const: f64 = 3.14;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait ComplexGenericTrait<'a, T: Debug + Clone, S: Send + Sync>\nwhere\n    T: 'a,\n{\n    fn complex_process(&'a self, item: T, other: S) -> &'a T;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "trait InternalTrait {\n    fn default_method(&self) -> String {\n        \"Default implementation\".to_string()\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type DynDrawable = dyn std::fmt::Debug;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public union\npub union DocumentedUnion {\n    data: [u8; 16],\n    id: u128,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please get the metadata for the file 'Cargo.toml' using the get_file_metadata tool.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"file_path\":\"Cargo.toml\",\"exists\":true,\"byte_len\":2315,\"modified_ms\":1756879048526,\"file_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\",\"tracking_hash\":\"9a41bf9f-0790-5e5c-abb8-403dfe4901cd\"}",
                tool_call_id: Some(
                    "functions.get_file_metadata:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.082295Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.201467Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.201772Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.201807Z DEBUG ploke_embed::local: close, time.busy: 121ms, time.idle: 3.74µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.395309Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.395354Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.395371Z  INFO ploke_rag::core: close, time.busy: 314ms, time.idle: 5.41µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.395419Z  INFO ploke_rag::core: close, time.busy: 22.9µs, time.idle: 314ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.395485Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.403306Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-hfYWkK8eSeKJwVHP1ERP",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I will check if the `Cargo.toml` file exists and retrieve its metadata, including the tracking hash.",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.get_file_metadata:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: GetFileMetadata,
                                    arguments: "{\"file_path\": \"Cargo.toml\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1543,
            completion_tokens: 41,
            total_tokens: 1584,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.403428Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.403486Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404341Z  INFO ploke_tui::event_bus: close, time.busy: 5.81µs, time.idle: 4.05µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404361Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404380Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, parent_id: 5ee381ed-8903-4161-b5c6-7db3bab5708d, call_id: "functions.get_file_metadata:0", tool: GetFileMetadata
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404394Z DEBUG dbg_tools: Processing tool, request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0", args: "{\"file_path\": \"Cargo.toml\"}", tool: GetFileMetadata
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404404Z DEBUG dbg_tools: params: GetFileMetadataParams {
    file_path: "Cargo.toml",
}

    at crates/ploke-tui/src/tools/mod.rs:277 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404411Z DEBUG dbg_tools: path: Cargo.toml
    at crates/ploke-tui/src/tools/get_file_metadata.rs:118 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.404530Z  INFO ploke_tui::event_bus: close, time.busy: 4.32µs, time.idle: 2.39µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(2)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.408936Z  INFO ploke_tui::llm::session: close, time.busy: 4.57ms, time.idle: 2.21µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(2)
    in ploke_tui::llm::session::await_tool_result with request_id: 122f4a6a-8de4-410c-8936-ceeab53527e4, call_id: "functions.get_file_metadata:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.408957Z  INFO ploke_tui::llm::session: close, time.busy: 2.45s, time.idle: 4.22ms
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(2)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.408962Z  INFO ploke_tui::llm: close, time.busy: 2.04ms, time.idle: 2.45s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(2)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.408966Z  INFO ploke_tui::llm: close, time.busy: 5.80ms, time.idle: 2.44s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(2)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.446736Z  INFO ploke_rag::core: close, time.busy: 27.0µs, time.idle: 25.1µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.446873Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.451449Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171053-WGby0M8YKUQl9rscYW9Q",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "The `Cargo.toml` file weighs **2 315 bytes** (≈ 2¼ kB).",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171053,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1834,
            completion_tokens: 23,
            total_tokens: 1857,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.451542Z  INFO ploke_tui::llm::session: close, time.busy: 2.67s, time.idle: 3.62µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(13)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.451638Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(13)

  2025-09-06T15:04:14.451687Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(13)

  2025-09-06T15:04:14.454280Z  INFO ploke_tui::llm: close, time.busy: 3.31ms, time.idle: 2.67s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(13)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.454322Z  INFO ploke_tui::llm: LLM produced response for parent_id=85de545a-c3da-4ed9-bba2-f5ae386896b1 -> assistant_message_id=242a5858-de02-4645-827a-71f4b37cd15c. preview=The `Cargo.toml` file weighs **2 315 bytes** (≈ 2¼ kB).
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(13)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.454352Z  INFO ploke_tui::llm: close, time.busy: 3.47ms, time.idle: 2.67s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(13)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.454408Z  INFO ploke_tui::app_state::handlers::chat: Updating message 242a5858-de02-4645-827a-71f4b37cd15c status=Some(Completed) content_preview=The `Cargo.toml` file weighs **2 315 bytes** (≈ 2¼ kB).
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 242a5858-de02-4645-827a-71f4b37cd15c, msg_id: 242a5858-de02-4645-827a-71f4b37cd15c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.454424Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 242a5858-de02-4645-827a-71f4b37cd15c, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 242a5858-de02-4645-827a-71f4b37cd15c, msg_id: 242a5858-de02-4645-827a-71f4b37cd15c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.454446Z  INFO ploke_tui::event_bus: close, time.busy: 7.26µs, time.idle: 2.71µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 242a5858-de02-4645-827a-71f4b37cd15c, msg_id: 242a5858-de02-4645-827a-71f4b37cd15c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.454464Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 56.3µs, time.idle: 4.90µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::update_message with id: 242a5858-de02-4645-827a-71f4b37cd15c, msg_id: 242a5858-de02-4645-827a-71f4b37cd15c, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.454476Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 82.6µs, time.idle: 4.00µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.454521Z  INFO ploke_tui::event_bus: close, time.busy: 2.60µs, time.idle: 2.61µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(13)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 642f67cd-b55f-4303-89a9-87ca9c101379, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.454537Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 36.6µs, time.idle: 4.56µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(13)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 642f67cd-b55f-4303-89a9-87ca9c101379, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.454548Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 59.9µs, time.idle: 2.42µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(13)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.536254Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171051-0gytTBW7w8wuMQq21ilP",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Hello! I'd be happy to help you with your files. What specific assistance do you need? Are you looking to:\n\n- Review or edit Rust code\n- Understand certain code patterns or functionality\n- Add new features or fix bugs\n- Get help with file organization or module structure\n- Something else?\n\nPlease let me know what files or code you'd like help with, and I'll do my best to assist you!",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171051,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1367,
            completion_tokens: 84,
            total_tokens: 1451,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.536353Z  INFO ploke_tui::llm::session: close, time.busy: 2.79s, time.idle: 3.73µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(6)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.536440Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(6)

  2025-09-06T15:04:14.536499Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(6)

  2025-09-06T15:04:14.537061Z  INFO ploke_tui::llm: close, time.busy: 2.51ms, time.idle: 2.79s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(6)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.537078Z  INFO ploke_tui::llm: LLM produced response for parent_id=92957bce-6073-4ca0-866c-88451c4d87c1 -> assistant_message_id=8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52. preview=Hello! I'd be happy to help you with your files. What specific assistance do you need? Are you looking to:

- Review or edit Rust code
- Understand certain code patterns or functionality
- Add new fea
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.537097Z  INFO ploke_tui::llm: close, time.busy: 2.61ms, time.idle: 2.79s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(6)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.537141Z  INFO ploke_tui::app_state::handlers::chat: Updating message 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52 status=Some(Completed) content_preview=Hello! I'd be happy to help you with your files. What specific assistance do you need? Are you looki...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, msg_id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.537150Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, msg_id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.537162Z  INFO ploke_tui::event_bus: close, time.busy: 3.61µs, time.idle: 1.35µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, msg_id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.537171Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 31.2µs, time.idle: 3.16µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::update_message with id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, msg_id: 8c6d01cc-b6ee-44a3-b1b6-d7bfa2530e52, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.537176Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 45.5µs, time.idle: 2.06µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:14.537204Z  INFO ploke_tui::event_bus: close, time.busy: 1.26µs, time.idle: 1.23µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(6)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f8d7f03f-9601-430d-9576-56bc0ba68fe7, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.537212Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 21.7µs, time.idle: 2.54µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(6)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f8d7f03f-9601-430d-9576-56bc0ba68fe7, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.537219Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 35.5µs, time.idle: 1.25µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(6)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:14.548318Z  INFO ploke_rag::core: close, time.busy: 33.8µs, time.idle: 32.1µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(14)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.548447Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.548828Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.642366Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.642607Z DEBUG ploke_embed::local: shapes: outputs=[1, 5, 384], weights=[1, 5, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.642632Z DEBUG ploke_embed::local: close, time.busy: 94.1ms, time.idle: 2.88µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(14)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.830524Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.830570Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.830589Z  INFO ploke_rag::core: close, time.busy: 282ms, time.idle: 5.96µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(14)
    in ploke_rag::core::search with query_len: 12, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.830603Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 20
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.830614Z  INFO ploke_rag::core: close, time.busy: 283ms, time.idle: 467ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(14)
    in ploke_rag::core::search_bm25 with query_len: 12, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.865803Z  INFO ploke_rag::context: close, time.busy: 29.7ms, time.idle: 5.49ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(14)
    in ploke_rag::context::assemble_context with query_len: 12, hits: 20
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.865868Z  INFO ploke_rag::core: close, time.busy: 627ms, time.idle: 158ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(14)
    in ploke_rag::core::get_context with query_len: 12, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.865931Z  INFO ploke_tui::tools::request_code_context: Executed Tool: RequestCodeContext 
With stats: ContextStats {
    total_tokens: 320,
    files: 20,
    parts: 20,
    truncated_parts: 0,
    dedup_removed: 0,
}
    at crates/ploke-tui/src/tools/request_code_context.rs:180 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.866045Z DEBUG dbg_tools: content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}"

    at crates/ploke-tui/src/tools/mod.rs:252 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.866115Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, parent_id: eb76828a-1828-4a63-9613-8fc6548d7a4c, call_id: "functions.request_code_context:0", content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867007Z  INFO ploke_tui::llm::session: close, time.busy: 786ms, time.idle: 2.19µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(14)
    in ploke_tui::llm::session::await_tool_result with request_id: 6f8f64a6-b72c-4f17-9cfa-27789355c511, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867044Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.request_code_context:0",
            Ok(
                "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867072Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.request_code_context:0",
        Ok(
            "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867131Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867140Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "struct SimpleStruct {\n    x: i32,\n    y: bool,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub struct SimpleStruct {\n    pub data: i32,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented struct\npub struct DocumentedStruct {\n    pub field: String,\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type IdAlias = SimpleId;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Enum with `#[repr]` attribute and explicit discriminants.\n#[repr(u16)]\npub enum EnumWithAttributesAndDiscriminants {\n    Up = 1,\n    #[allow(dead_code)] // Attribute on a variant\n    Down, // Implicitly 2\n    Left = 10,\n    /// Doc comment on a variant with an implicit discriminant.\n    Right, // Implicitly 11\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn trait_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type SimpleId = u64;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner_mod {\n    // Constant visible only within the crate, defined inside an inline module.\n    pub(crate) const INNER_CONST: u8 = 1;\n\n    // Static mutable boolean visible only to the parent module (`crate`), defined inside an inline module.\n    #[allow(dead_code)] // Allow unused for fixture simplicity\n    pub(super) static mut INNER_MUT_STATIC: bool = false;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SuperTrait: SimpleTrait {\n    fn super_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Can you find any code snippets related to SimpleStruct in the codebase?",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"search_term\":\"SimpleStruct\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"canon_path\":\"id://7ad2d905-a461-5e4d-b221-93c2d9256b7d\",\"snippet\":\"struct InnerStruct;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"canon_path\":\"id://253a77e3-6365-5519-982e-14f85d201442\",\"snippet\":\"struct Container;\"},{\"file_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"canon_path\":\"id://07e76a9f-02d6-5fc9-8724-482b957f0cb5\",\"snippet\":\"struct PrivateStruct {\\n    secret: String,\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"canon_path\":\"id://bc34fd7a-e8de-5880-8d86-bf7bbcd84d70\",\"snippet\":\"pub struct SubItem;\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"canon_path\":\"id://81c32b1b-c938-5245-af6a-f253880d490a\",\"snippet\":\"pub struct NestedItem;\"},{\"file_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"canon_path\":\"id://78feeb0a-f122-59ff-8e03-4912a0da68a9\",\"snippet\":\"type ConstRawPtr = *const u8;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"canon_path\":\"id://1029cec8-c1f4-57f6-8cfc-43a58c4cb0ec\",\"snippet\":\"pub struct UnitStruct;\"}]}",
                tool_call_id: Some(
                    "functions.request_code_context:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:14.867427Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.068570Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-6xGqlcBxFkClb26zAdEO",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "tool_calls",
            ),
            native_finish_reason: Some(
                "tool_calls",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I'd be happy to help you understand how tools work in this system! Let me break down the available tools and provide examples based on the code context.\n\n## Available Tools:\n\n1. **`request_code_context`** - Use this to search for and retrieve related code\n2. **`apply_code_edit`** - Use this to propose code changes\n3. **`get_file_metadata`** - Use this to get file information for safe editing\n\nLet me demonstrate these tools by exploring the code structure:",
                    ),
                    tool_calls: Some(
                        [
                            ToolCall {
                                call_id: "functions.request_code_context:0",
                                call_type: FunctionMarker,
                                function: FunctionCall {
                                    name: RequestCodeContext,
                                    arguments: "{\"search_term\": \"SimpleStruct SimpleTrait\"}",
                                },
                            },
                        ],
                    ),
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1707,
            completion_tokens: 118,
            total_tokens: 1825,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.068734Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.068813Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(8)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.069587Z  INFO ploke_tui::event_bus: close, time.busy: 8.51µs, time.idle: 5.96µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.069630Z DEBUG ploke_tui::llm::session: Awaiting tool result
    at crates/ploke-tui/src/llm/session.rs:463 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.069666Z DEBUG dbg_tools: Dispatching ToolEvent::Requested in LLM manager, request_id: 391e8c93-f279-4523-99e1-a702cc183c80, parent_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, call_id: "functions.request_code_context:0", tool: RequestCodeContext
    at crates/ploke-tui/src/llm/mod.rs:391 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.069688Z DEBUG dbg_tools: Processing tool, request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0", args: "{\"search_term\": \"SimpleStruct SimpleTrait\"}", tool: RequestCodeContext
    at crates/ploke-tui/src/tools/mod.rs:234 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.069703Z DEBUG dbg_tools: params: RequestCodeContextParams {
    token_budget: None,
    search_term: "SimpleStruct SimpleTrait",
}

    at crates/ploke-tui/src/tools/mod.rs:244 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.070091Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.167545Z DEBUG ploke_embed::local: shapes: outputs=[1, 8, 384], weights=[1, 8, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.167867Z DEBUG ploke_embed::local: shapes: outputs=[1, 8, 384], weights=[1, 8, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.167893Z DEBUG ploke_embed::local: close, time.busy: 98.1ms, time.idle: 2.51µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.350889Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.350936Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.350955Z  INFO ploke_rag::core: close, time.busy: 281ms, time.idle: 5.62µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.351007Z  INFO ploke_rag::core: close, time.busy: 23.6µs, time.idle: 281ms
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.351077Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 1, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 50
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.402326Z  INFO ploke_rag::core: close, time.busy: 23.3µs, time.idle: 20.9µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.402416Z DEBUG ploke_rag::core: BM25 empty; retrying after backoff, attempts: 2, bm25_results: 0, bm25_status: Some(Uninitialized), backoff_ms: 100
    at crates/ploke-rag/src/core/mod.rs:303 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.437826Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171052-tlRuy4d5ScPq9GmY38rY",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Nice! I'm here to help with your Rust project. I can assist with code reviews, troubleshooting, refactoring, adding new features, or explaining language concepts.\n\nTo get started, could you tell me more about:\n\n- What you're working on - a brief description of the project or the specific issue you're facing\n- Whether there's particular code you'd like me to look at (I can examine files in the current workspace)\n- What kind of help you need - debugging, implementation suggestions, best practices, etc.\n\nIf you have code you'd like me to review, I can search the codebase and provide detailed feedback or help with modifications.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171052,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1749,
            completion_tokens: 125,
            total_tokens: 1874,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.437995Z  INFO ploke_tui::llm::session: close, time.busy: 3.66s, time.idle: 3.85µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(5)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.438114Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(5)

  2025-09-06T15:04:15.438231Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(5)

  2025-09-06T15:04:15.440671Z  INFO ploke_tui::llm: close, time.busy: 2.33ms, time.idle: 3.66s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(5)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.440704Z  INFO ploke_tui::llm: LLM produced response for parent_id=430c87c7-f8cd-43ce-a828-ebf842c3c9c0 -> assistant_message_id=567fc9c0-e0b6-4957-b025-21f008522e69. preview=Nice! I'm here to help with your Rust project. I can assist with code reviews, troubleshooting, refactoring, adding new features, or explaining language concepts.

To get started, could you tell me mo
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.440730Z  INFO ploke_tui::llm: close, time.busy: 2.47ms, time.idle: 3.66s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(5)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.440796Z  INFO ploke_tui::app_state::handlers::chat: Updating message 567fc9c0-e0b6-4957-b025-21f008522e69 status=Some(Completed) content_preview=Nice! I'm here to help with your Rust project. I can assist with code reviews, troubleshooting, refa...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 567fc9c0-e0b6-4957-b025-21f008522e69, msg_id: 567fc9c0-e0b6-4957-b025-21f008522e69, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:15.440811Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 567fc9c0-e0b6-4957-b025-21f008522e69, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 567fc9c0-e0b6-4957-b025-21f008522e69, msg_id: 567fc9c0-e0b6-4957-b025-21f008522e69, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:15.440838Z  INFO ploke_tui::event_bus: close, time.busy: 14.9µs, time.idle: 2.67µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 567fc9c0-e0b6-4957-b025-21f008522e69, msg_id: 567fc9c0-e0b6-4957-b025-21f008522e69, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:15.440857Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 62.4µs, time.idle: 4.07µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::update_message with id: 567fc9c0-e0b6-4957-b025-21f008522e69, msg_id: 567fc9c0-e0b6-4957-b025-21f008522e69, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:15.440866Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 83.2µs, time.idle: 3.58µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:15.440913Z  INFO ploke_tui::event_bus: close, time.busy: 2.36µs, time.idle: 1.87µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(5)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f80979c1-45cf-42e2-8e35-1c2b6dbba219, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:15.440925Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 31.7µs, time.idle: 4.42µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(5)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: f80979c1-45cf-42e2-8e35-1c2b6dbba219, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:15.440936Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 55.5µs, time.idle: 2.79µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(5)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:15.503791Z  INFO ploke_rag::core: close, time.busy: 38.9µs, time.idle: 31.5µs
    at crates/ploke-rag/src/core/mod.rs:342 on ThreadId(8)
    in ploke_rag::core::bm25_status with timeout_ms: 250
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.503968Z DEBUG ploke_rag::core: BM25 not ready/empty; falling back to dense search, bm25_results: 0, bm25_status: Some(Uninitialized), attempts: 3, fallback_used: true
    at crates/ploke-rag/src/core/mod.rs:312 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.504394Z  INFO ploke_embed::local: Processing outputs with self.model.forward
    at crates/ingest/ploke-embed/src/local/mod.rs:411 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.601273Z DEBUG ploke_embed::local: shapes: outputs=[1, 8, 384], weights=[1, 8, 384], sum_embeddings=[1, 1, 384]
    at crates/ingest/ploke-embed/src/local/mod.rs:428 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.601608Z DEBUG ploke_embed::local: shapes: outputs=[1, 8, 384], weights=[1, 8, 384], norms=[1, 1, 1]
    at crates/ingest/ploke-embed/src/local/mod.rs:444 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.601635Z DEBUG ploke_embed::local: close, time.busy: 97.6ms, time.idle: 2.88µs
    at crates/ingest/ploke-embed/src/local/mod.rs:380 on ThreadId(8)
    in ploke_embed::local::process_batch
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.785913Z DEBUG ploke_rag::core: Dense search collected 82 results across 10 node types
    at crates/ploke-rag/src/core/mod.rs:537 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.785966Z DEBUG ploke_rag::core: Dense search returning 20 results
    at crates/ploke-rag/src/core/mod.rs:547 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.785989Z  INFO ploke_rag::core: close, time.busy: 282ms, time.idle: 7.17µs
    at crates/ploke-rag/src/core/mod.rs:486 on ThreadId(8)
    in ploke_rag::core::search with query_len: 24, top_k: 20
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.786004Z DEBUG ploke_rag::core: Dense fallback complete, dense_results: 20
    at crates/ploke-rag/src/core/mod.rs:321 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.786020Z  INFO ploke_rag::core: close, time.busy: 282ms, time.idle: 434ms
    at crates/ploke-rag/src/core/mod.rs:231 on ThreadId(8)
    in ploke_rag::core::search_bm25 with query_len: 24, top_k: 20, strict: false, timeout_ms: 250
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.820643Z  INFO ploke_rag::context: close, time.busy: 30.1ms, time.idle: 4.48ms
    at crates/ploke-rag/src/context/mod.rs:153 on ThreadId(8)
    in ploke_rag::context::assemble_context with query_len: 24, hits: 20
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.820674Z  INFO ploke_rag::core: close, time.busy: 594ms, time.idle: 157ms
    at crates/ploke-rag/src/core/mod.rs:553 on ThreadId(8)
    in ploke_rag::core::get_context with query_len: 24, top_k: 20
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.820686Z  INFO ploke_tui::tools::request_code_context: Executed Tool: RequestCodeContext 
With stats: ContextStats {
    total_tokens: 494,
    files: 20,
    parts: 20,
    truncated_parts: 0,
    dedup_removed: 0,
}
    at crates/ploke-tui/src/tools/request_code_context.rs:180 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.820751Z DEBUG dbg_tools: content: "{\"ok\":true,\"search_term\":\"SimpleStruct SimpleTrait\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"canon_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"snippet\":\"pub trait SimpleTrait {\\n    fn trait_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"canon_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"snippet\":\"pub trait MultiSuperTrait: SimpleTrait + InternalTrait + Debug {\\n    fn multi_super_method(&self);\\n}\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"canon_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"snippet\":\"pub trait SelfInAssocBound {\\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\\n    fn get_related(&self) -> Self::Related;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"canon_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"snippet\":\"pub(super) trait SuperGraphNodeTrait: super::SimpleTrait {\\n        fn super_visible_op(&self);\\n    }\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"canon_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"snippet\":\"type MathOperation = fn(i32, i32) -> i32;\"},{\"file_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"canon_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"snippet\":\"trait ExampleTrait {\\n    /// An associated constant required by a trait.\\n    const TRAIT_REQ_CONST: bool;\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"canon_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"snippet\":\"/// Enum with `#[repr]` attribute and explicit discriminants.\\n#[repr(u16)]\\npub enum EnumWithAttributesAndDiscriminants {\\n    Up = 1,\\n    #[allow(dead_code)] // Attribute on a variant\\n    Down, // Implicitly 2\\n    Left = 10,\\n    /// Doc comment on a variant with an implicit discriminant.\\n    Right, // Implicitly 11\\n}\"}]}"

    at crates/ploke-tui/src/tools/mod.rs:252 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.820799Z  WARN ploke_tui::app::events: Unused system event in main app loop: ToolCallCompleted { request_id: 391e8c93-f279-4523-99e1-a702cc183c80, parent_id: 9f383ffe-77e1-4f84-a69b-7fbb7da4aee8, call_id: "functions.request_code_context:0", content: "{\"ok\":true,\"search_term\":\"SimpleStruct SimpleTrait\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"canon_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"snippet\":\"pub trait SimpleTrait {\\n    fn trait_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"canon_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"snippet\":\"pub trait MultiSuperTrait: SimpleTrait + InternalTrait + Debug {\\n    fn multi_super_method(&self);\\n}\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"canon_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"snippet\":\"pub trait SelfInAssocBound {\\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\\n    fn get_related(&self) -> Self::Related;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"canon_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"snippet\":\"pub(super) trait SuperGraphNodeTrait: super::SimpleTrait {\\n        fn super_visible_op(&self);\\n    }\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"canon_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"snippet\":\"type MathOperation = fn(i32, i32) -> i32;\"},{\"file_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"canon_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"snippet\":\"trait ExampleTrait {\\n    /// An associated constant required by a trait.\\n    const TRAIT_REQ_CONST: bool;\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"canon_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"snippet\":\"/// Enum with `#[repr]` attribute and explicit discriminants.\\n#[repr(u16)]\\npub enum EnumWithAttributesAndDiscriminants {\\n    Up = 1,\\n    #[allow(dead_code)] // Attribute on a variant\\n    Down, // Implicitly 2\\n    Left = 10,\\n    /// Doc comment on a variant with an implicit discriminant.\\n    Right, // Implicitly 11\\n}\"}]}" }
    at crates/ploke-tui/src/app/events.rs:254 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821319Z  INFO ploke_tui::llm::session: close, time.busy: 752ms, time.idle: 2.35µs
    at crates/ploke-tui/src/llm/session.rs:461 on ThreadId(8)
    in ploke_tui::llm::session::await_tool_result with request_id: 391e8c93-f279-4523-99e1-a702cc183c80, call_id: "functions.request_code_context:0"
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821358Z DEBUG dbg_tools: Tool Results: [
    Ok(
        (
            "functions.request_code_context:0",
            Ok(
                "{\"ok\":true,\"search_term\":\"SimpleStruct SimpleTrait\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"canon_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"snippet\":\"pub trait SimpleTrait {\\n    fn trait_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"canon_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"snippet\":\"pub trait MultiSuperTrait: SimpleTrait + InternalTrait + Debug {\\n    fn multi_super_method(&self);\\n}\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"canon_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"snippet\":\"pub trait SelfInAssocBound {\\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\\n    fn get_related(&self) -> Self::Related;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"canon_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"snippet\":\"pub(super) trait SuperGraphNodeTrait: super::SimpleTrait {\\n        fn super_visible_op(&self);\\n    }\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"canon_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"snippet\":\"type MathOperation = fn(i32, i32) -> i32;\"},{\"file_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"canon_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"snippet\":\"trait ExampleTrait {\\n    /// An associated constant required by a trait.\\n    const TRAIT_REQ_CONST: bool;\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"canon_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"snippet\":\"/// Enum with `#[repr]` attribute and explicit discriminants.\\n#[repr(u16)]\\npub enum EnumWithAttributesAndDiscriminants {\\n    Up = 1,\\n    #[allow(dead_code)] // Attribute on a variant\\n    Down, // Implicitly 2\\n    Left = 10,\\n    /// Doc comment on a variant with an implicit discriminant.\\n    Right, // Implicitly 11\\n}\"}]}",
            ),
        ),
    ),
], tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:218 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821388Z DEBUG dbg_tools: Task Results: Ok(
    (
        "functions.request_code_context:0",
        Ok(
            "{\"ok\":true,\"search_term\":\"SimpleStruct SimpleTrait\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"canon_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"snippet\":\"pub trait SimpleTrait {\\n    fn trait_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"canon_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"snippet\":\"pub trait MultiSuperTrait: SimpleTrait + InternalTrait + Debug {\\n    fn multi_super_method(&self);\\n}\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"canon_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"snippet\":\"pub trait SelfInAssocBound {\\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\\n    fn get_related(&self) -> Self::Related;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"canon_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"snippet\":\"pub(super) trait SuperGraphNodeTrait: super::SimpleTrait {\\n        fn super_visible_op(&self);\\n    }\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"canon_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"snippet\":\"type MathOperation = fn(i32, i32) -> i32;\"},{\"file_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"canon_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"snippet\":\"trait ExampleTrait {\\n    /// An associated constant required by a trait.\\n    const TRAIT_REQ_CONST: bool;\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"canon_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"snippet\":\"/// Enum with `#[repr]` attribute and explicit discriminants.\\n#[repr(u16)]\\npub enum EnumWithAttributesAndDiscriminants {\\n    Up = 1,\\n    #[allow(dead_code)] // Attribute on a variant\\n    Down, // Implicitly 2\\n    Left = 10,\\n    /// Doc comment on a variant with an implicit discriminant.\\n    Right, // Implicitly 11\\n}\"}]}",
        ),
    ),
), tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:225 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821450Z DEBUG ploke_tui::llm::session: build_comp_req, model: moonshotai/kimi-k2, use_tools: true, messages: 19
    at crates/ploke-tui/src/llm/session.rs:382 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821459Z DEBUG ploke_tui::llm::session: dispatch_request with payload: CompReq {
    messages: Some(
        [
            RequestMessage {
                role: System,
                content: "\n<-- SYSTEM PROMPT -->\nYou are a highly skilled software engineer, specializing in the Rust programming language.\n\nYou will be asked to provide some assistance in collaborating with the user.\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "\nTool-aware code collaboration instructions\n\nYou can call tools to request more context and to stage code edits for user approval.\n\n- Notes:\n  - You do NOT provide byte offsets or hashes; we will resolve the canonical path to a node span and validate file hashes internally.\n  - Provide complete item definitions (rewrite), including attributes and docs where appropriate.\n\nConversation structure\n- After the Code section below, the User's query appears under a # USER header.\n- If additional responses from collaborators appear (Assistant/Collaborator), treat them as context.\n- When uncertain, ask for missing details or request additional context precisely.\n\n# Code\n\n",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// A top-level public mutable static counter.\npub static mut TOP_LEVEL_COUNTER: u32 = 0;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseOuterPoint = inner::OuterPoint;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MathOperation = fn(i32, i32) -> i32;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub fn use_imported_items() {\n    let _map = HashMap::<String, i32>::new();\n    let _fmt_res: fmt::Result = Ok(());\n    let _io_res: IoResult<()> = Ok(());\n    let _local_struct = MySimpleStruct {\n        field: \"example\".to_string(),\n    };\n    let _fs_res = fs::read_to_string(\"dummy\");\n    let _file: File;\n    let _path: &Path;\n    let _path_buf = PathBuf::new();\n    let _enum1 = SampleEnum1::Variant1;\n    let _enum_data = EnumWithData::Variant1(1);\n    struct DummyTraitUser;\n    impl SimpleTrait for DummyTraitUser {\n        fn required_method(&self) -> i32 {\n            5\n        }\n    }\n    let _trait_user = DummyTraitUser;\n    // MyGenTrait usage requires type annotation\n    struct GenTraitImpl;\n    impl<T> MyGenTrait<T> for GenTraitImpl {\n        fn process(&self, item: T) -> T {\n            item\n        }\n    }\n    let _gen_trait_user = GenTraitImpl;\n\n    // Glob import usage (e.g., current_dir)\n    let _cwd = current_dir();\n\n    // Relative path usage\n    let _sub_item = SubItem;\n    let _super_item = AttributedStruct {\n        field: \"x\".to_string(),\n    };\n    let _crate_item: SimpleId = 123;\n\n    // Absolute path usage\n    let _duration = Duration::from_secs(1);\n\n    // Extern crate usage (implicitly via types/macros if used)\n    // let _serde_val: serde::Value;\n    // let _serde_alias_val: SerdeAlias::Value;\n\n    // Nested module usage\n    let _arc = Arc::new(1);\n    let _nested_item = sub_imports::nested_sub::NestedItem;\n    let _tuple_struct = TupleStruct(1, 2);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "#[allow(unused_variables, clippy::let_unit_value)]\npub fn use_all_const_static() {\n    // Top Level\n    let _int = TOP_LEVEL_INT;\n    let _bool = TOP_LEVEL_BOOL;\n    let _str = TOP_LEVEL_STR;\n    let _crate_static = TOP_LEVEL_CRATE_STATIC;\n\n    // Type Variations\n    let _arr = ARRAY_CONST;\n    let _tuple = TUPLE_STATIC;\n    let _struct = STRUCT_CONST;\n    let _aliased = ALIASED_CONST;\n\n    // Initializer Variations\n    let _expr = EXPR_CONST;\n    let _fn_call = FN_CALL_CONST;\n\n    // Attributes and Docs\n    let _doc_attr = doc_attr_const;\n    #[cfg(target_os = \"linux\")]\n    let _doc_attr_static = DOC_ATTR_STATIC;\n\n    // Associated Constants\n    let _impl_const = Container::IMPL_CONST;\n    let _trait_const = <Container as ExampleTrait>::TRAIT_REQ_CONST;\n\n    // Inline Module Items\n    let _inner_const = inner_mod::INNER_CONST;\n\n    // Accessing mutable statics requires unsafe block\n    unsafe {\n        TOP_LEVEL_COUNTER += 1;\n        let _counter = TOP_LEVEL_COUNTER;\n\n        inner_mod::INNER_MUT_STATIC = !inner_mod::INNER_MUT_STATIC;\n        let _inner_mut = inner_mod::INNER_MUT_STATIC;\n    }\n\n    // Println to potentially use some values and avoid unused warnings further\n    println!(\"Used: {}, {}, {}, {}\", _int, _bool, _str, _crate_static);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// This is a documented static variable.\n#[cfg(target_os = \"linux\")] // Example attribute\nstatic DOC_ATTR_STATIC: &str = \"Linux specific\";",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub type GenericContainer<T> = Vec<T>;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "mod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n\n    // Trait impl inside module\n    struct InnerStruct;\n    impl SimpleTrait for InnerStruct {\n        fn trait_method(&self) -> i32 {\n            42\n        }\n    }\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub trait SimpleTrait {\n    fn required_method(&self) -> i32;\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type MutRawPtr = *mut u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "/// Documented public trait\npub trait DocumentedTrait {\n    /// Required method documentation\n    fn documented_method(&self);\n}",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "static TUPLE_STATIC: (i32, bool) = (5, false);",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "pub mod impls;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type ConstRawPtr = *const u8;",
                tool_call_id: None,
            },
            RequestMessage {
                role: System,
                content: "type UseInner = inner::InnerPublic;",
                tool_call_id: None,
            },
            RequestMessage {
                role: User,
                content: "Please help me understand how to use tools in this system.",
                tool_call_id: None,
            },
            RequestMessage {
                role: Tool,
                content: "{\"ok\":true,\"search_term\":\"SimpleStruct SimpleTrait\",\"top_k\":20,\"kind\":\"code\",\"context\":[{\"file_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"canon_path\":\"id://8a0a1e1e-499e-555b-8b07-44fc00f88124\",\"snippet\":\"struct SimpleStruct {\\n    x: i32,\\n    y: bool,\\n}\"},{\"file_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"canon_path\":\"id://3bfe5b6b-2541-5397-ac35-c66d50dcba02\",\"snippet\":\"/// Constant struct instance.\\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\"},{\"file_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"canon_path\":\"id://18d39d51-d490-568d-ad38-ae6703cc1a6d\",\"snippet\":\"mod inner {\\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\\n\\n    // Inherent impl inside module\\n    impl SimpleStruct {\\n        pub(super) fn method_in_module(&self) -> i32 {\\n            self.data + 1\\n        }\\n    }\\n\\n    // Trait impl inside module\\n    struct InnerStruct;\\n    impl SimpleTrait for InnerStruct {\\n        fn trait_method(&self) -> i32 {\\n            42\\n        }\\n    }\\n}\"},{\"file_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"canon_path\":\"id://5a9636cd-f229-5f5b-87c7-0920f89472bf\",\"snippet\":\"pub trait SimpleTrait {\\n    fn required_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"canon_path\":\"id://f8d017c6-1bf6-5254-9afa-b7ea7a4948f4\",\"snippet\":\"pub type IdAlias = SimpleId;\"},{\"file_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"canon_path\":\"id://0f072775-a20a-5642-993c-d016cfb369d5\",\"snippet\":\"pub type SimpleId = u64;\"},{\"file_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"canon_path\":\"id://e4bbd083-e309-5a8d-af37-f6c45328fc3c\",\"snippet\":\"pub trait SuperTrait: SimpleTrait {\\n    fn super_method(&self);\\n}\"},{\"file_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"canon_path\":\"id://7b71d49e-7c9f-5c4e-9068-e36f6f8a0824\",\"snippet\":\"pub trait SimpleTrait {\\n    fn trait_method(&self) -> i32;\\n}\"},{\"file_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"canon_path\":\"id://1f5b1c63-9bfe-5837-9a8d-e35d45d6aa39\",\"snippet\":\"pub struct SimpleStruct {\\n    pub data: i32,\\n}\"},{\"file_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"canon_path\":\"id://a9cb1496-1e88-57a6-8b8a-7ed82e61fda4\",\"snippet\":\"pub trait MultiSuperTrait: SimpleTrait + InternalTrait + Debug {\\n    fn multi_super_method(&self);\\n}\"},{\"file_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"canon_path\":\"id://8278f91d-a125-5006-a2b5-8f28b7585441\",\"snippet\":\"type MutRawPtr = *mut u8;\"},{\"file_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"canon_path\":\"id://4e3ad83b-cce9-56e2-a973-cd34362e99b6\",\"snippet\":\"pub trait SelfInAssocBound {\\n    type Related: SimpleTrait; // Related type must implement SimpleTrait\\n    fn get_related(&self) -> Self::Related;\\n}\"},{\"file_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"canon_path\":\"id://e6e50bd9-1c47-5c5a-8d24-e99d6fe23aa6\",\"snippet\":\"/// A top-level private constant with a simple integer type.\\nconst TOP_LEVEL_INT: i32 = 10;\"},{\"file_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"canon_path\":\"id://f7be82f8-ea8b-5d93-b871-ec398c98039b\",\"snippet\":\"pub(super) trait SuperGraphNodeTrait: super::SimpleTrait {\\n        fn super_visible_op(&self);\\n    }\"},{\"file_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"canon_path\":\"id://4f79efc7-76c9-5d47-86eb-ddf45021723c\",\"snippet\":\"/// A simple public enum with unit-like variants.\\npub enum SampleEnum1 {\\n    Variant1,\\n    Variant2,\\n}\"},{\"file_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"canon_path\":\"id://ddcbf377-cc82-5c97-b04a-d2dfaa82f355\",\"snippet\":\"type MathOperation = fn(i32, i32) -> i32;\"},{\"file_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"canon_path\":\"id://cdac1a13-2912-5962-aa46-ac3bde8ba598\",\"snippet\":\"trait ExampleTrait {\\n    /// An associated constant required by a trait.\\n    const TRAIT_REQ_CONST: bool;\\n}\"},{\"file_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"canon_path\":\"id://a8cfc6d0-e4e8-58f8-8bd0-9d3df2398ca3\",\"snippet\":\"static TUPLE_STATIC: (i32, bool) = (5, false);\"},{\"file_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"canon_path\":\"id://a4ad382e-5d9a-52fc-8c38-a3bcf500cc11\",\"snippet\":\"const EXPR_CONST: i32 = 5 * 2 + 1;\"},{\"file_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"canon_path\":\"id://6812b50d-c5de-5bec-9310-7f38a74e1258\",\"snippet\":\"/// Enum with `#[repr]` attribute and explicit discriminants.\\n#[repr(u16)]\\npub enum EnumWithAttributesAndDiscriminants {\\n    Up = 1,\\n    #[allow(dead_code)] // Attribute on a variant\\n    Down, // Implicitly 2\\n    Left = 10,\\n    /// Doc comment on a variant with an implicit discriminant.\\n    Right, // Implicitly 11\\n}\"}]}",
                tool_call_id: Some(
                    "functions.request_code_context:0",
                ),
            },
        ],
    ),
    prompt: None,
    model: Some(
        "moonshotai/kimi-k2",
    ),
    response_format: None,
    stop: None,
    stream: Some(
        false,
    ),
    max_tokens: None,
    temperature: None,
    tools: Some(
        [
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: RequestCodeContext,
                    description: RequestCodeContext,
                    parameters: Object {
                        "properties": Object {
                            "search_term": Object {
                                "description": String("Search term guide which code guide hybrid semantic search and bm25."),
                                "type": String("string"),
                            },
                            "token_budget": Object {
                                "description": String("Optional maximum tokens of code context to return, sane defaults"),
                                "minimum": Number(1),
                                "type": String("integer"),
                            },
                        },
                        "required": Array [
                            String("search_term"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: ApplyCodeEdit,
                    description: ApplyCodeEdit,
                    parameters: Object {
                        "properties": Object {
                            "confidence": Object {
                                "description": String("Optional confidence indicator for the edit proposal."),
                                "maximum": Number(1.0),
                                "minimum": Number(0.0),
                                "type": String("number"),
                            },
                            "edits": Object {
                                "items": Object {
                                    "additionalProperties": Bool(false),
                                    "properties": Object {
                                        "canon": Object {
                                            "description": String("Canonical path to the node, e.g. crate::module::Item"),
                                            "type": String("string"),
                                        },
                                        "code": Object {
                                            "description": String("Replacement code for the node."),
                                            "type": String("string"),
                                        },
                                        "file": Object {
                                            "description": String("Absolute or workspace-relative file path."),
                                            "type": String("string"),
                                        },
                                        "node_type": Object {
                                            "description": String("Node type (function|struct|enum|...)."),
                                            "type": String("string"),
                                        },
                                    },
                                    "required": Array [
                                        String("file"),
                                        String("canon"),
                                        String("node_type"),
                                        String("code"),
                                    ],
                                    "type": String("object"),
                                },
                                "type": String("array"),
                            },
                        },
                        "required": Array [
                            String("edits"),
                        ],
                        "type": String("object"),
                    },
                },
            },
            ToolDefinition {
                type: FunctionMarker,
                function: ToolFunctionDef {
                    name: GetFileMetadata,
                    description: GetFileMetadata,
                    parameters: Object {
                        "properties": Object {
                            "file_path": Object {
                                "description": String("Absolute path to the target file."),
                                "type": String("string"),
                            },
                        },
                        "required": Array [
                            String("file_path"),
                        ],
                        "type": String("object"),
                    },
                },
            },
        ],
    ),
    tool_choice: Some(
        Auto,
    ),
    seed: None,
    top_p: None,
    top_k: None,
    frequency_penalty: None,
    presence_penalty: None,
    repetition_penalty: None,
    logit_bias: None,
    top_logprobs: None,
    min_p: None,
    top_a: None,
    transforms: None,
    models: None,
    route: None,
    provider: None,
    user: None,
}, model: moonshotai/kimi-k2, base_url: https://openrouter.ai/api/v1, full_url: https://openrouter.ai/api/v1/chat/completions, provider_slug: None, use_tools: true, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:88 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:15.821765Z DEBUG hyper_util::client::legacy::pool: reuse idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:270 on ThreadId(8)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.594003Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171054-BFwCNdHhhNunur4dZMm9",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I used the `get_file_metadata` tool to check the Cargo.toml file. Here are the details:\n\n- **File exists**: Yes\n- **File path**: Cargo.toml\n- **File size**: 2,315 bytes\n- **Last modified**: 2025-01-03 at 11:57:28.526 UTC\n- **Tracking hash**: `9a41bf9f-0790-5e5c-abb8-403dfe4901cd`\n\nThe file is present and accessible.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171054,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1778,
            completion_tokens: 108,
            total_tokens: 1886,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.594128Z  INFO ploke_tui::llm::session: close, time.busy: 4.61s, time.idle: 4.48µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(12)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.594232Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(12)

  2025-09-06T15:04:16.594286Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(12)

  2025-09-06T15:04:16.595190Z  INFO ploke_tui::llm: close, time.busy: 3.89ms, time.idle: 4.61s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(12)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.595216Z  INFO ploke_tui::llm: LLM produced response for parent_id=4c311931-ac64-495f-bb4d-21e3e842b06d -> assistant_message_id=60d20331-f353-481e-8fc6-2b7956d8e843. preview=I used the `get_file_metadata` tool to check the Cargo.toml file. Here are the details:

- **File exists**: Yes
- **File path**: Cargo.toml
- **File size**: 2,315 bytes
- **Last modified**: 2025-01-03
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(12)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.595240Z  INFO ploke_tui::llm: close, time.busy: 4.05ms, time.idle: 4.61s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(12)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.595291Z  INFO ploke_tui::app_state::handlers::chat: Updating message 60d20331-f353-481e-8fc6-2b7956d8e843 status=Some(Completed) content_preview=I used the `get_file_metadata` tool to check the Cargo.toml file. Here are the details:

- **File ex...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 60d20331-f353-481e-8fc6-2b7956d8e843, msg_id: 60d20331-f353-481e-8fc6-2b7956d8e843, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.595307Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 60d20331-f353-481e-8fc6-2b7956d8e843, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 60d20331-f353-481e-8fc6-2b7956d8e843, msg_id: 60d20331-f353-481e-8fc6-2b7956d8e843, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.595324Z  INFO ploke_tui::event_bus: close, time.busy: 5.70µs, time.idle: 1.81µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 60d20331-f353-481e-8fc6-2b7956d8e843, msg_id: 60d20331-f353-481e-8fc6-2b7956d8e843, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.595337Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 47.4µs, time.idle: 5.19µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::update_message with id: 60d20331-f353-481e-8fc6-2b7956d8e843, msg_id: 60d20331-f353-481e-8fc6-2b7956d8e843, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.595349Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 71.7µs, time.idle: 3.04µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.595388Z  INFO ploke_tui::event_bus: close, time.busy: 1.97µs, time.idle: 1.62µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(12)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed602e84-6e5a-4871-94ba-a3e9395c26bd, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:16.595398Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 29.3µs, time.idle: 3.81µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(12)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: ed602e84-6e5a-4871-94ba-a3e9395c26bd, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:16.595405Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 45.4µs, time.idle: 1.48µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(12)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:16.676386Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171053-boJUrVYHzDFS6SkWf8OI",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Here is the metadata for the `Cargo.toml` file:\n\n- **File**: `Cargo.toml`\n- **Byte length**: 2,315 bytes\n- **Last modified**: 2025-04-05 19:17:28 UTC (1756879048526 ms since epoch)\n- **File hash**: `9a41bf9f-0790-5e5c-abb8-403dfe4901cd`\n- **Tracking hash**: `9a41bf9f-0790-5e5c-abb8-403dfe4901cd`\n\nWould you like me to read or edit the `Cargo.toml` itself, or fetch more context from the workspace?",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171053,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1688,
            completion_tokens: 144,
            total_tokens: 1832,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.676502Z  INFO ploke_tui::llm::session: close, time.busy: 5.06s, time.idle: 4.64µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(9)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.676602Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(9)

  2025-09-06T15:04:16.676667Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(9)

  2025-09-06T15:04:16.677426Z  INFO ploke_tui::llm: close, time.busy: 6.98ms, time.idle: 5.05s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(9)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.677447Z  INFO ploke_tui::llm: LLM produced response for parent_id=d62d82b5-6440-46af-ace7-e6e0b198bc0f -> assistant_message_id=7e9ae16f-269b-4b95-9df9-1ceabf87696d. preview=Here is the metadata for the `Cargo.toml` file:

- **File**: `Cargo.toml`
- **Byte length**: 2,315 bytes
- **Last modified**: 2025-04-05 19:17:28 UTC (1756879048526 ms since epoch)
- **File hash**: `9
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.677471Z  INFO ploke_tui::llm: close, time.busy: 7.16ms, time.idle: 5.05s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(9)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:16.677527Z  INFO ploke_tui::app_state::handlers::chat: Updating message 7e9ae16f-269b-4b95-9df9-1ceabf87696d status=Some(Completed) content_preview=Here is the metadata for the `Cargo.toml` file:

- **File**: `Cargo.toml`
- **Byte length**: 2,315 b...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, msg_id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.677539Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, msg_id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.677555Z  INFO ploke_tui::event_bus: close, time.busy: 5.17µs, time.idle: 1.74µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, msg_id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.677566Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 40.2µs, time.idle: 3.54µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::update_message with id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, msg_id: 7e9ae16f-269b-4b95-9df9-1ceabf87696d, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.677574Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 58.0µs, time.idle: 2.77µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:16.677617Z  INFO ploke_tui::event_bus: close, time.busy: 1.90µs, time.idle: 1.61µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(9)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 980cd9c8-c128-48d8-8294-ac1b2c15a317, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:16.677627Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 27.7µs, time.idle: 3.95µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(9)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: 980cd9c8-c128-48d8-8294-ac1b2c15a317, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:16.677634Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 46.2µs, time.idle: 1.99µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(9)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:17.397123Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171054-XHMI82s7eXpdGZCj0OeG",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "I've successfully retrieved the metadata for the `Cargo.toml` file. Here are the details:\n\n- **File:** `Cargo.toml`\n- **Exists:** Yes ✓\n- **Size:** 2,315 bytes (approximately 2.3 KB)\n- **Last Modified:** February 19, 2025 (based on the timestamp 1756879048526)\n- **Tracking Hash:** 9a41bf9f-0790-5e5c-abb8-403dfe4901cd\n\nThe file is ready for editing if needed, and the tracking hash can be used to ensure safe edits.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171054,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 1700,
            completion_tokens: 127,
            total_tokens: 1827,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:17.397233Z  INFO ploke_tui::llm::session: close, time.busy: 5.56s, time.idle: 3.89µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(10)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:17.397326Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(10)

  2025-09-06T15:04:17.397378Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(10)

  2025-09-06T15:04:17.399370Z  INFO ploke_tui::llm: close, time.busy: 3.10ms, time.idle: 5.56s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(10)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:17.399396Z  INFO ploke_tui::llm: LLM produced response for parent_id=389547b6-5c72-415a-bd02-51d5c248b380 -> assistant_message_id=39353e41-650e-4a35-bcda-4f72a252e150. preview=I've successfully retrieved the metadata for the `Cargo.toml` file. Here are the details:

- **File:** `Cargo.toml`
- **Exists:** Yes ✓
- **Size:** 2,315 bytes (approximately 2.3 KB)
- **Last Modified
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(10)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:17.399427Z  INFO ploke_tui::llm: close, time.busy: 3.30ms, time.idle: 5.56s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(10)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:17.399476Z  INFO ploke_tui::app_state::handlers::chat: Updating message 39353e41-650e-4a35-bcda-4f72a252e150 status=Some(Completed) content_preview=I've successfully retrieved the metadata for the `Cargo.toml` file. Here are the details:

- **File:...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::update_message with id: 39353e41-650e-4a35-bcda-4f72a252e150, msg_id: 39353e41-650e-4a35-bcda-4f72a252e150, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:17.399488Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 39353e41-650e-4a35-bcda-4f72a252e150, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::update_message with id: 39353e41-650e-4a35-bcda-4f72a252e150, msg_id: 39353e41-650e-4a35-bcda-4f72a252e150, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:17.399504Z  INFO ploke_tui::event_bus: close, time.busy: 5.08µs, time.idle: 1.65µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 39353e41-650e-4a35-bcda-4f72a252e150, msg_id: 39353e41-650e-4a35-bcda-4f72a252e150, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:17.399515Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 39.4µs, time.idle: 3.78µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::update_message with id: 39353e41-650e-4a35-bcda-4f72a252e150, msg_id: 39353e41-650e-4a35-bcda-4f72a252e150, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:17.399522Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 57.9µs, time.idle: 2.62µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:17.399555Z  INFO ploke_tui::event_bus: close, time.busy: 1.67µs, time.idle: 1.56µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(10)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c8ea1a19-1455-445f-bc2b-5bbc499de050, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:17.399564Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 25.1µs, time.idle: 3.13µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(10)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: c8ea1a19-1455-445f-bc2b-5bbc499de050, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:17.399573Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 42.9µs, time.idle: 1.49µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(10)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:19.592692Z DEBUG ploke_tui::llm::session: response_body parsed as OpenAiReponse: OpenAiResponse {
    id: "gen-1757171054-u1vIxaOhs4GU7v5Tjice",
    choices: [
        Choices {
            logprobs: None,
            finish_reason: Some(
                "stop",
            ),
            native_finish_reason: Some(
                "stop",
            ),
            index: Some(
                0,
            ),
            message: Some(
                ResponseMessage {
                    role: Some(
                        "assistant",
                    ),
                    content: Some(
                        "Based on my search, I found several code snippets related to `SimpleStruct` in the codebase:\n\n## SimpleStruct Definitions\n\nThere appear to be **two different `SimpleStruct` definitions** in the codebase:\n\n### 1. Private Struct Definition:\n```rust\nstruct SimpleStruct {\n    x: i32,\n    y: bool,\n}\n```\n\n### 2. Public Struct Definition:\n```rust\npub struct SimpleStruct {\n    pub data: i32,\n}\n```\n\n## Usage Examples\n\n### Constant Instance:\n```rust\n/// Constant struct instance.\nconst STRUCT_CONST: SimpleStruct = SimpleStruct { x: 99, y: true };\n```\n\nNote: This constant uses the private struct definition with fields `x` and `y`.\n\n### Implementation in Module:\n```rust\nmod inner {\n    use super::{SimpleStruct, SimpleTrait}; // Import necessary items\n\n    // Inherent impl inside module\n    impl SimpleStruct {\n        pub(super) fn method_in_module(&self) -> i32 {\n            self.data + 1\n        }\n    }\n}\n```\n\nThe implementation in the `inner` module appears to be working with the public struct definition that has a `data` field.\n\nIt seems like the codebase contains both a private and public version of `SimpleStruct` with different field structures, which could potentially lead to naming conflicts or confusion.",
                    ),
                    tool_calls: None,
                    logprobs: None,
                    refusal: None,
                    reasoning: None,
                },
            ),
            error: None,
            text: None,
            delta: None,
        },
    ],
    created: 1757171054,
    model: "moonshotai/kimi-k2",
    object: "chat.completion",
    system_fingerprint: None,
    usage: Some(
        TokenUsage {
            prompt_tokens: 3104,
            completion_tokens: 274,
            total_tokens: 3378,
        },
    ),
    logprobs: None,
}, tools: request_code_context,apply_code_edit,get_file_metadata
    at crates/ploke-tui/src/llm/session.rs:172 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:19.592814Z  INFO ploke_tui::llm::session: close, time.busy: 7.70s, time.idle: 3.51µs
    at crates/ploke-tui/src/llm/session.rs:46 on ThreadId(14)
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:19.592925Z DEBUG hyper_util::client::legacy::pool: pooling idle connection for ("https", openrouter.ai)
    at /home/brasides/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/hyper-util-0.1.10/src/client/legacy/pool.rs:396 on ThreadId(14)

  2025-09-06T15:04:19.592987Z DEBUG ploke_tui::app::events: Test harness API response event received
    at crates/ploke-tui/src/app/events.rs:251 on ThreadId(14)

  2025-09-06T15:04:19.594932Z  INFO ploke_tui::llm: close, time.busy: 3.27ms, time.idle: 7.70s
    at crates/ploke-tui/src/llm/mod.rs:618 on ThreadId(14)
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:19.594973Z  INFO ploke_tui::llm: LLM produced response for parent_id=eb76828a-1828-4a63-9613-8fc6548d7a4c -> assistant_message_id=4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99. preview=Based on my search, I found several code snippets related to `SimpleStruct` in the codebase:

## SimpleStruct Definitions

There appear to be **two different `SimpleStruct` definitions** in the codeba
    at crates/ploke-tui/src/llm/mod.rs:565 on ThreadId(14)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:19.595017Z  INFO ploke_tui::llm: close, time.busy: 3.49ms, time.idle: 7.70s
    at crates/ploke-tui/src/llm/mod.rs:480 on ThreadId(14)
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

  2025-09-06T15:04:19.595095Z  INFO ploke_tui::app_state::handlers::chat: Updating message 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99 status=Some(Completed) content_preview=Based on my search, I found several code snippets related to `SimpleStruct` in the codebase:

## Sim...
    at crates/ploke-tui/src/app_state/handlers/chat.rs:24 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, msg_id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:19.595114Z  INFO ploke_tui::app_state::handlers::chat: Message updated successfully; dispatching MessageUpdatedEvent, msg_id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, kind: Assistant, old_status: Generating, new_status: Completed
    at crates/ploke-tui/src/app_state/handlers/chat.rs:42 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, msg_id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:19.595142Z  INFO ploke_tui::event_bus: close, time.busy: 9.21µs, time.idle: 3.40µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::update_message with id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, msg_id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:19.595163Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 69.2µs, time.idle: 6.51µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:17 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::update_message with id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, msg_id: 4ea68fb7-3cb7-481e-8c1d-0e18a23cfc99, new_status: Some(Completed)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:19.595178Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 101µs, time.idle: 4.99µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: UpdateMessage

  2025-09-06T15:04:19.595237Z  INFO ploke_tui::event_bus: close, time.busy: 3.04µs, time.idle: 3.08µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(14)
    in ploke_tui::event_bus::send
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e3b7a6e5-23c0-4984-a01a-0b22c43c3415, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:19.595258Z  INFO ploke_tui::app_state::handlers::chat: close, time.busy: 47.4µs, time.idle: 5.80µs
    at crates/ploke-tui/src/app_state/handlers/chat.rs:146 on ThreadId(14)
    in ploke_tui::app_state::handlers::chat::add_msg_immediate with event_bus: EventBus { realtime_tx: broadcast::Sender, background_tx: broadcast::Sender, error_tx: broadcast::Sender, index_tx: broadcast::Sender }, new_msg_id: e3b7a6e5-23c0-4984-a01a-0b22c43c3415, content: "Request summary: success", kind: SysInfo
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:19.595272Z DEBUG ploke_tui::app_state::dispatcher: close, time.busy: 77.9µs, time.idle: 3.06µs
    at crates/ploke-tui/src/app_state/dispatcher.rs:34 on ThreadId(14)
    in ploke_tui::app_state::dispatcher::processing with cmd: AddMessageImmediate

  2025-09-06T15:04:19.814567Z  INFO ploke_tui::event_bus: close, time.busy: 30.4µs, time.idle: 13.5µs
    at crates/ploke-tui/src/event_bus/mod.rs:196 on ThreadId(8)
    in ploke_tui::event_bus::send
    in ploke_tui::llm::session::request_session_run with model: moonshotai/kimi-k2
    in ploke_tui::llm::prepare_and_run_llm_call with provider_params: Some(LLMParameters { model: "moonshotai/kimi-k2", temperature: None, top_p: None, max_tokens: None, presence_penalty: None, frequency_penalty: None, stop_sequences: [], parallel_tool_calls: true, response_format: Text, safety_settings: SafetySettings { hate: 0, harassment: 0, self_harm: 0, sexual_content: 0 }, system_prompt: None, tool_max_retries: Some(2), tool_token_limit: Some(8196), history_char_budget: None, tool_timeout_secs: Some(45) })
    in ploke_tui::llm::process_llm_request with model: moonshotai/kimi-k2

