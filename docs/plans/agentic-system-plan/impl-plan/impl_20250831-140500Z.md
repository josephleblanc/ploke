## Impl Log — Observability DB fix + GAT wiring decision (linked to plan_20250831-121500Z.md)

- Linked plan: docs/plans/agentic-system-plan/impl-plan/plan_20250831-121500Z.md

What I changed
- Fixed Cozo scripts in `ploke-db` observability:
  - `record_tool_call_requested`: add `:put tool_call { … }` and correct projection; remove accidental string escaping for `status = "requested"` inside raw string.
  - `record_tool_call_done`: add `:put tool_call { … }` and correct projection.
  - `get_tool_call`, `list_tool_calls_by_parent`: project explicit columns and compute `arguments_json_s`, `outcome_json_s`, `at_ms`, `at_valid` consistently.
- Added defensive stderr prints on script errors to speed future debugging in tests.
- Left `get_file_metadata` on the legacy dispatcher path for now to keep the suite green. Wiring it through `dispatch_tool_gat` re‑surfaced the known `tokio::spawn` + GAT `'static` limitation.

Rationale
- Tests in `ploke-tui/tests/observability_lifecycle.rs` were failing due to Cozo parser errors from incomplete `:put` scripts and a double‑escaped string literal in the raw script.
- The GAT path compiles cleanly when awaited directly, but hits the `tokio::spawn` `'static` bound when used from the spawned tool handler. We can solve this by switching the GAT trait to operate on owned params for the run future, or by introducing an owned run shim for the GAT dispatcher.

Evidence
- Targeted tests now pass:
  - `ploke-tui --test observability_lifecycle`: 2 passed, 0 failed.
  - Full `ploke-tui` suite: 46 passed; 0 failed; 4 ignored.
  - Added `ploke-db --test debug_obsv` to confirm `record_tool_call_requested` succeeds.

Next steps (proposed)
- Introduce an owned-params execution path for GAT tools to satisfy `'static` in `tokio::spawn` without sacrificing zero‑copy on JSON parse:
  - Option A: extend `GatTool` with `run_owned(self, owned: OwnedParams, ctx: Ctx) -> impl Future + Send + 'static` and update the dispatcher to use this in spawned contexts.
  - Option B: a small tool‑specific shim for `GetFileMetadata` that parses → owned → runs, keeping the generic trait unchanged until we migrate other tools.
- After that, wire `get_file_metadata` (and optionally `request_code_context`) to `dispatch_tool_gat`.

